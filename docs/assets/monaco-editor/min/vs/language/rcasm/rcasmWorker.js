/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.33.0(968d8d007ba22e57a92d26ec2c149918b727b971)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/
define("vs/language/rcasm/rcasmWorker", ["require","require"],(require)=>{
var moduleExports=(()=>{var ct=Object.defineProperty;var Ui=Object.getOwnPropertyDescriptor;var Vi=Object.getOwnPropertyNames;var qi=Object.prototype.hasOwnProperty;var Hi=t=>ct(t,"__esModule",{value:!0});var Wi=(t,r)=>()=>(t&&(r=t(t=0)),r);var zi=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports),Wt=(t,r)=>{for(var e in r)ct(t,e,{get:r[e],enumerable:!0})},Gi=(t,r,e,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of Vi(r))!qi.call(t,n)&&(e||n!=="default")&&ct(t,n,{get:()=>r[n],enumerable:!(i=Ui(r,n))||i.enumerable});return t};var zt=(t=>(r,e)=>t&&t.get(r)||(e=Gi(Hi({}),r,1),t&&t.set(r,e),e))(typeof WeakMap!="undefined"?new WeakMap:0);var Kt={};Wt(Kt,{mkAsmLine:()=>Qi,mkInsn:()=>es,mkLabel:()=>Yi,mkLiteral:()=>ts,mkProgram:()=>Zi,mkRegister:()=>rs,mkScopeQualifiedIdent:()=>ns,mkSetPC:()=>Ki});function Zi(t,r){return{lines:t,loc:r}}function Qi(t,r,e){return{label:t,stmt:r,loc:e}}function Yi(t,r){return{name:t,loc:r}}function Ki(t,r){return{type:"setpc",pc:t,loc:r}}function es(t,r,e,i){return{type:"insn",mnemonic:t,p1:r,p2:e,loc:i}}function ts(t,r,e){return{type:"literal",value:t,ot:r,loc:e}}function rs(t,r){return{type:"register",value:t,loc:r}}function ns(t,r,e){return{type:"qualified-ident",path:t,absolute:r,loc:e}}var er=Wi(()=>{});var rr=zi((Fs,tr)=>{"use strict";function is(t,r){function e(){this.constructor=t}e.prototype=r.prototype,t.prototype=new e}function ue(t,r,e,i){this.message=t,this.expected=r,this.found=e,this.location=i,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ue)}is(ue,Error);ue.buildMessage=function(t,r){var e={literal:function(h){return'"'+n(h.text)+'"'},class:function(h){var v="",b;for(b=0;b<h.parts.length;b++)v+=h.parts[b]instanceof Array?a(h.parts[b][0])+"-"+a(h.parts[b][1]):a(h.parts[b]);return"["+(h.inverted?"^":"")+v+"]"},any:function(h){return"any character"},end:function(h){return"end of input"},other:function(h){return h.description}};function i(h){return h.charCodeAt(0).toString(16).toUpperCase()}function n(h){return h.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+i(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+i(v)})}function a(h){return h.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+i(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+i(v)})}function c(h){return e[h.type](h)}function p(h){var v=new Array(h.length),b,A;for(b=0;b<h.length;b++)v[b]=c(h[b]);if(v.sort(),v.length>0){for(b=1,A=1;b<v.length;b++)v[b-1]!==v[b]&&(v[A]=v[b],A++);v.length=A}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function m(h){return h?'"'+n(h)+'"':"end of input"}return"Expected "+p(t)+" but "+m(r)+" found."};function ss(t,r){r=r!==void 0?r:{};var e={},i={Lines:Ot},n=Ot,a=function(s,u){return k.mkProgram(ot(s,u,1),P())},c=function(s){return s},p=function(s,u){return k.mkAsmLine(s,u,P())},m=function(s){return k.mkAsmLine(s,null,P())},h=function(s){return k.mkAsmLine(null,s,P())},v=function(s){return k.mkAsmLine(null,s,P())},b=function(){return k.mkAsmLine(null,null,P())},A=function(s){return s},w=function(s,u,l){return k.mkInsn(s,u,l,P())},E=function(s,u){return k.mkInsn(s,u,null,P())},R=function(s){return k.mkInsn(s,null,null,P())},J=/^[a-zA-Z_]/,oe=Q([["a","z"],["A","Z"],"_"],!1,!1),V=/^[a-zA-Z_0-9]/,I=Q([["a","z"],["A","Z"],"_",["0","9"]],!1,!1),ee=/^[0-9a-f]/i,le=Q([["0","9"],["a","f"]],!1,!0),te=/^[0-1]/,N=Q([["0","1"]],!1,!1),F=/^[+\-]/,re=Q(["+","-"],!1,!1),ne=/^[0-9]/,Z=Q([["0","9"]],!1,!1),ie=/^[a-z]/i,H=Q([["a","z"]],!1,!0),we=/^[0-9a-z_]/i,T=Q([["0","9"],["a","z"],"_"],!1,!0),j="a",Se=_("a",!0),Qe="b",Ye=_("b",!0),tn="c",rn=_("c",!0),nn="d",sn=_("d",!0),an="g",on=_("g",!0),un="h",cn=_("h",!0),ln="j",fn=_("j",!0),dn="m",pn=_("m",!0),hn="o",gn=_("o",!0),mn="r",vn=_("r",!0),yn="x",bn=_("x",!0),xn="y",wn=_("y",!0),Sn="0",An=_("0",!1),Cn="1",$n=_("1",!1),Ln="2",_n=_("2",!1),En=",",kn=_(",",!1),Pn=":",Dn=_(":",!1),Tn=";",Mn=_(";",!1),On=function(s){return parseInt(s,2)},Rn=function(s){return parseInt(s,16)},In=function(s){return parseInt(s)},kt=function(){return pi()},Pt=G("whitespace"),Fn="	",jn=_("	",!1),Bn="\v",Nn=_("\v",!1),Un="\f",Vn=_("\f",!1),qn=" ",Hn=_(" ",!1),Wn="\xA0",zn=_("\xA0",!1),Gn="\uFEFF",Xn=_("\uFEFF",!1),Jn=G("end of line"),Zn=/^[\n\r]/,Qn=Q([`
`,"\r"],!1,!1),Yn=G("comment"),Dt=gi(),Kn=G("label"),ei=function(s){return k.mkLabel(s,P())},ti=G("ORG"),ri=function(s){return k.mkSetPC(s,P())},ni=G("mnemonic"),ii=G("literal"),si=function(s){return k.mkLiteral(s,"b",P())},ai=function(s){return k.mkLiteral(s,"h",P())},oi=function(s){return k.mkLiteral(s,"d",P())},ui=G("identifier"),W="::",Ae=_("::",!1),ci=function(s,u){return k.mkScopeQualifiedIdent(ot(s,u,1),!1,P())},li=function(s,u){return k.mkScopeQualifiedIdent(ot(s,u,1),!0,P())},fi=G("register"),di=function(s){return k.mkRegister(s.toLowerCase(),P())},o=0,C=0,Fe=[{line:1,column:1}],z=0,Ke=[],y=0,je;if("startRule"in r){if(!(r.startRule in i))throw new Error(`Can't start parsing from rule "`+r.startRule+'".');n=i[r.startRule]}function pi(){return t.substring(C,o)}function hi(){return Ce(C,o)}function Ps(s,u){throw u=u!==void 0?u:Ce(C,o),Mt([G(s)],t.substring(C,o),u)}function Ds(s,u){throw u=u!==void 0?u:Ce(C,o),vi(s,u)}function _(s,u){return{type:"literal",text:s,ignoreCase:u}}function Q(s,u,l){return{type:"class",parts:s,inverted:u,ignoreCase:l}}function gi(){return{type:"any"}}function mi(){return{type:"end"}}function G(s){return{type:"other",description:s}}function Tt(s){var u=Fe[s],l;if(u)return u;for(l=s-1;!Fe[l];)l--;for(u=Fe[l],u={line:u.line,column:u.column};l<s;)t.charCodeAt(l)===10?(u.line++,u.column=1):u.column++,l++;return Fe[s]=u,u}function Ce(s,u){var l=Tt(s),d=Tt(u);return{start:{offset:s,line:l.line,column:l.column},end:{offset:u,line:d.line,column:d.column}}}function x(s){o<z||(o>z&&(z=o,Ke=[]),Ke.push(s))}function vi(s,u){return new ue(s,null,null,u)}function Mt(s,u,l){return new ue(ue.buildMessage(s,u),s,u,l)}function Ot(){var s,u,l,d,g,S;if(s=o,u=et(),u!==e){for(l=[],d=o,g=Be(),g!==e?(S=et(),S!==e?(g=[g,S],d=g):(o=d,d=e)):(o=d,d=e);d!==e;)l.push(d),d=o,g=Be(),g!==e?(S=et(),S!==e?(g=[g,S],d=g):(o=d,d=e)):(o=d,d=e);l!==e?(C=s,u=a(u,l),s=u):(o=s,s=e)}else o=s,s=e;return s}function et(){var s,u,l,d,g;return s=o,u=Y(),u!==e?(l=yi(),l!==e?(d=Y(),d!==e?(g=Ii(),g===e&&(g=null),g!==e?(C=s,u=c(l),s=u):(o=s,s=e)):(o=s,s=e)):(o=s,s=e)):(o=s,s=e),s}function yi(){var s,u,l,d;return s=o,u=qt(),u!==e?(l=Y(),l!==e?(d=Rt(),d!==e?(C=s,u=p(u,d),s=u):(o=s,s=e)):(o=s,s=e)):(o=s,s=e),s===e&&(s=o,u=qt(),u!==e&&(C=s,u=m(u)),s=u,s===e&&(s=o,u=Fi(),u!==e&&(C=s,u=h(u)),s=u,s===e&&(s=o,u=Rt(),u!==e&&(C=s,u=v(u)),s=u,s===e&&(s=o,u=Y(),u!==e&&(C=s,u=b()),s=u)))),s}function Rt(){var s,u;return s=o,u=bi(),u!==e&&(C=s,u=A(u)),s=u,s}function bi(){var s,u,l,d,g,S,K,ut;return s=o,u=at(),u!==e?(l=Y(),l!==e?(d=tt(),d!==e?(g=Y(),g!==e?(S=Pi(),S!==e?(K=Y(),K!==e?(ut=tt(),ut!==e?(C=s,u=w(u,d,ut),s=u):(o=s,s=e)):(o=s,s=e)):(o=s,s=e)):(o=s,s=e)):(o=s,s=e)):(o=s,s=e)):(o=s,s=e),s===e&&(s=o,u=at(),u!==e?(l=Y(),l!==e?(d=tt(),d!==e?(C=s,u=E(u,d),s=u):(o=s,s=e)):(o=s,s=e)):(o=s,s=e),s===e&&(s=o,u=at(),u!==e&&(C=s,u=R(u)),s=u)),s}function tt(){var s;return s=Ht(),s===e&&(s=Bi(),s===e&&(s=ji())),s}function rt(){var s;return J.test(t.charAt(o))?(s=t.charAt(o),o++):(s=e,y===0&&x(oe)),s}function It(){var s;return V.test(t.charAt(o))?(s=t.charAt(o),o++):(s=e,y===0&&x(I)),s}function xi(){var s,u;if(s=[],ee.test(t.charAt(o))?(u=t.charAt(o),o++):(u=e,y===0&&x(le)),u!==e)for(;u!==e;)s.push(u),ee.test(t.charAt(o))?(u=t.charAt(o),o++):(u=e,y===0&&x(le));else s=e;return s}function wi(){var s,u;if(s=[],te.test(t.charAt(o))?(u=t.charAt(o),o++):(u=e,y===0&&x(N)),u!==e)for(;u!==e;)s.push(u),te.test(t.charAt(o))?(u=t.charAt(o),o++):(u=e,y===0&&x(N));else s=e;return s}function Si(){var s,u,l,d;if(s=o,F.test(t.charAt(o))?(u=t.charAt(o),o++):(u=e,y===0&&x(re)),u===e&&(u=null),u!==e){if(l=[],ne.test(t.charAt(o))?(d=t.charAt(o),o++):(d=e,y===0&&x(Z)),d!==e)for(;d!==e;)l.push(d),ne.test(t.charAt(o))?(d=t.charAt(o),o++):(d=e,y===0&&x(Z));else l=e;l!==e?(u=[u,l],s=u):(o=s,s=e)}else o=s,s=e;return s}function Ai(){var s,u,l,d;if(s=o,u=[],ie.test(t.charAt(o))?(l=t.charAt(o),o++):(l=e,y===0&&x(H)),l!==e)for(;l!==e;)u.push(l),ie.test(t.charAt(o))?(l=t.charAt(o),o++):(l=e,y===0&&x(H));else u=e;if(u!==e){for(l=[],we.test(t.charAt(o))?(d=t.charAt(o),o++):(d=e,y===0&&x(T));d!==e;)l.push(d),we.test(t.charAt(o))?(d=t.charAt(o),o++):(d=e,y===0&&x(T));l!==e?(u=[u,l],s=u):(o=s,s=e)}else o=s,s=e;return s}function Ci(){var s;return t.substr(o,1).toLowerCase()===j?(s=t.charAt(o),o++):(s=e,y===0&&x(Se)),s}function Ft(){var s;return t.substr(o,1).toLowerCase()===Qe?(s=t.charAt(o),o++):(s=e,y===0&&x(Ye)),s}function $i(){var s;return t.substr(o,1).toLowerCase()===tn?(s=t.charAt(o),o++):(s=e,y===0&&x(rn)),s}function jt(){var s;return t.substr(o,1).toLowerCase()===nn?(s=t.charAt(o),o++):(s=e,y===0&&x(sn)),s}function Li(){var s;return t.substr(o,1).toLowerCase()===an?(s=t.charAt(o),o++):(s=e,y===0&&x(on)),s}function Ts(){var s;return t.substr(o,1).toLowerCase()===un?(s=t.charAt(o),o++):(s=e,y===0&&x(cn)),s}function nt(){var s;return t.substr(o,1).toLowerCase()===ln?(s=t.charAt(o),o++):(s=e,y===0&&x(fn)),s}function it(){var s;return t.substr(o,1).toLowerCase()===dn?(s=t.charAt(o),o++):(s=e,y===0&&x(pn)),s}function _i(){var s;return t.substr(o,1).toLowerCase()===hn?(s=t.charAt(o),o++):(s=e,y===0&&x(gn)),s}function Ei(){var s;return t.substr(o,1).toLowerCase()===mn?(s=t.charAt(o),o++):(s=e,y===0&&x(vn)),s}function st(){var s;return t.substr(o,1).toLowerCase()===yn?(s=t.charAt(o),o++):(s=e,y===0&&x(bn)),s}function Bt(){var s;return t.substr(o,1).toLowerCase()===xn?(s=t.charAt(o),o++):(s=e,y===0&&x(wn)),s}function ki(){var s;return t.charCodeAt(o)===48?(s=Sn,o++):(s=e,y===0&&x(An)),s}function Nt(){var s;return t.charCodeAt(o)===49?(s=Cn,o++):(s=e,y===0&&x($n)),s}function Ut(){var s;return t.charCodeAt(o)===50?(s=Ln,o++):(s=e,y===0&&x(_n)),s}function Pi(){var s;return t.charCodeAt(o)===44?(s=En,o++):(s=e,y===0&&x(kn)),s}function Di(){var s;return t.charCodeAt(o)===58?(s=Pn,o++):(s=e,y===0&&x(Dn)),s}function Ti(){var s;return t.charCodeAt(o)===59?(s=Tn,o++):(s=e,y===0&&x(Mn)),s}function Mi(){var s,u,l;return s=o,u=o,l=wi(),l!==e?u=t.substring(u,o):u=l,u!==e?(l=Ft(),l!==e?(C=s,u=On(u),s=u):(o=s,s=e)):(o=s,s=e),s}function Oi(){var s,u,l,d,g;return s=o,u=ki(),u!==e?(l=st(),l!==e?(d=o,g=xi(),g!==e?d=t.substring(d,o):d=g,d!==e?(C=s,u=Rn(d),s=u):(o=s,s=e)):(o=s,s=e)):(o=s,s=e),s}function Ri(){var s,u,l;return s=o,u=o,l=Si(),l!==e?u=t.substring(u,o):u=l,u!==e?(l=jt(),l===e&&(l=null),l!==e?(C=s,u=In(u),s=u):(o=s,s=e)):(o=s,s=e),s}function fe(){var s,u,l,d,g;if(s=o,u=o,l=[],d=rt(),d!==e)for(;d!==e;)l.push(d),d=rt();else l=e;if(l!==e){for(d=[],g=It();g!==e;)d.push(g),g=It();d!==e?(l=[l,d],u=l):(o=u,u=e)}else o=u,u=e;return u!==e&&(C=s,u=kt()),s=u,s}function Y(){var s,u;for(y++,s=[],u=Vt();u!==e;)s.push(u),u=Vt();return y--,s===e&&(u=e,y===0&&x(Pt)),s}function Vt(){var s,u;return y++,t.charCodeAt(o)===9?(s=Fn,o++):(s=e,y===0&&x(jn)),s===e&&(t.charCodeAt(o)===11?(s=Bn,o++):(s=e,y===0&&x(Nn)),s===e&&(t.charCodeAt(o)===12?(s=Un,o++):(s=e,y===0&&x(Vn)),s===e&&(t.charCodeAt(o)===32?(s=qn,o++):(s=e,y===0&&x(Hn)),s===e&&(t.charCodeAt(o)===160?(s=Wn,o++):(s=e,y===0&&x(zn)),s===e&&(t.charCodeAt(o)===65279?(s=Gn,o++):(s=e,y===0&&x(Xn))))))),y--,s===e&&(u=e,y===0&&x(Pt)),s}function Be(){var s,u;return y++,Zn.test(t.charAt(o))?(s=t.charAt(o),o++):(s=e,y===0&&x(Qn)),y--,s===e&&(u=e,y===0&&x(Jn)),s}function Ii(){var s,u,l,d,g,S;if(y++,s=o,u=Ti(),u!==e){for(l=[],d=o,g=o,y++,S=Be(),y--,S===e?g=void 0:(o=g,g=e),g!==e?(t.length>o?(S=t.charAt(o),o++):(S=e,y===0&&x(Dt)),S!==e?(g=[g,S],d=g):(o=d,d=e)):(o=d,d=e);d!==e;)l.push(d),d=o,g=o,y++,S=Be(),y--,S===e?g=void 0:(o=g,g=e),g!==e?(t.length>o?(S=t.charAt(o),o++):(S=e,y===0&&x(Dt)),S!==e?(g=[g,S],d=g):(o=d,d=e)):(o=d,d=e);l!==e?(u=[u,l],s=u):(o=s,s=e)}else o=s,s=e;return y--,s===e&&(u=e,y===0&&x(Yn)),s}function qt(){var s,u,l;return y++,s=o,u=o,l=Ai(),l!==e?u=t.substring(u,o):u=l,u!==e?(l=Di(),l!==e?(C=s,u=ei(u),s=u):(o=s,s=e)):(o=s,s=e),y--,s===e&&(u=e,y===0&&x(Kn)),s}function Fi(){var s,u,l,d,g,S;return y++,s=o,u=_i(),u!==e?(l=Ei(),l!==e?(d=Li(),d!==e?(g=Y(),g!==e?(S=Ht(),S!==e?(C=s,u=ri(S),s=u):(o=s,s=e)):(o=s,s=e)):(o=s,s=e)):(o=s,s=e)):(o=s,s=e),y--,s===e&&(u=e,y===0&&x(ti)),s}function at(){var s,u,l;if(y++,s=o,u=[],ie.test(t.charAt(o))?(l=t.charAt(o),o++):(l=e,y===0&&x(H)),l!==e)for(;l!==e;)u.push(l),ie.test(t.charAt(o))?(l=t.charAt(o),o++):(l=e,y===0&&x(H));else u=e;return u!==e&&(C=s,u=kt()),s=u,y--,s===e&&(u=e,y===0&&x(ni)),s}function Ht(){var s,u;return y++,s=o,u=Mi(),u!==e&&(C=s,u=si(u)),s=u,s===e&&(s=o,u=Oi(),u!==e&&(C=s,u=ai(u)),s=u,s===e&&(s=o,u=Ri(),u!==e&&(C=s,u=oi(u)),s=u)),y--,s===e&&(u=e,y===0&&x(ii)),s}function ji(){var s,u,l,d,g,S,K;if(y++,s=o,u=fe(),u!==e){for(l=[],d=o,t.substr(o,2)===W?(g=W,o+=2):(g=e,y===0&&x(Ae)),g!==e?(S=fe(),S!==e?(g=[g,S],d=g):(o=d,d=e)):(o=d,d=e);d!==e;)l.push(d),d=o,t.substr(o,2)===W?(g=W,o+=2):(g=e,y===0&&x(Ae)),g!==e?(S=fe(),S!==e?(g=[g,S],d=g):(o=d,d=e)):(o=d,d=e);l!==e?(C=s,u=ci(u,l),s=u):(o=s,s=e)}else o=s,s=e;if(s===e)if(s=o,t.substr(o,2)===W?(u=W,o+=2):(u=e,y===0&&x(Ae)),u!==e)if(l=fe(),l!==e){for(d=[],g=o,t.substr(o,2)===W?(S=W,o+=2):(S=e,y===0&&x(Ae)),S!==e?(K=fe(),K!==e?(S=[S,K],g=S):(o=g,g=e)):(o=g,g=e);g!==e;)d.push(g),g=o,t.substr(o,2)===W?(S=W,o+=2):(S=e,y===0&&x(Ae)),S!==e?(K=fe(),K!==e?(S=[S,K],g=S):(o=g,g=e)):(o=g,g=e);d!==e?(C=s,u=li(l,d),s=u):(o=s,s=e)}else o=s,s=e;else o=s,s=e;return y--,s===e&&(u=e,y===0&&x(ui)),s}function Bi(){var s,u,l,d,g;return y++,s=o,u=o,l=Ci(),l===e&&(l=Ft(),l===e&&(l=$i(),l===e&&(l=jt(),l===e&&(l=o,d=it(),d!==e?(g=Ut(),g!==e?(d=[d,g],l=d):(o=l,l=e)):(o=l,l=e),l===e&&(l=o,d=it(),d!==e?(g=Nt(),g!==e?(d=[d,g],l=d):(o=l,l=e)):(o=l,l=e),l===e&&(l=it(),l===e&&(l=o,d=st(),d!==e?(g=Bt(),g!==e?(d=[d,g],l=d):(o=l,l=e)):(o=l,l=e),l===e&&(l=st(),l===e&&(l=Bt(),l===e&&(l=o,d=nt(),d!==e?(g=Nt(),g!==e?(d=[d,g],l=d):(o=l,l=e)):(o=l,l=e),l===e&&(l=o,d=nt(),d!==e?(g=Ut(),g!==e?(d=[d,g],l=d):(o=l,l=e)):(o=l,l=e),l===e&&(l=nt())))))))))))),l!==e?u=t.substring(u,o):u=l,u!==e?(l=o,y++,d=rt(),y--,d===e?l=void 0:(o=l,l=e),l!==e?(C=s,u=di(u),s=u):(o=s,s=e)):(o=s,s=e),y--,s===e&&(u=e,y===0&&x(fi)),s}var k=(er(),zt(Kt));function Ni(s,u){return s.map(function(l){return l[u]})}function ot(s,u,l){return[s].concat(Ni(u,l))}function P(){return{...hi()}}if(je=n(),je!==e&&o===t.length)return je;throw je!==e&&o<t.length&&x(mi()),Mt(Ke,z<t.length?t.charAt(z):null,z<t.length?Ce(z,z+1):Ce(z,z))}tr.exports={SyntaxError:ue,parse:ss}});var ks={};Wt(ks,{RCASMWorker:()=>Et,create:()=>Es});var se={a:0,d:1},Xi={a:0,b:1,m:2,j:3},lt={a:0,b:1,c:2,d:3},$;(function(t){t[t.AluDst=0]="AluDst",t[t.ClrTgt=1]="ClrTgt",t[t.GtoTgt=2]="GtoTgt",t[t.LitOpc=3]="LitOpc",t[t.MovDstSrc=4]="MovDstSrc",t[t.SetTgtVal=5]="SetTgtVal"})($||($={}));var Gt={add:{op:128|1,pf:$.AluDst,p1:{cs:se,op:function(t){return t<<3}},p2:null},inc:{op:128|2,pf:$.AluDst,p1:{cs:se,op:function(t){return t<<3}},p2:null},and:{op:128|3,pf:$.AluDst,p1:{cs:se,op:function(t){return t<<3}},p2:null},orr:{op:128|4,pf:$.AluDst,p1:{cs:se,op:function(t){return t<<3}},p2:null},eor:{op:128|5,pf:$.AluDst,p1:{cs:se,op:function(t){return t<<3}},p2:null},cmp:{op:128|5,pf:$.AluDst,p1:{cs:se,op:function(t){return t<<3}},p2:null},not:{op:128|6,pf:$.AluDst,p1:{cs:se,op:function(t){return t<<3}},p2:null},rol:{op:128|7,pf:$.AluDst,p1:{cs:se,op:function(t){return t<<3}},p2:null},mov:{op:0|0,pf:$.MovDstSrc,p1:{cs:lt,op:function(t){return t<<3}},p2:{cs:lt,op:function(t){return t}}},clr:{op:0|0,pf:$.ClrTgt,p1:{cs:lt,op:function(t){return t<<3|t}},p2:null},ldi:{op:0|0,pf:$.SetTgtVal,p1:{cs:Xi,op:function(t){return((t&2)===2?192:64)|t<<5}},p2:{cs:null,op:function(t){return t}}},jmp:{op:192|38,pf:$.GtoTgt,p1:null,p2:null},jsr:{op:192|39,pf:$.GtoTgt,p1:null,p2:null},bne:{op:192|34,pf:$.GtoTgt,p1:null,p2:null},beq:{op:192|36,pf:$.GtoTgt,p1:null,p2:null},bcs:{op:192|40,pf:$.GtoTgt,p1:null,p2:null},bmi:{op:192|48,pf:$.GtoTgt,p1:null,p2:null},blt:{op:192|48,pf:$.GtoTgt,p1:null,p2:null},ble:{op:192|52,pf:$.GtoTgt,p1:null,p2:null},opc:{op:0|0,pf:$.LitOpc,p1:{cs:null,op:function(t){return t}},p2:null}},Xt=[["clr a","mov a,b","mov a,c","mov a,d",null,null,null,null,"mov b,a","clr b","mov b,c","mov b,d",null,null,null,null],["mov c,a","mov c,b","clr c","mov c,d",null,null,null,null,"mov d,a","mov d,b","mov d,c","clr d",null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["ldi a,0","ldi a,1","ldi a,2","ldi a,3","ldi a,4","ldi a,5","ldi a,6","ldi a,7","ldi a,8","ldi a,9","ldi a,10","ldi a,11","ldi a,12","ldi a,13","ldi a,14","ldi a,15"],["ldi a,-16","ldi a,-15","ldi a,-14","ldi a,-13","ldi a,-12","ldi a,-11","ldi a,-10","ldi a,-9","ldi a,-8","ldi a,-7","ldi a,-6","ldi a,-5","ldi a,-4","ldi a,-3","ldi a,-2","ldi a,-1"],["ldi b,0","ldi b,1","ldi b,2","ldi b,3","ldi b,4","ldi b,5","ldi b,6","ldi b,7","ldi b,8","ldi b,9","ldi b,10","ldi b,11","ldi b,12","ldi b,13","ldi b,14","ldi b,15"],["ldi b,-16","ldi b,-15","ldi b,-14","ldi b,-13","ldi b,-12","ldi b,-11","ldi b,-10","ldi b,-9","ldi b,-8","ldi b,-7","ldi b,-6","ldi b,-5","ldi b,-4","ldi b,-3","ldi b,-2","ldi b,-1"],["clr a","add","inc","and","orr","eor","not","rol","clr d","add d","inc d","and d","orr d","eor d","not d","rol d"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["ldi m,",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["ldi j,",null,"bne",null,"beq",null,"jmp","jsr","bcs",null,null,null,null,null,null,null],["blt","jlt",null,null,"ble",null,null,null,null,null,null,null,null,null,null,null]],Jt=function(t){switch(!0){case(t&192)===0:return{class:"MOV8",cycles:1};case(t&192)===4:return{class:"SETAB",cycles:1};case(t&240)===128:return{class:"ALU",cycles:1};case(t&192)===192:return{class:"GOTO",cycles:3};default:return{class:"MISC",cycles:1}}};function B(t){return t.toString(16).padStart(4,"0")}var ft=function(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],i=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},Ne=function(t,r){var e=typeof Symbol=="function"&&t[Symbol.iterator];if(!e)return t;var i=e.call(t),n,a=[],c;try{for(;(r===void 0||r-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(p){c={error:p}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(c)throw c.error}}return a},Ue=function(){function t(r,e,i,n){this.start=r,this.end=e,this.inferStart=i,this.id=n,this.blocks=[{start:r,binary:[]}],this.curBlock=this.blocks[0]}return t.prototype.setCurrentPC=function(r){var e=void 0;if(this.inferStart&&this.blocks.length===1&&this.blocks[0].binary.length===0)this.start=r;else{var i=this.end!==void 0?"$".concat(B(this.end)):"",n="Segment address range: $".concat(B(this.start),"-").concat(i);r<this.start?e="".concat(n,".  Cannot set program counter to a lower address $").concat(B(r),"."):this.end!==void 0&&r>this.end?e="".concat(n,".  Trying to set program counter to $").concat(B(r)," -- it is past segment end ").concat(i,"."):this.blocks.length===1&&this.blocks[0].binary.length===0&&(this.start=r)}var a={start:r,binary:[]},c=this.blocks.push(a);return this.curBlock=this.blocks[c-1],e},t.prototype.empty=function(){return this.blocks.every(function(r){return r.binary.length===0})},t.prototype.currentPC=function(){return this.curBlock.start+this.curBlock.binary.length},t.prototype.emit=function(r){if(this.currentPC()<this.start||this.end!==void 0&&this.currentPC()>this.end){var e=this.end!==void 0?"$".concat(B(this.end)):"",i=this.start!==void 0?"$".concat(B(this.start)):"";return"Segment overflow at $".concat(B(this.currentPC()),".  Segment address range: ").concat(i,"-").concat(e)}this.curBlock.binary.push(r)},t.prototype.formatRange=function(){var r=this.end!==void 0?"$".concat(B(this.end)):"",e=this.start!==void 0?"$".concat(B(this.start)):"";return"".concat(e,"-").concat(r)},t.prototype.overlaps=function(r){var e=this.start,i=r.start,n=this.end!==void 0?this.end:this.currentPC(),a=r.end!==void 0?r.end:r.currentPC();return e<i?i<=n:a>=e},t}();function Zt(t){var r,e,i=[];try{for(var n=ft(t),a=n.next();!a.done;a=n.next()){var c=Ne(a.value,2),p=c[0],m=c[1],h=m.blocks.filter(function(b){return b.binary.length!==0}).sort(function(b,A){return b.start-A.start});if(h.length!==0){var v=new Ue(m.start,m.end,m.inferStart,i.length-1);v.blocks=h,v.curBlock=h[h.length-1],i.push([p,v])}}}catch(b){r={error:b}}finally{try{a&&!a.done&&(e=n.return)&&e.call(n)}finally{if(r)throw r.error}}return i}function Qt(t){var r,e,i,n,a=Zt(t);if(a.length===0)return{startPC:0,binary:Uint8Array.from([])};for(var c=Ne(a[0],2),p=c[0],m=c[1],h=m.blocks[0],v=m.blocks[m.blocks.length-1],b=h.start,A=v.start+v.binary.length,w=1;w<a.length;w++){var E=a[w][1],R=E.blocks[0].start,J=E.curBlock.start+E.curBlock.binary.length;b=Math.min(R,b),A=Math.max(J,A)}var oe=new Uint8Array(A);try{for(var V=ft(a),I=V.next();!I.done;I=V.next()){var ee=Ne(I.value,2),le=ee[0],te=ee[1];try{for(var N=(i=void 0,ft(te.blocks)),F=N.next();!F.done;F=N.next())for(var re=F.value,w=0;w<re.binary.length;w++)oe[re.start+w]=re.binary[w]}catch(ne){i={error:ne}}finally{try{F&&!F.done&&(n=N.return)&&n.call(N)}finally{if(i)throw i.error}}}}catch(ne){r={error:ne}}finally{try{I&&!I.done&&(e=V.return)&&e.call(V)}finally{if(r)throw r.error}}return{startPC:b,binary:oe.slice(b)}}function Yt(t){var r=Zt(t).sort(function(e,i){return e[1].start-i[1].start});return r.map(function(e){var i=Ne(e,2),n=i[0],a=i[1],c=a.blocks.map(function(p){return{start:p.start,end:p.start+p.binary.length-1}});return{name:n,blocks:c}})}var q=function(){return q=Object.assign||function(t){for(var r,e=1,i=arguments.length;e<i;e++){r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},q.apply(this,arguments)},dt=function(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],i=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},ce=function(t,r){var e=typeof Symbol=="function"&&t[Symbol.iterator];if(!e)return t;var i=e.call(t),n,a=[],c;try{for(;(r===void 0||r-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(p){c={error:p}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(c)throw c.error}}return a},de=function(t,r,e){if(e||arguments.length===2)for(var i=0,n=r.length,a;i<n;i++)(a||!(i in r))&&(a||(a=Array.prototype.slice.call(r,0,i)),a[i]=r[i]);return t.concat(a||Array.prototype.slice.call(r))},ar=rr();function nr(t){return{value:t,errors:!0,completeFirstPass:!1}}function pt(t,r){return{value:t,errors:!1,completeFirstPass:r}}function ir(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.some(function(e){return e!==void 0&&e.errors})}var as=function(){function t(r,e){this.syms=new Map,this.parent=null,this.children=new Map,this.parent=r,this.name=e}return t.prototype.findSymbol=function(r){for(var e=this;e!==null;e=e.parent){var i=e.syms.get(r);if(i!==void 0)return i}},t.prototype.findSymbolPath=function(r){if(r.length===1)return this.findSymbol(r[0]);for(var e=this;e.children.get(r[0])===void 0;)if(e=e.parent,e===null)return;for(var i=0;i<r.length-1;i++)if(e=e.children.get(r[i]),e===void 0)return;return e.syms.get(r[r.length-1])},t.prototype.addSymbol=function(r,e,i){this.syms.set(r,q(q({},e),{seen:i}))},t.prototype.updateSymbol=function(r,e,i){for(var n=this;n!==null;n=n.parent){var a=n.syms.get(r);if(a!==void 0){n.syms.set(r,q(q({},e),{seen:i}));return}}},t}(),os=function(){function t(){this.passCount=0,this.root=new as(null,""),this.curSymtab=this.root,this.anonScopeCount=0}return t.prototype.startPass=function(r){this.curSymtab=this.root,this.anonScopeCount=0,this.passCount=r},t.prototype.findPath=function(r,e){return e?this.root.findSymbolPath(r):this.curSymtab.findSymbolPath(r)},t.prototype.findQualifiedSym=function(r,e){return this.findPath(r,e)},t.prototype.symbolSeen=function(r){var e=this.curSymtab.syms.get(r);return e!==void 0?e.seen===this.passCount:!1},t.prototype.declareLabelSymbol=function(r,e,i){var n=r.name,a=r.loc,c=this.curSymtab.syms.get(n);if(c===void 0){var p={type:"label",segment:i,data:pt({addr:e,loc:a},!1)};return this.curSymtab.addSymbol(n,p,this.passCount),!1}if(c.type!=="label")throw new Error("ICE: declareLabelSymbol should be called only on labels");var m=c;if(m.data.value.addr!==e){var h={type:"label",segment:i,data:q(q({},c.data),{value:q(q({},c.data.value),{addr:e})})};return this.curSymtab.updateSymbol(n,h,this.passCount),!0}return this.curSymtab.updateSymbol(n,c,this.passCount),!1},t.prototype.dumpLabels=function(r,e){var i,n,a,c,p,m,h={};try{for(var v=dt(e),b=v.next();!b.done;b=v.next()){var A=ce(b.value,2),w=A[0],E=A[1];h[E.id]=w}}catch(T){i={error:T}}finally{try{b&&!b.done&&(n=v.return)&&n.call(v)}finally{if(i)throw i.error}}var R=[],J=function(T,j){if(T!==void 0){var Se=de(de([],ce(T),!1),[j.name],!1);R.push({path:Se,sym:j})}else R.push({path:[],sym:j})};J(void 0,this.root);for(var oe=[];R.length>0;){var E=R.pop();try{for(var V=(a=void 0,dt(E.sym.syms)),I=V.next();!I.done;I=V.next()){var ee=ce(I.value,2),le=ee[0],te=ee[1];te.type==="label"&&oe.push({path:de(de([],ce(E.path),!1),[le],!1),addr:te.data.value.addr,size:0,segmentName:h[te.segment.id]})}}catch(j){a={error:j}}finally{try{I&&!I.done&&(c=V.return)&&c.call(V)}finally{if(a)throw a.error}}try{for(var N=(p=void 0,dt(E.sym.children)),F=N.next();!F.done;F=N.next()){var re=ce(F.value,2),le=re[0],ne=re[1];J(E.path,ne)}}catch(j){p={error:j}}finally{try{F&&!F.done&&(m=N.return)&&m.call(N)}finally{if(p)throw p.error}}}var Z=oe.sort(function(T,j){return T.addr-j.addr}),ie=Z.length;if(ie>0){for(var H=1;H<ie;H++)Z[H-1].size=Z[H].addr-Z[H-1].addr;var we=Z[ie-1];we.size=r-we.addr}return Z.map(function(T){var j=T.path,Se=T.addr,Qe=T.size,Ye=T.segmentName;return{name:j.join("::"),addr:Se,size:Qe,segmentName:Ye}})},t}();function sr(t){var r=typeof t;return r==="object"&&t instanceof Array?"array":r}function us(t){return"".concat(t.absolute?"::":"").concat(t.path.join("::"))}var cs=function(){function t(){var r=this;this.curSegmentName="",this.curSegment=new Ue(0,0,!1,0),this.pass=0,this.needPass=!1,this.scopes=new os,this.segments=[],this.errorList=[],this.warningList=[],this.errors=function(){return r.formatErrors(r.errorList,"error")},this.warnings=function(){return r.formatErrors(r.warningList,"warning")}}return t.prototype.prg=function(){var r=Qt(this.segments),e=r.startPC,i=r.binary,n=e&255,a=e>>8&255;return Uint8Array.from(de([n,a],ce(i),!1))},t.prototype.anyErrors=function(){return this.errorList.length!==0},t.prototype.formatErrors=function(r,e){var i=new Set(r.map(function(n){return JSON.stringify(n)}));return de([],ce(i),!1).map(function(n){var a=JSON.parse(n),c=a.loc,p=a.msg,m="<unknown>:1:1: ".concat(e,": ").concat(p);return c&&(m="".concat(c.start.line,":").concat(c.start.column,": ").concat(e,": ").concat(p)),{loc:c,msg:p,formatted:m}})},t.prototype.addError=function(r,e){this.errorList.push({msg:r,loc:e})},t.prototype.addWarning=function(r,e){this.warningList.push({msg:r,loc:e})},t.prototype.startPass=function(r){this.pass=r,this.needPass=!1,this.errorList=[],this.scopes.startPass(r),this.segments=[];var e=this.newSegment("default",0,void 0,!0);this.setCurrentSegment({type:"segment",data:e},"default")},t.prototype.setCurrentSegment=function(r,e){this.curSegmentName=e,this.curSegment=r.data},t.prototype.newSegment=function(r,e,i,n){var a=new Ue(e,i,n,this.segments.length-1);return this.segments.push([r,a]),a},t.prototype.getPC=function(){return this.curSegment.currentPC()},t.prototype.evalExprType=function(r,e,i){var n=this.evalExpr(r),a=n.errors,c=n.value,p=n.completeFirstPass;return!a&&typeof c!==e?(this.addError("Expecting ".concat(i," to be '").concat(e,"' type, got '").concat(sr(c),"'"),r.loc),{errors:!0,completeFirstPass:p,value:c}):n},t.prototype.evalExprToInt=function(r,e){return this.evalExprType(r,"number",e)},t.prototype.evalExpr=function(r){switch(r.type){case"literal":return pt(r.value,!0);case"ident":throw new Error("should not see an ident here -- if you do, it is probably a wrong type node in parser");case"qualified-ident":{var e=this.scopes.findQualifiedSym(r.path,r.absolute);if(e===void 0)return this.pass>=1?(this.addError("Undefined symbol '".concat(us(r),"'"),r.loc),nr(0)):(this.needPass=!0,pt(0,!1));switch(e.type){case"label":return{errors:e.data.errors,value:e.data.value.addr,completeFirstPass:e.seen===this.pass}}break}default:break}throw new Error("should be unreachable")},t.prototype.emit=function(r){var e=this.curSegment.emit(r);e!==void 0&&this.addError(e,this.lineLoc)},t.prototype.assembleAluInstr=function(r,e){e.p2&&this.addWarning("Parameter not required",e.p2.loc);var i=r.op;if(e.p1&&r.p1){var n=this.checkRegister(e.p1,r.p1);if(n===void 0)return;i|=r.p1.op(n)}this.emit(i)},t.prototype.assembleClrInstr=function(r,e){e.p2&&this.addWarning("Parameter not required",e.p2.loc);var i=r.op;if(!e.p1||!r.p1){this.addError("Parameter required",e.loc);return}var n=this.checkRegister(e.p1,r.p1);n!==void 0&&(i|=r.p1.op(n),this.emit(i))},t.prototype.assembleMovInstr=function(r,e){if(!e.p1||!r.p1||!e.p2||!r.p2){this.addError("Two parameters required",e.loc);return}var i=r.op,n=this.checkRegister(e.p1,r.p1);if(n!==void 0){i|=r.p1.op(n);var a=this.checkRegister(e.p2,r.p2);a!==void 0&&(i|=r.p2.op(a),this.emit(i))}},t.prototype.assembleLitOpc=function(r,e){e.p2&&this.addWarning("Parameter not required",e.p2.loc);var i=r.op;if(!e.p1||!r.p1){this.addError("Parameter required",e.loc);return}var n=this.checkLiteral(e.p1,0,255);n!==void 0&&(i|=r.p1.op(n),this.emit(i))},t.prototype.assembleSetInstr=function(r,e){if(!e.p1||!r.p1||!e.p2||!r.p2){this.addError("Two parameters required",e.loc);return}var i=r.op,n=this.checkRegister(e.p1,r.p1);if(n!==void 0){if(i|=r.p1.op(n),n<=16){var a=this.checkLiteral(e.p2,-16,15);if(a===void 0)return;i|=r.p2.op(a)}this.emit(i)}},t.prototype.checkRegister=function(r,e){if(r.type!=="register")this.addError("Register required",r.loc);else{var i=e.cs[r.value.toLowerCase()];return i===void 0&&this.addError("Invalid register - choose one of [".concat(Object.keys(e.cs).join("|"),"]"),r.loc),i}},t.prototype.checkLiteral=function(r,e,i){if(r.type!=="literal")this.addError("Literal required",r.loc);else{var n=r.value;if(n<e||n>i){var a="";switch(r.ot){case"b":var c=i.toString(2),p=("0".repeat(c.length)+e.toString(2)).slice(-c.length);a="".concat(p,"b and ").concat(c,"b");break;case"h":var m=i.toString(16).toUpperCase(),h=("0".repeat(m.length)+e.toString(16).toUpperCase()).slice(-m.length);a="0x".concat(h," and 0x").concat(m);break;default:a="".concat(e," and ").concat(i)}this.addError("Literal out of range (must be between ".concat(a,")"),r.loc)}else return n}},t.prototype.assembleBranch=function(r,e){if(e.p2&&this.addWarning("Parameter not required",e.p2.loc),!e.p1){this.addError("Parameter required",e.loc);return}if(e.p1.type!=="qualified-ident"){this.addError("Identifier required",e.p1.loc);return}var i=this.evalExpr(e.p1);if(!ir(i)){if(typeof i.value!="number"){this.addError("Expecting branch label to evaluate to integer, got ".concat(sr(i.value)),e.p1.loc);return}var n=i.value;this.emit(r.op),this.emit((n&65280)>>8),this.emit(n&255)}},t.prototype.handleSetPC=function(r){var e=this.evalExprToInt(r,"pc");if(!ir(e)){var i=e.value,n=e.completeFirstPass;if(!n){this.addError("Value for new program counter must evaluate to a value in the first pass",r.loc);return}!this.curSegment.empty()&&this.curSegment.currentPC()>i&&this.addError("Cannot set program counter to a smaller value than current (current: $".concat(B(this.curSegment.currentPC()),", trying to set $").concat(B(i),")"),r.loc);var a=this.curSegment.setCurrentPC(i);a!==void 0&&this.addError(a,r.loc)}},t.prototype.checkDirectives=function(r,e){switch(r.type){case"setpc":{this.handleSetPC(r.pc);break}default:this.addError("unknown directive ".concat(r.type," "),r.loc);return}},t.prototype.assembleLines=function(r){var e=this;if(!(r===null||r.length===0)&&r.length!==0){for(var i=function(m){for(var h=0;h<m.length;h++)e.assembleLine(m[h])},n=0;n<r.length;){var a=r[n],c=a.label,p=a.stmt;if(c===null&&p===null)n++;else break}if(!(n>=r.length))return i(r)}},t.prototype.checkAndDeclareLabel=function(r){if(this.scopes.symbolSeen(r.name))this.addError("Symbol '".concat(r.name,"' already defined"),r.loc);else{var e=this.scopes.declareLabelSymbol(r,this.getPC(),this.curSegment);e&&(this.needPass=!0)}},t.prototype.assembleLine=function(r){if(this.lineLoc=r.loc,!(r.label===null&&r.stmt===null)&&(r.label!==null&&this.checkAndDeclareLabel(r.label),r.stmt!==null)){if(r.stmt.type!=="insn"){this.checkDirectives(r.stmt,r.label===null?null:r.label.name);return}var e=r.stmt,i=Gt[e.mnemonic.toLocaleLowerCase()];if(i!==void 0)switch(i.pf){case $.AluDst:this.assembleAluInstr(i,e);break;case $.ClrTgt:this.assembleClrInstr(i,e);break;case $.MovDstSrc:this.assembleMovInstr(i,e);break;case $.LitOpc:this.assembleLitOpc(i,e);break;case $.SetTgtVal:this.assembleSetInstr(i,e);break;case $.GtoTgt:this.assembleBranch(i,e);break;default:this.addError("Couldn't encode instruction '".concat(e.mnemonic," '"),r.loc)}else this.addError("Unknown mnemonic '".concat(e.mnemonic,"'"),e.loc)}},t.prototype.assemble=function(r){try{var e=ar.parse(r.toString());e!==void 0&&e.lines&&this.assembleLines(e.lines)}catch(i){if("name"in i&&i.name==="SyntaxError")this.addError("Syntax error: ".concat(i.message),q({},i.location));else{if("name"in i&&i.name==="semantic")return;throw i}}},t.prototype.dumpLabels=function(){return this.scopes.dumpLabels(this.getPC(),this.segments)},t.prototype.collectSegmentInfo=function(){return Yt(this.segments)},t}();function $e(t){try{return ar.parse(t.toString())}catch{return}}function ht(t){var r=new cs,e=0;do{if(r.startPass(e),r.assemble(t),e>0&&r.anyErrors())return{prg:Uint8Array.from([]),labels:[],segments:[],errors:r.errors(),warnings:r.warnings()};e+=1}while(r.needPass);return{prg:r.prg(),errors:r.errors(),warnings:r.warnings(),labels:r.dumpLabels(),segments:r.collectSegmentInfo()}}function Ve(t){return"".concat(t.toString(16).toUpperCase().padStart(2,"0"))}function or(t){return"".concat(t.toString(16).toUpperCase().padStart(4,"0"))}function ls(t,r){var e=0,i=t.length,n=[];for(e=0;e<i;e+=r){var a=t.slice(e,e+r);n.push(a)}return n}var Vs=function(){function t(r){var e=this;this.buf=r,this.outputPadChars="     ",this.outputBytesPerLine=1,this.bytes={startPC:0,bytes:[]},this.byte=function(){var i=e.buf[e.curOffs];return e.curOffs++,i},this.print=function(i,n,a,c){e.flushBytes();var p=Ve(n[0]),m=n.length>=2?Ve(n[1]):"  ",h=n.length>=3?Ve(n[2]):"  ",v="".concat(or(i),": ").concat(p," ").concat(m," ").concat(h).concat(e.outputPadChars).concat(a);e.output.push(v)},this.output=[],this.curAddr=r[0]+(r[1]<<8),this.curOffs=2}return t.prototype.flushBytes=function(){for(var r=ls(this.bytes.bytes,this.outputBytesPerLine),e=this.bytes.startPC,i=0;i<r.length;i++,e+=this.outputBytesPerLine){var n=r[i],a=n.map(function(c){return Ve(c)}).join(" ");this.output.push("".concat(or(e),": ").concat(a))}this.bytes.bytes=[]},t.prototype.disSingle=function(r,e,i){var n=this.curAddr;this.print(n,[e],r,i.cycles.toString())},t.prototype.disTriple=function(r,e,i){var n=this.curAddr,a=this.byte(),c=this.byte();this.print(n,[e,a,c],r,i.cycles.toString())},t.prototype.disUnknown=function(r){this.bytes.bytes.length!==0?this.bytes.bytes.push(r):(this.bytes.bytes=[r],this.bytes.startPC=this.curAddr)},t.prototype.disassemble=function(){for(var r=this.buf.byteLength,e=function(p){return!0},i=this.curOffs;this.curOffs<r;){this.curAddr+=this.curOffs-i,i=this.curOffs;var n=this.byte(),a=Xt[(n&240)>>4][n&15];if(a!==null){var c=Jt(n);if(c.cycles===3){this.disTriple(a,n,c);continue}else{this.disSingle(a,n,c);continue}}else this.disUnknown(n)}return this.flushBytes(),this.output},t}();var _e=function(){var t=function(r,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},t(r,e)};return function(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");t(r,e);function i(){this.constructor=r}r.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),U;(function(t){t[t.Program=0]="Program",t[t.Line=1]="Line",t[t.Label=2]="Label",t[t.LabelRef=3]="LabelRef",t[t.Instruction=4]="Instruction"})(U||(U={}));var Le;(function(t){t[t.Label=0]="Label"})(Le||(Le={}));function mt(t,r){var e=null;return!t||r<t.offset||r>t.end?null:(t.accept(function(i){return i.offset===-1&&i.length===-1?!0:i.offset<=r&&i.end>=r?(e?i.length<=e.length&&(e=i):e=i,!0):!1}),e)}var Ee=function(){function t(r,e){var i,n;this.nodeType=e,this.parent=null,this.offset=(i=r==null?void 0:r.loc.start.offset)!==null&&i!==void 0?i:0,this.length=((n=r==null?void 0:r.loc.end.offset)!==null&&n!==void 0?n:0)-this.offset}return Object.defineProperty(t.prototype,"end",{get:function(){return this.offset+this.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.nodeType},enumerable:!1,configurable:!0}),t.prototype.getTextProvider=function(){for(var r=this;r&&!r.textProvider;)r=r.parent;return r?r.textProvider:function(){return"unknown"}},t.prototype.getText=function(){return this.getTextProvider()(this.offset,this.length)},t.prototype.matches=function(r){return this.length===r.length&&this.getTextProvider()(this.offset,this.length)===r},t.prototype.accept=function(r){if(r(this)&&this.children)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];n.accept(r)}},t.prototype.acceptVisitor=function(r){this.accept(r.visitNode.bind(r))},t.prototype.adoptChild=function(r){r.parent=this;var e=this.children;return e||(e=this.children=[]),e.push(r),r},t}();var ur=function(t){_e(r,t);function r(e){var i=this,n;return i=t.call(this,e,U.Program)||this,(n=e==null?void 0:e.lines)===null||n===void 0||n.forEach(function(a){return i.adoptChild(new fs(a))}),i}return r}(Ee);var fs=function(t){_e(r,t);function r(e){var i=t.call(this,e,U.Line)||this;if(e.label&&i.adoptChild(new pe(e.label)),e.stmt)switch(e.stmt.type){case"insn":i.adoptChild(new ds(e.stmt));break}return i}return r}(Ee),pe=function(t){_e(r,t);function r(e){var i=t.call(this,e,U.Label)||this;return i.length--,i}return r}(Ee);var ds=function(t){_e(r,t);function r(e){var i=t.call(this,e,U.Instruction)||this,n=function(a){switch(a.type){case"qualified-ident":i.adoptChild(new vt(a))}};return e.p1&&n(e.p1),e.p2&&n(e.p2),i}return r}(Ee),vt=function(t){_e(r,t);function r(e){return t.call(this,e,U.LabelRef)||this}return r}(Ee);var cr=function(){function t(){}return t.prototype.parseProgram=function(r){var e=r.version,i=r.getText(),n=$e(r.getText()),a=new ur(n),c=function(p,m){if(r.version!==e)throw new Error("Underlying model has changed, AST is no longer valid");return i.substr(p,m)};return a.textProvider=c,a},t}();var lr={version:1,mnemonics:[{name:"add",class:"ALU",summary:"Arithmetic Add",description:"Adds the contents of register B and C (B+C) placing the result in register A or D.",synopsis:"{0} = B + C",syntax:"[ a | d ]"},{name:"and",class:"ALU",summary:"Logic And",description:"Performs a bitwise AND operation on register B and C (B&C) placing the result in register A or D.",synopsis:"{0} = B & C",syntax:"[ a | d ]"},{name:"bcs",class:"GOTO",summary:"Branch if Carry Set",snippet:"bcs ${1:label}",description:"Jumps to the given address if the carry flag is set.",synopsis:"PC = {0} [if CY]",syntax:"<label>"},{name:"beq",class:"GOTO",summary:"Branch if Equal/Zero",snippet:"beq ${1:label}",description:"Jumps to the given address if the zero flag is set (equal).",synopsis:"PC = {0} [if Z]",syntax:"<label>"},{name:"ble",class:"GOTO",summary:"Branch if Less Than or Equal (Sign+Zero)",snippet:"ble ${1:label}",description:"Jumps to the given address if the sign or zero flag is set (less than or equal).",synopsis:"PC = {0} [if S or Z]",syntax:"<label>"},{name:"blt",class:"GOTO",summary:"Branch if Less Than (Sign)",snippet:"blt ${1:label}",description:"Jumps to the given address if the sign flag is set (less than).",synopsis:"PC = {0} [if S]",syntax:"<label>"},{name:"bmi",class:"GOTO",summary:"Branch if Minus/Sign",snippet:"bmi ${1:label}",description:"Jumps to the given address if the sign flag is set (negative).",synopsis:"PC = {0} [if S]",syntax:"<label>"},{name:"bne",class:"GOTO",summary:"Branch if Not Equal/Zero",snippet:"bne ${1:label}",description:"Jumps to the given address if the zero flag is not set (not equal).",synopsis:"PC = {0} [if not Z]",syntax:"<label>"},{name:"clr",class:"MOV8",summary:"Zero Value",description:"Clears the content (=0) of a given 8-bit register.",synopsis:"{0} = 0",syntax:"<target>{a,d}"},{name:"cmp",class:"ALU",summary:"Compare (Logic Xor)",description:"Compares the values in register B and C setting the zero flag if the same (affects register A or D) (equivalent to eor).",synopsis:"{0} = B != C",syntax:"[ a | d ]"},{name:"eor",class:"ALU",summary:"Logic Xor",description:"Performs a bitwise XOR operation on register B and C (B^C) placing the result in register A or D.",synopsis:"{0} = B ^ C",syntax:"[ a | d ]"},{name:"inc",class:"ALU",summary:"Increment",description:"Increments contents of register B placing the result in register A or D",synopsis:"{0} = B + 1",syntax:"[ a | d ]"},{name:"jmp",class:"GOTO",summary:"Jump to Label",snippet:"jmp ${1:label}",description:"Unconditionally jumps to the given address.",synopsis:"PC = {0}",syntax:"<label>"},{name:"jsr",class:"GOTO",summary:"Call Subroutine (Jump and Link)",snippet:"jsr ${1:label}",description:"Calls the subroutine at the given address.",synopsis:"XY = PC, PC = {0}",syntax:"<label>"},{name:"ldi",class:"SETAB",summary:"Load Immediate",snippet:"ldi ${1:a},${2:0}",description:"Loads an 8-bit value in to register A/B or a 16-bit value in to register M/J.",synopsis:"{0} = {1}",syntax:"[ <target>{a|b} , <value>{-16,15} ] | [ <target>{m|j} , [ <value>{0x0000,0xFFFF} | <label> ] ]"},{name:"mov",class:"MOV8",summary:"Copy Register to Register",snippet:"mov ${1:b},${2:a}",description:"Copies the content of one 8-bit register to another.",synopsis:"{0} = {1}",syntax:"<destination>{a,d} , <source>{a,d}"},{name:"not",class:"ALU",summary:"Logic Not",description:"Performs a bitwise NOT operation on register B (~B) placing the result in register A or D.",synopsis:"{0} = ~B",syntax:"[ a | d ]"},{name:"opc",class:void 0,summary:"Literal Opcode",snippet:"opc ${1:opcode}",description:"Performs the given machine opcode directly.",syntax:"[ <opcode>{0x00,0xFF} | <opcode>{0b00000000,0b11111111} ]"},{name:"orr",class:"ALU",summary:"Logic Or",description:"Performs a bitwise OR operation on register B and C (B|C) placing the result in register A or D.",synopsis:"{0} = B | C",syntax:"[ a | d ]"},{name:"rol",class:"ALU",summary:"Bitwise Circular Shift Left",description:"Performs a bitwise left rotation on register B (<<B) placing the result in register A or D.",synopsis:"{0} = <<B",syntax:"[ a | d ]"}]};function fr(t){return Object.keys(t).map(function(r){return t[r]})}function he(t){return typeof t<"u"}var dr=function(){function t(r){this.dataProviders=r,this._mnemonicSet={},this._mnemonics=[],this.collectData()}return t.prototype.collectData=function(){var r=this;this.dataProviders.forEach(function(e){e.provideMnemonics().forEach(function(i){r._mnemonicSet[i.name]||(r._mnemonicSet[i.name]=i)})}),this._mnemonics=fr(this._mnemonicSet)},t.prototype.getMnemonic=function(r){return this._mnemonicSet[r]},t.prototype.getMnemonics=function(){return this._mnemonics},t}();var pr=function(){function t(r){this._mnemonics=[],this.addData(r)}return t.prototype.provideMnemonics=function(){return this._mnemonics},t.prototype.addData=function(r){r.mnemonics&&(this._mnemonics=this._mnemonics.concat(r.mnemonics))},t}();function gr(t,r){return r?{kind:"markdown",value:ms(t)}:{kind:"plaintext",value:gs(t)}}function gs(t){if(!t.description||t.description==="")return"";if(typeof t.description!="string")return t.description.value;var r="";return r+=t.description,"syntax"in t&&(r+=`

Syntax: `.concat(t.syntax)),r}function ms(t){if(!t.description||t.description==="")return"";var r="";return typeof t.description=="string"?r+=t.description:r=t.description.value,"syntax"in t&&(r+=`

Syntax: \``.concat(t.syntax,"`")),r}function mr(t,r,e){return e?{kind:"markdown",value:hr(ys(t),r)}:{kind:"plaintext",value:hr(vs(t),r)}}function hr(t,r){if(!r||r.length===0)return t;for(var e=0;e<r.length;e++)t=t.replace("{".concat(e,"}"),r[e]);return t}function vs(t){if(!t.synopsis||t.synopsis==="")return"";var r="";return t.summary&&(t.class?r+="".concat(t.summary," [").concat(t.class,`]

`):r+="".concat(t.summary,`

`)),r+=t.synopsis,r}function ys(t){if(!t.synopsis||t.synopsis==="")return"";var r="";return t.summary&&(t.class?r+="".concat(t.summary," [").concat(t.class,`]

`):r+="".concat(t.summary,`

`)),r+="`"+t.synopsis+"`",r}var qe=new dr([new pr(lr)]);var yr;(function(t){t.MIN_VALUE=-2147483648,t.MAX_VALUE=2147483647})(yr||(yr={}));var We;(function(t){t.MIN_VALUE=0,t.MAX_VALUE=2147483647})(We||(We={}));var M;(function(t){function r(i,n){return i===Number.MAX_VALUE&&(i=We.MAX_VALUE),n===Number.MAX_VALUE&&(n=We.MAX_VALUE),{line:i,character:n}}t.create=r;function e(i){var n=i;return f.objectLiteral(n)&&f.uinteger(n.line)&&f.uinteger(n.character)}t.is=e})(M||(M={}));var L;(function(t){function r(i,n,a,c){if(f.uinteger(i)&&f.uinteger(n)&&f.uinteger(a)&&f.uinteger(c))return{start:M.create(i,n),end:M.create(a,c)};if(M.is(i)&&M.is(n))return{start:i,end:n};throw new Error("Range#create called with invalid arguments["+i+", "+n+", "+a+", "+c+"]")}t.create=r;function e(i){var n=i;return f.objectLiteral(n)&&M.is(n.start)&&M.is(n.end)}t.is=e})(L||(L={}));var me;(function(t){function r(i,n){return{uri:i,range:n}}t.create=r;function e(i){var n=i;return f.defined(n)&&L.is(n.range)&&(f.string(n.uri)||f.undefined(n.uri))}t.is=e})(me||(me={}));var br;(function(t){function r(i,n,a,c){return{targetUri:i,targetRange:n,targetSelectionRange:a,originSelectionRange:c}}t.create=r;function e(i){var n=i;return f.defined(n)&&L.is(n.targetRange)&&f.string(n.targetUri)&&(L.is(n.targetSelectionRange)||f.undefined(n.targetSelectionRange))&&(L.is(n.originSelectionRange)||f.undefined(n.originSelectionRange))}t.is=e})(br||(br={}));var bt;(function(t){function r(i,n,a,c){return{red:i,green:n,blue:a,alpha:c}}t.create=r;function e(i){var n=i;return f.numberRange(n.red,0,1)&&f.numberRange(n.green,0,1)&&f.numberRange(n.blue,0,1)&&f.numberRange(n.alpha,0,1)}t.is=e})(bt||(bt={}));var xr;(function(t){function r(i,n){return{range:i,color:n}}t.create=r;function e(i){var n=i;return L.is(n.range)&&bt.is(n.color)}t.is=e})(xr||(xr={}));var wr;(function(t){function r(i,n,a){return{label:i,textEdit:n,additionalTextEdits:a}}t.create=r;function e(i){var n=i;return f.string(n.label)&&(f.undefined(n.textEdit)||X.is(n))&&(f.undefined(n.additionalTextEdits)||f.typedArray(n.additionalTextEdits,X.is))}t.is=e})(wr||(wr={}));var Sr;(function(t){t.Comment="comment",t.Imports="imports",t.Region="region"})(Sr||(Sr={}));var Ar;(function(t){function r(i,n,a,c,p){var m={startLine:i,endLine:n};return f.defined(a)&&(m.startCharacter=a),f.defined(c)&&(m.endCharacter=c),f.defined(p)&&(m.kind=p),m}t.create=r;function e(i){var n=i;return f.uinteger(n.startLine)&&f.uinteger(n.startLine)&&(f.undefined(n.startCharacter)||f.uinteger(n.startCharacter))&&(f.undefined(n.endCharacter)||f.uinteger(n.endCharacter))&&(f.undefined(n.kind)||f.string(n.kind))}t.is=e})(Ar||(Ar={}));var xt;(function(t){function r(i,n){return{location:i,message:n}}t.create=r;function e(i){var n=i;return f.defined(n)&&me.is(n.location)&&f.string(n.message)}t.is=e})(xt||(xt={}));var ve;(function(t){t.Error=1,t.Warning=2,t.Information=3,t.Hint=4})(ve||(ve={}));var Cr;(function(t){t.Unnecessary=1,t.Deprecated=2})(Cr||(Cr={}));var $r;(function(t){function r(e){var i=e;return i!=null&&f.string(i.href)}t.is=r})($r||($r={}));var ke;(function(t){function r(i,n,a,c,p,m){var h={range:i,message:n};return f.defined(a)&&(h.severity=a),f.defined(c)&&(h.code=c),f.defined(p)&&(h.source=p),f.defined(m)&&(h.relatedInformation=m),h}t.create=r;function e(i){var n,a=i;return f.defined(a)&&L.is(a.range)&&f.string(a.message)&&(f.number(a.severity)||f.undefined(a.severity))&&(f.integer(a.code)||f.string(a.code)||f.undefined(a.code))&&(f.undefined(a.codeDescription)||f.string((n=a.codeDescription)===null||n===void 0?void 0:n.href))&&(f.string(a.source)||f.undefined(a.source))&&(f.undefined(a.relatedInformation)||f.typedArray(a.relatedInformation,xt.is))}t.is=e})(ke||(ke={}));var Pe;(function(t){function r(i,n){for(var a=[],c=2;c<arguments.length;c++)a[c-2]=arguments[c];var p={title:i,command:n};return f.defined(a)&&a.length>0&&(p.arguments=a),p}t.create=r;function e(i){var n=i;return f.defined(n)&&f.string(n.title)&&f.string(n.command)}t.is=e})(Pe||(Pe={}));var X;(function(t){function r(a,c){return{range:a,newText:c}}t.replace=r;function e(a,c){return{range:{start:a,end:a},newText:c}}t.insert=e;function i(a){return{range:a,newText:""}}t.del=i;function n(a){var c=a;return f.objectLiteral(c)&&f.string(c.newText)&&L.is(c.range)}t.is=n})(X||(X={}));var ge;(function(t){function r(i,n,a){var c={label:i};return n!==void 0&&(c.needsConfirmation=n),a!==void 0&&(c.description=a),c}t.create=r;function e(i){var n=i;return n!==void 0&&f.objectLiteral(n)&&f.string(n.label)&&(f.boolean(n.needsConfirmation)||n.needsConfirmation===void 0)&&(f.string(n.description)||n.description===void 0)}t.is=e})(ge||(ge={}));var D;(function(t){function r(e){var i=e;return typeof i=="string"}t.is=r})(D||(D={}));var ae;(function(t){function r(a,c,p){return{range:a,newText:c,annotationId:p}}t.replace=r;function e(a,c,p){return{range:{start:a,end:a},newText:c,annotationId:p}}t.insert=e;function i(a,c){return{range:a,newText:"",annotationId:c}}t.del=i;function n(a){var c=a;return X.is(c)&&(ge.is(c.annotationId)||D.is(c.annotationId))}t.is=n})(ae||(ae={}));var ze;(function(t){function r(i,n){return{textDocument:i,edits:n}}t.create=r;function e(i){var n=i;return f.defined(n)&&Ge.is(n.textDocument)&&Array.isArray(n.edits)}t.is=e})(ze||(ze={}));var De;(function(t){function r(i,n,a){var c={kind:"create",uri:i};return n!==void 0&&(n.overwrite!==void 0||n.ignoreIfExists!==void 0)&&(c.options=n),a!==void 0&&(c.annotationId=a),c}t.create=r;function e(i){var n=i;return n&&n.kind==="create"&&f.string(n.uri)&&(n.options===void 0||(n.options.overwrite===void 0||f.boolean(n.options.overwrite))&&(n.options.ignoreIfExists===void 0||f.boolean(n.options.ignoreIfExists)))&&(n.annotationId===void 0||D.is(n.annotationId))}t.is=e})(De||(De={}));var Te;(function(t){function r(i,n,a,c){var p={kind:"rename",oldUri:i,newUri:n};return a!==void 0&&(a.overwrite!==void 0||a.ignoreIfExists!==void 0)&&(p.options=a),c!==void 0&&(p.annotationId=c),p}t.create=r;function e(i){var n=i;return n&&n.kind==="rename"&&f.string(n.oldUri)&&f.string(n.newUri)&&(n.options===void 0||(n.options.overwrite===void 0||f.boolean(n.options.overwrite))&&(n.options.ignoreIfExists===void 0||f.boolean(n.options.ignoreIfExists)))&&(n.annotationId===void 0||D.is(n.annotationId))}t.is=e})(Te||(Te={}));var Me;(function(t){function r(i,n,a){var c={kind:"delete",uri:i};return n!==void 0&&(n.recursive!==void 0||n.ignoreIfNotExists!==void 0)&&(c.options=n),a!==void 0&&(c.annotationId=a),c}t.create=r;function e(i){var n=i;return n&&n.kind==="delete"&&f.string(n.uri)&&(n.options===void 0||(n.options.recursive===void 0||f.boolean(n.options.recursive))&&(n.options.ignoreIfNotExists===void 0||f.boolean(n.options.ignoreIfNotExists)))&&(n.annotationId===void 0||D.is(n.annotationId))}t.is=e})(Me||(Me={}));var wt;(function(t){function r(e){var i=e;return i&&(i.changes!==void 0||i.documentChanges!==void 0)&&(i.documentChanges===void 0||i.documentChanges.every(function(n){return f.string(n.kind)?De.is(n)||Te.is(n)||Me.is(n):ze.is(n)}))}t.is=r})(wt||(wt={}));var He=function(){function t(r,e){this.edits=r,this.changeAnnotations=e}return t.prototype.insert=function(r,e,i){var n,a;if(i===void 0?n=X.insert(r,e):D.is(i)?(a=i,n=ae.insert(r,e,i)):(this.assertChangeAnnotations(this.changeAnnotations),a=this.changeAnnotations.manage(i),n=ae.insert(r,e,a)),this.edits.push(n),a!==void 0)return a},t.prototype.replace=function(r,e,i){var n,a;if(i===void 0?n=X.replace(r,e):D.is(i)?(a=i,n=ae.replace(r,e,i)):(this.assertChangeAnnotations(this.changeAnnotations),a=this.changeAnnotations.manage(i),n=ae.replace(r,e,a)),this.edits.push(n),a!==void 0)return a},t.prototype.delete=function(r,e){var i,n;if(e===void 0?i=X.del(r):D.is(e)?(n=e,i=ae.del(r,e)):(this.assertChangeAnnotations(this.changeAnnotations),n=this.changeAnnotations.manage(e),i=ae.del(r,n)),this.edits.push(i),n!==void 0)return n},t.prototype.add=function(r){this.edits.push(r)},t.prototype.all=function(){return this.edits},t.prototype.clear=function(){this.edits.splice(0,this.edits.length)},t.prototype.assertChangeAnnotations=function(r){if(r===void 0)throw new Error("Text edit change is not configured to manage change annotations.")},t}(),Lr=function(){function t(r){this._annotations=r===void 0?Object.create(null):r,this._counter=0,this._size=0}return t.prototype.all=function(){return this._annotations},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),t.prototype.manage=function(r,e){var i;if(D.is(r)?i=r:(i=this.nextId(),e=r),this._annotations[i]!==void 0)throw new Error("Id "+i+" is already in use.");if(e===void 0)throw new Error("No annotation provided for id "+i);return this._annotations[i]=e,this._size++,i},t.prototype.nextId=function(){return this._counter++,this._counter.toString()},t}(),ea=function(){function t(r){var e=this;this._textEditChanges=Object.create(null),r!==void 0?(this._workspaceEdit=r,r.documentChanges?(this._changeAnnotations=new Lr(r.changeAnnotations),r.changeAnnotations=this._changeAnnotations.all(),r.documentChanges.forEach(function(i){if(ze.is(i)){var n=new He(i.edits,e._changeAnnotations);e._textEditChanges[i.textDocument.uri]=n}})):r.changes&&Object.keys(r.changes).forEach(function(i){var n=new He(r.changes[i]);e._textEditChanges[i]=n})):this._workspaceEdit={}}return Object.defineProperty(t.prototype,"edit",{get:function(){return this.initDocumentChanges(),this._changeAnnotations!==void 0&&(this._changeAnnotations.size===0?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit},enumerable:!1,configurable:!0}),t.prototype.getTextEditChange=function(r){if(Ge.is(r)){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var e={uri:r.uri,version:r.version},i=this._textEditChanges[e.uri];if(!i){var n=[],a={textDocument:e,edits:n};this._workspaceEdit.documentChanges.push(a),i=new He(n,this._changeAnnotations),this._textEditChanges[e.uri]=i}return i}else{if(this.initChanges(),this._workspaceEdit.changes===void 0)throw new Error("Workspace edit is not configured for normal text edit changes.");var i=this._textEditChanges[r];if(!i){var n=[];this._workspaceEdit.changes[r]=n,i=new He(n),this._textEditChanges[r]=i}return i}},t.prototype.initDocumentChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._changeAnnotations=new Lr,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())},t.prototype.initChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._workspaceEdit.changes=Object.create(null))},t.prototype.createFile=function(r,e,i){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var n;ge.is(e)||D.is(e)?n=e:i=e;var a,c;if(n===void 0?a=De.create(r,i):(c=D.is(n)?n:this._changeAnnotations.manage(n),a=De.create(r,i,c)),this._workspaceEdit.documentChanges.push(a),c!==void 0)return c},t.prototype.renameFile=function(r,e,i,n){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var a;ge.is(i)||D.is(i)?a=i:n=i;var c,p;if(a===void 0?c=Te.create(r,e,n):(p=D.is(a)?a:this._changeAnnotations.manage(a),c=Te.create(r,e,n,p)),this._workspaceEdit.documentChanges.push(c),p!==void 0)return p},t.prototype.deleteFile=function(r,e,i){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var n;ge.is(e)||D.is(e)?n=e:i=e;var a,c;if(n===void 0?a=Me.create(r,i):(c=D.is(n)?n:this._changeAnnotations.manage(n),a=Me.create(r,i,c)),this._workspaceEdit.documentChanges.push(a),c!==void 0)return c},t}();var _r;(function(t){function r(i){return{uri:i}}t.create=r;function e(i){var n=i;return f.defined(n)&&f.string(n.uri)}t.is=e})(_r||(_r={}));var Er;(function(t){function r(i,n){return{uri:i,version:n}}t.create=r;function e(i){var n=i;return f.defined(n)&&f.string(n.uri)&&f.integer(n.version)}t.is=e})(Er||(Er={}));var Ge;(function(t){function r(i,n){return{uri:i,version:n}}t.create=r;function e(i){var n=i;return f.defined(n)&&f.string(n.uri)&&(n.version===null||f.integer(n.version))}t.is=e})(Ge||(Ge={}));var kr;(function(t){function r(i,n,a,c){return{uri:i,languageId:n,version:a,text:c}}t.create=r;function e(i){var n=i;return f.defined(n)&&f.string(n.uri)&&f.string(n.languageId)&&f.integer(n.version)&&f.string(n.text)}t.is=e})(kr||(kr={}));var O;(function(t){t.PlainText="plaintext",t.Markdown="markdown"})(O||(O={}));(function(t){function r(e){var i=e;return i===t.PlainText||i===t.Markdown}t.is=r})(O||(O={}));var Xe;(function(t){function r(e){var i=e;return f.objectLiteral(e)&&O.is(i.kind)&&f.string(i.value)}t.is=r})(Xe||(Xe={}));var Je;(function(t){t.Text=1,t.Method=2,t.Function=3,t.Constructor=4,t.Field=5,t.Variable=6,t.Class=7,t.Interface=8,t.Module=9,t.Property=10,t.Unit=11,t.Value=12,t.Enum=13,t.Keyword=14,t.Snippet=15,t.Color=16,t.File=17,t.Reference=18,t.Folder=19,t.EnumMember=20,t.Constant=21,t.Struct=22,t.Event=23,t.Operator=24,t.TypeParameter=25})(Je||(Je={}));var Oe;(function(t){t.PlainText=1,t.Snippet=2})(Oe||(Oe={}));var Pr;(function(t){t.Deprecated=1})(Pr||(Pr={}));var Dr;(function(t){function r(i,n,a){return{newText:i,insert:n,replace:a}}t.create=r;function e(i){var n=i;return n&&f.string(n.newText)&&L.is(n.insert)&&L.is(n.replace)}t.is=e})(Dr||(Dr={}));var Tr;(function(t){t.asIs=1,t.adjustIndentation=2})(Tr||(Tr={}));var Mr;(function(t){function r(e){return{label:e}}t.create=r})(Mr||(Mr={}));var St;(function(t){function r(e,i){return{items:e||[],isIncomplete:!!i}}t.create=r})(St||(St={}));var Re;(function(t){function r(i){return i.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}t.fromPlainText=r;function e(i){var n=i;return f.string(n)||f.objectLiteral(n)&&f.string(n.language)&&f.string(n.value)}t.is=e})(Re||(Re={}));var At;(function(t){function r(e){var i=e;return!!i&&f.objectLiteral(i)&&(Xe.is(i.contents)||Re.is(i.contents)||f.typedArray(i.contents,Re.is))&&(e.range===void 0||L.is(e.range))}t.is=r})(At||(At={}));var Or;(function(t){function r(e,i){return i?{label:e,documentation:i}:{label:e}}t.create=r})(Or||(Or={}));var Rr;(function(t){function r(e,i){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];var c={label:e};return f.defined(i)&&(c.documentation=i),f.defined(n)?c.parameters=n:c.parameters=[],c}t.create=r})(Rr||(Rr={}));var ye;(function(t){t.Text=1,t.Read=2,t.Write=3})(ye||(ye={}));var Ct;(function(t){function r(e,i){var n={range:e};return f.number(i)&&(n.kind=i),n}t.create=r})(Ct||(Ct={}));var be;(function(t){t.File=1,t.Module=2,t.Namespace=3,t.Package=4,t.Class=5,t.Method=6,t.Property=7,t.Field=8,t.Constructor=9,t.Enum=10,t.Interface=11,t.Function=12,t.Variable=13,t.Constant=14,t.String=15,t.Number=16,t.Boolean=17,t.Array=18,t.Object=19,t.Key=20,t.Null=21,t.EnumMember=22,t.Struct=23,t.Event=24,t.Operator=25,t.TypeParameter=26})(be||(be={}));var Ir;(function(t){t.Deprecated=1})(Ir||(Ir={}));var $t;(function(t){function r(e,i,n,a,c){var p={name:e,kind:i,location:{uri:a,range:n}};return c&&(p.containerName=c),p}t.create=r})($t||($t={}));var Fr;(function(t){function r(i,n,a,c,p,m){var h={name:i,detail:n,kind:a,range:c,selectionRange:p};return m!==void 0&&(h.children=m),h}t.create=r;function e(i){var n=i;return n&&f.string(n.name)&&f.number(n.kind)&&L.is(n.range)&&L.is(n.selectionRange)&&(n.detail===void 0||f.string(n.detail))&&(n.deprecated===void 0||f.boolean(n.deprecated))&&(n.children===void 0||Array.isArray(n.children))&&(n.tags===void 0||Array.isArray(n.tags))}t.is=e})(Fr||(Fr={}));var jr;(function(t){t.Empty="",t.QuickFix="quickfix",t.Refactor="refactor",t.RefactorExtract="refactor.extract",t.RefactorInline="refactor.inline",t.RefactorRewrite="refactor.rewrite",t.Source="source",t.SourceOrganizeImports="source.organizeImports",t.SourceFixAll="source.fixAll"})(jr||(jr={}));var Br;(function(t){function r(i,n){var a={diagnostics:i};return n!=null&&(a.only=n),a}t.create=r;function e(i){var n=i;return f.defined(n)&&f.typedArray(n.diagnostics,ke.is)&&(n.only===void 0||f.typedArray(n.only,f.string))}t.is=e})(Br||(Br={}));var Nr;(function(t){function r(i,n,a){var c={title:i},p=!0;return typeof n=="string"?(p=!1,c.kind=n):Pe.is(n)?c.command=n:c.edit=n,p&&a!==void 0&&(c.kind=a),c}t.create=r;function e(i){var n=i;return n&&f.string(n.title)&&(n.diagnostics===void 0||f.typedArray(n.diagnostics,ke.is))&&(n.kind===void 0||f.string(n.kind))&&(n.edit!==void 0||n.command!==void 0)&&(n.command===void 0||Pe.is(n.command))&&(n.isPreferred===void 0||f.boolean(n.isPreferred))&&(n.edit===void 0||wt.is(n.edit))}t.is=e})(Nr||(Nr={}));var Ur;(function(t){function r(i,n){var a={range:i};return f.defined(n)&&(a.data=n),a}t.create=r;function e(i){var n=i;return f.defined(n)&&L.is(n.range)&&(f.undefined(n.command)||Pe.is(n.command))}t.is=e})(Ur||(Ur={}));var Vr;(function(t){function r(i,n){return{tabSize:i,insertSpaces:n}}t.create=r;function e(i){var n=i;return f.defined(n)&&f.uinteger(n.tabSize)&&f.boolean(n.insertSpaces)}t.is=e})(Vr||(Vr={}));var qr;(function(t){function r(i,n,a){return{range:i,target:n,data:a}}t.create=r;function e(i){var n=i;return f.defined(n)&&L.is(n.range)&&(f.undefined(n.target)||f.string(n.target))}t.is=e})(qr||(qr={}));var Hr;(function(t){function r(i,n){return{range:i,parent:n}}t.create=r;function e(i){var n=i;return n!==void 0&&L.is(n.range)&&(n.parent===void 0||t.is(n.parent))}t.is=e})(Hr||(Hr={}));var Wr;(function(t){function r(a,c,p,m){return new bs(a,c,p,m)}t.create=r;function e(a){var c=a;return!!(f.defined(c)&&f.string(c.uri)&&(f.undefined(c.languageId)||f.string(c.languageId))&&f.uinteger(c.lineCount)&&f.func(c.getText)&&f.func(c.positionAt)&&f.func(c.offsetAt))}t.is=e;function i(a,c){for(var p=a.getText(),m=n(c,function(E,R){var J=E.range.start.line-R.range.start.line;return J===0?E.range.start.character-R.range.start.character:J}),h=p.length,v=m.length-1;v>=0;v--){var b=m[v],A=a.offsetAt(b.range.start),w=a.offsetAt(b.range.end);if(w<=h)p=p.substring(0,A)+b.newText+p.substring(w,p.length);else throw new Error("Overlapping edit");h=A}return p}t.applyEdits=i;function n(a,c){if(a.length<=1)return a;var p=a.length/2|0,m=a.slice(0,p),h=a.slice(p);n(m,c),n(h,c);for(var v=0,b=0,A=0;v<m.length&&b<h.length;){var w=c(m[v],h[b]);w<=0?a[A++]=m[v++]:a[A++]=h[b++]}for(;v<m.length;)a[A++]=m[v++];for(;b<h.length;)a[A++]=h[b++];return a}})(Wr||(Wr={}));var bs=function(){function t(r,e,i,n){this._uri=r,this._languageId=e,this._version=i,this._content=n,this._lineOffsets=void 0}return Object.defineProperty(t.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),t.prototype.getText=function(r){if(r){var e=this.offsetAt(r.start),i=this.offsetAt(r.end);return this._content.substring(e,i)}return this._content},t.prototype.update=function(r,e){this._content=r.text,this._version=e,this._lineOffsets=void 0},t.prototype.getLineOffsets=function(){if(this._lineOffsets===void 0){for(var r=[],e=this._content,i=!0,n=0;n<e.length;n++){i&&(r.push(n),i=!1);var a=e.charAt(n);i=a==="\r"||a===`
`,a==="\r"&&n+1<e.length&&e.charAt(n+1)===`
`&&n++}i&&e.length>0&&r.push(e.length),this._lineOffsets=r}return this._lineOffsets},t.prototype.positionAt=function(r){r=Math.max(Math.min(r,this._content.length),0);var e=this.getLineOffsets(),i=0,n=e.length;if(n===0)return M.create(0,r);for(;i<n;){var a=Math.floor((i+n)/2);e[a]>r?n=a:i=a+1}var c=i-1;return M.create(c,r-e[c])},t.prototype.offsetAt=function(r){var e=this.getLineOffsets();if(r.line>=e.length)return this._content.length;if(r.line<0)return 0;var i=e[r.line],n=r.line+1<e.length?e[r.line+1]:this._content.length;return Math.max(Math.min(i+r.character,n),i)},Object.defineProperty(t.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),t}(),f;(function(t){var r=Object.prototype.toString;function e(w){return typeof w<"u"}t.defined=e;function i(w){return typeof w>"u"}t.undefined=i;function n(w){return w===!0||w===!1}t.boolean=n;function a(w){return r.call(w)==="[object String]"}t.string=a;function c(w){return r.call(w)==="[object Number]"}t.number=c;function p(w,E,R){return r.call(w)==="[object Number]"&&E<=w&&w<=R}t.numberRange=p;function m(w){return r.call(w)==="[object Number]"&&-2147483648<=w&&w<=2147483647}t.integer=m;function h(w){return r.call(w)==="[object Number]"&&0<=w&&w<=2147483647}t.uinteger=h;function v(w){return r.call(w)==="[object Function]"}t.func=v;function b(w){return w!==null&&typeof w=="object"}t.objectLiteral=b;function A(w,E){return Array.isArray(w)&&w.every(E)}t.typedArray=A})(f||(f={}));var xe=class{constructor(r,e,i,n){this._uri=r,this._languageId=e,this._version=i,this._content=n,this._lineOffsets=void 0}get uri(){return this._uri}get languageId(){return this._languageId}get version(){return this._version}getText(r){if(r){let e=this.offsetAt(r.start),i=this.offsetAt(r.end);return this._content.substring(e,i)}return this._content}update(r,e){for(let i of r)if(xe.isIncremental(i)){let n=Gr(i.range),a=this.offsetAt(n.start),c=this.offsetAt(n.end);this._content=this._content.substring(0,a)+i.text+this._content.substring(c,this._content.length);let p=Math.max(n.start.line,0),m=Math.max(n.end.line,0),h=this._lineOffsets,v=zr(i.text,!1,a);if(m-p===v.length)for(let A=0,w=v.length;A<w;A++)h[A+p+1]=v[A];else v.length<1e4?h.splice(p+1,m-p,...v):this._lineOffsets=h=h.slice(0,p+1).concat(v,h.slice(m+1));let b=i.text.length-(c-a);if(b!==0)for(let A=p+1+v.length,w=h.length;A<w;A++)h[A]=h[A]+b}else if(xe.isFull(i))this._content=i.text,this._lineOffsets=void 0;else throw new Error("Unknown change event received");this._version=e}getLineOffsets(){return this._lineOffsets===void 0&&(this._lineOffsets=zr(this._content,!0)),this._lineOffsets}positionAt(r){r=Math.max(Math.min(r,this._content.length),0);let e=this.getLineOffsets(),i=0,n=e.length;if(n===0)return{line:0,character:r};for(;i<n;){let c=Math.floor((i+n)/2);e[c]>r?n=c:i=c+1}let a=i-1;return{line:a,character:r-e[a]}}offsetAt(r){let e=this.getLineOffsets();if(r.line>=e.length)return this._content.length;if(r.line<0)return 0;let i=e[r.line],n=r.line+1<e.length?e[r.line+1]:this._content.length;return Math.max(Math.min(i+r.character,n),i)}get lineCount(){return this.getLineOffsets().length}static isIncremental(r){let e=r;return e!=null&&typeof e.text=="string"&&e.range!==void 0&&(e.rangeLength===void 0||typeof e.rangeLength=="number")}static isFull(r){let e=r;return e!=null&&typeof e.text=="string"&&e.range===void 0&&e.rangeLength===void 0}},Ie;(function(t){function r(n,a,c,p){return new xe(n,a,c,p)}t.create=r;function e(n,a,c){if(n instanceof xe)return n.update(a,c),n;throw new Error("TextDocument.update: document must be created by TextDocument.create")}t.update=e;function i(n,a){let c=n.getText(),p=Lt(a.map(xs),(v,b)=>{let A=v.range.start.line-b.range.start.line;return A===0?v.range.start.character-b.range.start.character:A}),m=0,h=[];for(let v of p){let b=n.offsetAt(v.range.start);if(b<m)throw new Error("Overlapping edit");b>m&&h.push(c.substring(m,b)),v.newText.length&&h.push(v.newText),m=n.offsetAt(v.range.end)}return h.push(c.substr(m)),h.join("")}t.applyEdits=i})(Ie||(Ie={}));function Lt(t,r){if(t.length<=1)return t;let e=t.length/2|0,i=t.slice(0,e),n=t.slice(e);Lt(i,r),Lt(n,r);let a=0,c=0,p=0;for(;a<i.length&&c<n.length;)r(i[a],n[c])<=0?t[p++]=i[a++]:t[p++]=n[c++];for(;a<i.length;)t[p++]=i[a++];for(;c<n.length;)t[p++]=n[c++];return t}function zr(t,r,e=0){let i=r?[e]:[];for(let n=0;n<t.length;n++){let a=t.charCodeAt(n);(a===13||a===10)&&(a===13&&n+1<t.length&&t.charCodeAt(n+1)===10&&n++,i.push(e+n+1))}return i}function Gr(t){let r=t.start,e=t.end;return r.line>e.line||r.line===e.line&&r.character>e.character?{start:e,end:r}:t}function xs(t){let r=Gr(t.range);return r!==t.range?{newText:t.newText,range:r}:t}var Xr;(function(t){t.LATEST={textDocument:{completion:{completionItem:{documentationFormat:[O.Markdown,O.PlainText]}},hover:{contentFormat:[O.Markdown,O.PlainText]}}}})(Xr||(Xr={}));var Jr=function(){function t(r){this.clientCapabilities=r}return t.prototype.doComplete=function(r,e,i){this.offset=r.offsetAt(e),this.position=e,this.currentWord=ws(r,this.offset),this.defaultReplaceRange=L.create(M.create(this.position.line,this.position.character-this.currentWord.length),this.position),this.textDocument=r,this.program=i;try{var n={isIncomplete:!1,items:[]},a=r.getText(L.create(M.create(this.position.line,0),this.position));return a.match(/^([a-z]+:)?([ \t]+)?([a-z]{0,3})$/i)&&this.getCompletionsForMnemonic(n),n}finally{this.position=null,this.currentWord=null,this.textDocument=null,this.program=null,this.defaultReplaceRange=null}},t.prototype.getCompletionsForMnemonic=function(r){var e=this,i=qe.getMnemonics();return i.forEach(function(n){var a,c,p;c=e.getCompletionRange(null),p=(a=n.snippet)!==null&&a!==void 0?a:n.name;var m={label:n.name,detail:n.class?"".concat(n.summary," [").concat(n.class,"]"):n.summary,documentation:gr(n,e.doesSupportMarkdown()),textEdit:X.replace(c,p),insertTextFormat:Oe.Snippet,kind:Je.Function};r.items.push(m)}),r},t.prototype.doesSupportMarkdown=function(){if(!he(this.supportsMarkdown)){if(!he(this.clientCapabilities))return this.supportsMarkdown=!0,this.supportsMarkdown;var r=this.clientCapabilities&&this.clientCapabilities.textDocument&&this.clientCapabilities.textDocument.hover;this.supportsMarkdown=r&&r.contentFormat&&Array.isArray(r.contentFormat)&&r.contentFormat.indexOf(O.Markdown)!==-1}return this.supportsMarkdown},t.prototype.getCompletionRange=function(r){if(r&&r.offset<=this.offset&&this.offset<=r.end){var e=r.end!==-1?this.textDocument.positionAt(r.end):this.position,i=this.textDocument.positionAt(r.offset);if(i.line===e.line)return L.create(i,e)}return this.defaultReplaceRange},t}();function ws(t,r){for(var e=r-1,i=t.getText();e>=0&&` 	
\r:,`.indexOf(i.charAt(e))===-1;)e--;return i.substring(e+1,r)}var Zr=function(){function t(r){this.clientCapabilities=r}return t.prototype.doHover=function(r,e){var i,n=$e(r.getText()),a=(i=n==null?void 0:n.lines)===null||i===void 0?void 0:i.find(function(w){return w.loc.start.line===e.line+1});if(!a||!a.stmt)return null;var c=r.offsetAt(e);if(c<a.stmt.loc.start.offset||c>a.stmt.loc.end.offset)return null;var p=null,m=a.stmt;if(m.type==="insn"){var h=m.mnemonic.toLowerCase(),v=qe.getMnemonic(h);if(v){var b=this.getParamNames(v,m),A=mr(v,b,this.doesSupportMarkdown());p={contents:A,range:L.create(r.positionAt(m.loc.start.offset),r.positionAt(m.loc.end.offset))}}}return p&&(p.contents=this.convertContents(p.contents)),p},t.prototype.getParamNames=function(r,e){var i=[];return e.p1?i.push(this.getParamName(e.p1,e.mnemonic)):r.class==="ALU"?i.push("A"):i.push("?"),e.p2?i.push(this.getParamName(e.p2,e.mnemonic)):i.push("?"),i},t.prototype.getParamName=function(r,e){switch(r.type){case"register":return r.value.toUpperCase();case"qualified-ident":return"(".concat(r.path[0],")");case"literal":return e.toLowerCase()==="ldi"&&r.value>15?"0x".concat(r.value.toString(16).toUpperCase()):r.value.toString();default:return"?"}},t.prototype.convertContents=function(r){return this.doesSupportMarkdown()||typeof r=="string"?r:"kind"in r?{kind:"plaintext",value:r.value}:Array.isArray(r)?r.map(function(e){return typeof e=="string"?e:e.value}):r.value},t.prototype.doesSupportMarkdown=function(){if(!he(this.supportsMarkdown)){if(!he(this.clientCapabilities))return this.supportsMarkdown=!0,this.supportsMarkdown;var r=this.clientCapabilities.textDocument&&this.clientCapabilities.textDocument.hover;this.supportsMarkdown=r&&r.contentFormat&&Array.isArray(r.contentFormat)&&r.contentFormat.indexOf(O.Markdown)!==-1}return this.supportsMarkdown},t}();var Ss=function(){var t=function(r,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},t(r,e)};return function(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");t(r,e);function i(){this.constructor=r}r.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),As=function(){function t(r,e){this.symbols=[]}return t.prototype.addSymbol=function(r){this.symbols.push(r)},t.prototype.getSymbol=function(r,e){for(var i=0;i<this.symbols.length;i++){var n=this.symbols[i];if(n.name===r&&n.type===e)return n}return null},t}();var Cs=function(t){Ss(r,t);function r(){return t.call(this,0,Number.MAX_VALUE)||this}return r}(As);var $s=function(){function t(r,e,i,n){this.name=r,this.value=e,this.node=i,this.type=n}return t}();var Ls=function(){function t(r){this.scope=r}return t.prototype.addSymbol=function(r,e,i,n){r.offset!==-1&&this.scope.addSymbol(new $s(e,i,r,n))},t.prototype.visitNode=function(r){switch(r.type){case U.Label:return this.addSymbol(r,r.getText(),void 0,Le.Label),!0}return!0},t}();var _t=function(){function t(r){this.global=new Cs,r.acceptVisitor(new Ls(this.global))}return t.prototype.internalFindSymbol=function(r,e){for(var i=r.getText(),n=this.global,a=0;a<e.length;a++){var c=e[a],p=n.getSymbol(i,c);if(p)return p}return null},t.prototype.evaluateReferenceTypes=function(r){return r instanceof vt||r instanceof pe?[Le.Label]:null},t.prototype.findSymbolFromNode=function(r){if(!r)return null;var e=this.evaluateReferenceTypes(r);return e?this.internalFindSymbol(r,e):null},t.prototype.matchesSymbol=function(r,e){if(!r||!r.matches(e.name))return!1;var i=this.evaluateReferenceTypes(r);if(!i||i.indexOf(e.type)===-1)return!1;var n=this.internalFindSymbol(r,i);return n===e},t}();var Yr=function(){function t(){}return t.prototype.findDefinition=function(r,e,i){var n=new _t(i),a=r.offsetAt(e),c=mt(i,a);if(!c)return null;var p=n.findSymbolFromNode(c);return p?{uri:r.uri,range:Ze(p.node,r)}:null},t.prototype.findReferences=function(r,e,i){var n=this.findDocumentHighlights(r,e,i);return n.map(function(a){return{uri:r.uri,range:a.range}})},t.prototype.findDocumentHighlights=function(r,e,i){var n=[],a=r.offsetAt(e),c=mt(i,a);if(!c||c.type!==U.Label&&c.type!==U.LabelRef)return n;var p=new _t(i),m=p.findSymbolFromNode(c),h=c.getText();return i.accept(function(v){if(m){if(p.matchesSymbol(v,m))return n.push({kind:Qr(v),range:Ze(v,r)}),!1}else c&&c.type===v.type&&v.matches(h)&&n.push({kind:Qr(v),range:Ze(v,r)});return!0}),n},t.prototype.findDocumentSymbols=function(r,e){var i=[];return e.accept(function(n){var a={name:null,kind:be.Class,location:null},c=n;return n instanceof pe&&(a.name=n.getText(),a.kind=be.Variable),a.name&&(a.location=me.create(r.uri,Ze(c,r)),i.push(a)),!0}),i},t}();function Qr(t){return t instanceof pe?ye.Write:ye.Read}function Ze(t,r){return L.create(r.positionAt(t.offset),r.positionAt(t.end))}var Kr=function(){function t(){}return t.prototype.configure=function(r){this.settings=r},t.prototype.doValidation=function(r,e){if(e===void 0&&(e=this.settings),e&&e.validate===!1)return[];var i=ht(r.getText()),n=i.errors,a=i.warnings,c=function(m,h){return{severity:h,range:{start:r.positionAt(m.loc.start.offset),end:r.positionAt(m.loc.end.offset)},message:m.msg,source:r.languageId}},p=[];return p.push.apply(p,n.map(function(m){return c(m,ve.Error)})),p.push.apply(p,a.map(function(m){return c(m,ve.Warning)})),p},t}();function en(t){var r=new cr,e=new Zr(t&&t.clientCapabilities),i=new Jr(t&&t.clientCapabilities),n=new Yr,a=new Kr;return{doValidation:a.doValidation.bind(a),parseProgram:r.parseProgram.bind(r),doComplete:i.doComplete.bind(i),doHover:e.doHover.bind(e),findDefinition:n.findDefinition.bind(n),findReferences:n.findReferences.bind(n),findDocumentHighlights:n.findDocumentHighlights.bind(n),findDocumentSymbols:n.findDocumentSymbols.bind(n)}}var Et=class{_ctx;_languageService;_languageId;constructor(r,e){this._ctx=r,this._languageId=e.languageId,this._languageService=en({})}async doValidation(r){let e=this._getTextDocument(r);if(e){let i=this._languageService.doValidation(e);return Promise.resolve(i)}return Promise.resolve([])}async doComplete(r,e){let i=this._getTextDocument(r);if(!i)return null;let n=this._languageService.parseProgram(i),a=this._languageService.doComplete(i,e,n);return Promise.resolve(a)}async doHover(r,e){let i=this._getTextDocument(r);if(!i)return null;let n=this._languageService.doHover(i,e);return Promise.resolve(n)}async findDefinition(r,e){let i=this._getTextDocument(r);if(!i)return null;let n=this._languageService.parseProgram(i),a=this._languageService.findDefinition(i,e,n);return Promise.resolve(a)}async findReferences(r,e){let i=this._getTextDocument(r);if(!i)return[];let n=this._languageService.parseProgram(i),a=this._languageService.findReferences(i,e,n);return Promise.resolve(a)}async findDocumentHighlights(r,e){let i=this._getTextDocument(r);if(!i)return[];let n=this._languageService.parseProgram(i),a=this._languageService.findDocumentHighlights(i,e,n);return Promise.resolve(a)}async findDocumentSymbols(r){let e=this._getTextDocument(r);if(!e)return[];let i=this._languageService.parseProgram(e),n=this._languageService.findDocumentSymbols(e,i);return Promise.resolve(n)}_getTextDocument(r){let e=this._ctx.getMirrorModels();for(let i of e)if(i.uri.toString()===r)return Ie.create(r,this._languageId,i.version,i.getValue());return null}};function Es(t,r){return new Et(t,r)}return zt(ks);})();
return moduleExports;
});
