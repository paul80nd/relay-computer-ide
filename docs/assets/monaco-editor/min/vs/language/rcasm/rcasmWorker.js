/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.33.0(436bf1645b47d9c71cf59af7751deb82d8caa0c2)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/
define("vs/language/rcasm/rcasmWorker", ["require","require"],(require)=>{
var moduleExports=(()=>{var yt=Object.defineProperty;var gs=Object.getOwnPropertyDescriptor;var vs=Object.getOwnPropertyNames;var ms=Object.prototype.hasOwnProperty;var ys=t=>yt(t,"__esModule",{value:!0});var bs=(t,r)=>()=>(t&&(r=t(t=0)),r);var xs=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports),or=(t,r)=>{for(var e in r)yt(t,e,{get:r[e],enumerable:!0})},Ss=(t,r,e,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of vs(r))!ms.call(t,n)&&(e||n!=="default")&&yt(t,n,{get:()=>r[n],enumerable:!(i=gs(r,n))||i.enumerable});return t};var cr=(t=>(r,e)=>t&&t.get(r)||(e=Ss(ys({}),r,1),t&&t.set(r,e),e))(typeof WeakMap!="undefined"?new WeakMap:0);var xt={};or(xt,{DataSize:()=>Pe,mkAsmLine:()=>$s,mkData:()=>_s,mkInsn:()=>ks,mkLabel:()=>Es,mkLiteral:()=>Ps,mkProgram:()=>As,mkRegister:()=>Ds,mkScopeQualifiedIdent:()=>Ms,mkSetPC:()=>Ls});function As(t,r){return{lines:t,loc:r}}function $s(t,r,e){return{label:t,stmt:r,loc:e}}function Es(t,r){return{name:t,loc:r}}function Ls(t,r){return{type:"setpc",pc:t,loc:r}}function ks(t,r,e,i){return{type:"insn",mnemonic:t,p1:r,p2:e,loc:i}}function _s(t,r,e){return{type:"data",values:r,dataSize:t,loc:e}}function Ps(t,r,e){return{type:"literal",lit:t,ot:r,loc:e}}function Ds(t,r){return{type:"register",value:t,loc:r}}function Ms(t,r,e){return{type:"qualified-ident",path:t,absolute:r,loc:e}}var Pe,St=bs(()=>{(function(t){t[t.Byte=0]="Byte",t[t.Word=1]="Word"})(Pe||(Pe={}))});var vr=xs((da,gr)=>{"use strict";function Ts(t,r){function e(){this.constructor=t}e.prototype=r.prototype,t.prototype=new e}function fe(t,r,e,i){this.message=t,this.expected=r,this.found=e,this.location=i,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,fe)}Ts(fe,Error);fe.buildMessage=function(t,r){var e={literal:function(h){return'"'+n(h.text)+'"'},class:function(h){var y="",b;for(b=0;b<h.parts.length;b++)y+=h.parts[b]instanceof Array?a(h.parts[b][0])+"-"+a(h.parts[b][1]):a(h.parts[b]);return"["+(h.inverted?"^":"")+y+"]"},any:function(h){return"any character"},end:function(h){return"end of input"},other:function(h){return h.description}};function i(h){return h.charCodeAt(0).toString(16).toUpperCase()}function n(h){return h.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+i(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+i(y)})}function a(h){return h.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+i(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+i(y)})}function u(h){return e[h.type](h)}function d(h){var y=new Array(h.length),b,C;for(b=0;b<h.length;b++)y[b]=u(h[b]);if(y.sort(),y.length>0){for(b=1,C=1;b<y.length;b++)y[b-1]!==y[b]&&(y[C]=y[b],C++);y.length=C}switch(y.length){case 1:return y[0];case 2:return y[0]+" or "+y[1];default:return y.slice(0,-1).join(", ")+", or "+y[y.length-1]}}function m(h){return h?'"'+n(h)+'"':"end of input"}return"Expected "+d(t)+" but "+m(r)+" found."};function Os(t,r){r=r!==void 0?r:{};var e={},i={Lines:Jt},n=Jt,a=function(s,c){return _.mkProgram(qe(s,c,1),P())},u=function(s){return s},d=function(s,c){return _.mkAsmLine(s,c,P())},m=function(s){return _.mkAsmLine(s,null,P())},h=function(s){return _.mkAsmLine(null,s,P())},y=function(s){return _.mkAsmLine(null,s,P())},b=function(){return _.mkAsmLine(null,null,P())},C=function(s){return s},S=function(s){return s},k=H("directive"),M=function(s,c){let l=s=="byte"?_.DataSize.Byte:_.DataSize.Word;return _.mkData(l,c,P())},K=function(s,c){return qe(s,c,3)},oe=function(s,c,l){return _.mkInsn(s,c,l,P())},V=function(s,c){return _.mkInsn(s,c,null,P())},N=function(s){return _.mkInsn(s,null,null,P())},ce=/^[a-zA-Z_]/,$e=re([["a","z"],["A","Z"],"_"],!1,!1),ue=/^[a-zA-Z_0-9]/,z=re([["a","z"],["A","Z"],"_",["0","9"]],!1,!1),I=/^[0-9a-f]/i,ee=re([["0","9"],["a","f"]],!1,!0),ne=/^[0-1]/,te=re([["0","1"]],!1,!1),Ee=/^[+\-]/,le=re(["+","-"],!1,!1),Le=/^[0-9]/,F=re([["0","9"]],!1,!1),T=/^[a-z]/i,ie=re([["a","z"]],!1,!0),Ne=/^[0-9a-z_]/i,We=re([["0","9"],["a","z"],"_"],!1,!0),pn="a",hn=E("a",!0),gn="b",vn=E("b",!0),mn="c",yn=E("c",!0),bn="d",xn=E("d",!0),Sn="g",wn=E("g",!0),Cn="h",An=E("h",!0),$n="j",En=E("j",!0),Ln="m",kn=E("m",!0),_n="o",Pn=E("o",!0),Dn="r",Mn=E("r",!0),Tn="x",On=E("x",!0),Rn="y",In=E("y",!0),Fn="0",jn=E("0",!1),Bn="1",Un=E("1",!1),Nn="2",Wn=E("2",!1),Vn=",",zn=E(",",!1),Hn=":",qn=E(":",!1),Gn=";",Xn=E(";",!1),Jn="dfb",Zn=E("dfb",!0),Qn=function(){return"byte"},Yn="dfw",Kn=E("dfw",!0),ei=function(){return"word"},ti=function(s){return parseInt(s,2)},ri=function(s){return parseInt(s,16)},ni=function(s){return parseInt(s)},ot='"',ct=E('"',!1),ii=function(s){return s.join("")},ut=Bi(),si=function(s){return s},Ht=function(){return Fi()},qt=H("whitespace"),ai="	",oi=E("	",!1),ci="\v",ui=E("\v",!1),li="\f",fi=E("\f",!1),di=" ",pi=E(" ",!1),hi="\xA0",gi=E("\xA0",!1),vi="\uFEFF",mi=E("\uFEFF",!1),yi=H("end of line"),bi=/^[\n\r]/,xi=re([`
`,"\r"],!1,!1),Si=H("comment"),wi=H("label"),Ci=function(s){return _.mkLabel(s,P())},Ai=H("ORG"),$i=function(s){return _.mkSetPC(s,P())},Ei=H("mnemonic"),Li=H("literal"),ki=function(s){return _.mkLiteral(s,"b",P())},_i=function(s){return _.mkLiteral(s,"h",P())},Pi=function(s){return _.mkLiteral(s,"d",P())},Di=function(s){return _.mkLiteral(s,"s",P())},Mi=H("identifier"),G="::",ke=E("::",!1),Ti=function(s,c){return _.mkScopeQualifiedIdent(qe(s,c,1),!1,P())},Oi=function(s,c){return _.mkScopeQualifiedIdent(qe(s,c,1),!0,P())},Ri=H("register"),Ii=function(s){return _.mkRegister(s.toLowerCase(),P())},o=0,A=0,Ve=[{line:1,column:1}],X=0,lt=[],v=0,ze;if("startRule"in r){if(!(r.startRule in i))throw new Error(`Can't start parsing from rule "`+r.startRule+'".');n=i[r.startRule]}function Fi(){return t.substring(A,o)}function ji(){return _e(A,o)}function sa(s,c){throw c=c!==void 0?c:_e(A,o),Xt([H(s)],t.substring(A,o),c)}function aa(s,c){throw c=c!==void 0?c:_e(A,o),Ni(s,c)}function E(s,c){return{type:"literal",text:s,ignoreCase:c}}function re(s,c,l){return{type:"class",parts:s,inverted:c,ignoreCase:l}}function Bi(){return{type:"any"}}function Ui(){return{type:"end"}}function H(s){return{type:"other",description:s}}function Gt(s){var c=Ve[s],l;if(c)return c;for(l=s-1;!Ve[l];)l--;for(c=Ve[l],c={line:c.line,column:c.column};l<s;)t.charCodeAt(l)===10?(c.line++,c.column=1):c.column++,l++;return Ve[s]=c,c}function _e(s,c){var l=Gt(s),f=Gt(c);return{start:{offset:s,line:l.line,column:l.column},end:{offset:c,line:f.line,column:f.column}}}function x(s){o<X||(o>X&&(X=o,lt=[]),lt.push(s))}function Ni(s,c){return new fe(s,null,null,c)}function Xt(s,c,l){return new fe(fe.buildMessage(s,c),s,c,l)}function Jt(){var s,c,l,f,g,w;if(s=o,c=ft(),c!==e){for(l=[],f=o,g=He(),g!==e?(w=ft(),w!==e?(g=[g,w],f=g):(o=f,f=e)):(o=f,f=e);f!==e;)l.push(f),f=o,g=He(),g!==e?(w=ft(),w!==e?(g=[g,w],f=g):(o=f,f=e)):(o=f,f=e);l!==e?(A=s,c=a(c,l),s=c):(o=s,s=e)}else o=s,s=e;return s}function ft(){var s,c,l,f,g;return s=o,c=j(),c!==e?(l=Wi(),l!==e?(f=j(),f!==e?(g=ls(),g===e&&(g=null),g!==e?(A=s,c=u(l),s=c):(o=s,s=e)):(o=s,s=e)):(o=s,s=e)):(o=s,s=e),s}function Wi(){var s,c,l,f;return s=o,c=sr(),c!==e?(l=j(),l!==e?(f=Zt(),f!==e?(A=s,c=d(c,f),s=c):(o=s,s=e)):(o=s,s=e)):(o=s,s=e),s===e&&(s=o,c=sr(),c!==e&&(A=s,c=m(c)),s=c,s===e&&(s=o,c=fs(),c!==e&&(A=s,c=h(c)),s=c,s===e&&(s=o,c=Zt(),c!==e&&(A=s,c=y(c)),s=c,s===e&&(s=o,c=j(),c!==e&&(A=s,c=b()),s=c)))),s}function Zt(){var s,c;return s=o,c=Vi(),c!==e&&(A=s,c=C(c)),s=c,s===e&&(s=o,c=Hi(),c!==e&&(A=s,c=S(c)),s=c),s}function Vi(){var s,c,l,f;return v++,s=o,c=is(),c===e&&(c=ss()),c!==e?(l=j(),l!==e?(f=zi(),f!==e?(A=s,c=M(c,f),s=c):(o=s,s=e)):(o=s,s=e)):(o=s,s=e),v--,s===e&&(c=e,v===0&&x(k)),s}function zi(){var s,c,l,f,g,w,O,J;if(s=o,c=pe(),c!==e){for(l=[],f=o,g=j(),g!==e?(w=vt(),w!==e?(O=j(),O!==e?(J=pe(),J!==e?(g=[g,w,O,J],f=g):(o=f,f=e)):(o=f,f=e)):(o=f,f=e)):(o=f,f=e);f!==e;)l.push(f),f=o,g=j(),g!==e?(w=vt(),w!==e?(O=j(),O!==e?(J=pe(),J!==e?(g=[g,w,O,J],f=g):(o=f,f=e)):(o=f,f=e)):(o=f,f=e)):(o=f,f=e);l!==e?(A=s,c=K(c,l),s=c):(o=s,s=e)}else o=s,s=e;return s}function Hi(){var s,c,l,f,g,w,O,J;return s=o,c=mt(),c!==e?(l=j(),l!==e?(f=pe(),f!==e?(g=j(),g!==e?(w=vt(),w!==e?(O=j(),O!==e?(J=pe(),J!==e?(A=s,c=oe(c,f,J),s=c):(o=s,s=e)):(o=s,s=e)):(o=s,s=e)):(o=s,s=e)):(o=s,s=e)):(o=s,s=e)):(o=s,s=e),s===e&&(s=o,c=mt(),c!==e?(l=j(),l!==e?(f=pe(),f!==e?(A=s,c=V(c,f),s=c):(o=s,s=e)):(o=s,s=e)):(o=s,s=e),s===e&&(s=o,c=mt(),c!==e&&(A=s,c=N(c)),s=c)),s}function pe(){var s;return s=ar(),s===e&&(s=ps(),s===e&&(s=ds())),s}function dt(){var s;return ce.test(t.charAt(o))?(s=t.charAt(o),o++):(s=e,v===0&&x($e)),s}function Qt(){var s;return ue.test(t.charAt(o))?(s=t.charAt(o),o++):(s=e,v===0&&x(z)),s}function qi(){var s,c;if(s=[],I.test(t.charAt(o))?(c=t.charAt(o),o++):(c=e,v===0&&x(ee)),c!==e)for(;c!==e;)s.push(c),I.test(t.charAt(o))?(c=t.charAt(o),o++):(c=e,v===0&&x(ee));else s=e;return s}function Gi(){var s,c;if(s=[],ne.test(t.charAt(o))?(c=t.charAt(o),o++):(c=e,v===0&&x(te)),c!==e)for(;c!==e;)s.push(c),ne.test(t.charAt(o))?(c=t.charAt(o),o++):(c=e,v===0&&x(te));else s=e;return s}function Xi(){var s,c,l,f;if(s=o,Ee.test(t.charAt(o))?(c=t.charAt(o),o++):(c=e,v===0&&x(le)),c===e&&(c=null),c!==e){if(l=[],Le.test(t.charAt(o))?(f=t.charAt(o),o++):(f=e,v===0&&x(F)),f!==e)for(;f!==e;)l.push(f),Le.test(t.charAt(o))?(f=t.charAt(o),o++):(f=e,v===0&&x(F));else l=e;l!==e?(c=[c,l],s=c):(o=s,s=e)}else o=s,s=e;return s}function Ji(){var s,c,l,f;if(s=o,c=[],T.test(t.charAt(o))?(l=t.charAt(o),o++):(l=e,v===0&&x(ie)),l!==e)for(;l!==e;)c.push(l),T.test(t.charAt(o))?(l=t.charAt(o),o++):(l=e,v===0&&x(ie));else c=e;if(c!==e){for(l=[],Ne.test(t.charAt(o))?(f=t.charAt(o),o++):(f=e,v===0&&x(We));f!==e;)l.push(f),Ne.test(t.charAt(o))?(f=t.charAt(o),o++):(f=e,v===0&&x(We));l!==e?(c=[c,l],s=c):(o=s,s=e)}else o=s,s=e;return s}function Zi(){var s;return t.substr(o,1).toLowerCase()===pn?(s=t.charAt(o),o++):(s=e,v===0&&x(hn)),s}function Yt(){var s;return t.substr(o,1).toLowerCase()===gn?(s=t.charAt(o),o++):(s=e,v===0&&x(vn)),s}function Qi(){var s;return t.substr(o,1).toLowerCase()===mn?(s=t.charAt(o),o++):(s=e,v===0&&x(yn)),s}function Kt(){var s;return t.substr(o,1).toLowerCase()===bn?(s=t.charAt(o),o++):(s=e,v===0&&x(xn)),s}function Yi(){var s;return t.substr(o,1).toLowerCase()===Sn?(s=t.charAt(o),o++):(s=e,v===0&&x(wn)),s}function oa(){var s;return t.substr(o,1).toLowerCase()===Cn?(s=t.charAt(o),o++):(s=e,v===0&&x(An)),s}function pt(){var s;return t.substr(o,1).toLowerCase()===$n?(s=t.charAt(o),o++):(s=e,v===0&&x(En)),s}function ht(){var s;return t.substr(o,1).toLowerCase()===Ln?(s=t.charAt(o),o++):(s=e,v===0&&x(kn)),s}function Ki(){var s;return t.substr(o,1).toLowerCase()===_n?(s=t.charAt(o),o++):(s=e,v===0&&x(Pn)),s}function es(){var s;return t.substr(o,1).toLowerCase()===Dn?(s=t.charAt(o),o++):(s=e,v===0&&x(Mn)),s}function gt(){var s;return t.substr(o,1).toLowerCase()===Tn?(s=t.charAt(o),o++):(s=e,v===0&&x(On)),s}function er(){var s;return t.substr(o,1).toLowerCase()===Rn?(s=t.charAt(o),o++):(s=e,v===0&&x(In)),s}function ts(){var s;return t.charCodeAt(o)===48?(s=Fn,o++):(s=e,v===0&&x(jn)),s}function tr(){var s;return t.charCodeAt(o)===49?(s=Bn,o++):(s=e,v===0&&x(Un)),s}function rr(){var s;return t.charCodeAt(o)===50?(s=Nn,o++):(s=e,v===0&&x(Wn)),s}function vt(){var s;return t.charCodeAt(o)===44?(s=Vn,o++):(s=e,v===0&&x(zn)),s}function rs(){var s;return t.charCodeAt(o)===58?(s=Hn,o++):(s=e,v===0&&x(qn)),s}function ns(){var s;return t.charCodeAt(o)===59?(s=Gn,o++):(s=e,v===0&&x(Xn)),s}function is(){var s,c;return s=o,t.substr(o,3).toLowerCase()===Jn?(c=t.substr(o,3),o+=3):(c=e,v===0&&x(Zn)),c!==e&&(A=s,c=Qn()),s=c,s}function ss(){var s,c;return s=o,t.substr(o,3).toLowerCase()===Yn?(c=t.substr(o,3),o+=3):(c=e,v===0&&x(Kn)),c!==e&&(A=s,c=ei()),s=c,s}function as(){var s,c,l;return s=o,c=o,l=Gi(),l!==e?c=t.substring(c,o):c=l,c!==e?(l=Yt(),l!==e?(A=s,c=ti(c),s=c):(o=s,s=e)):(o=s,s=e),s}function os(){var s,c,l,f,g;return s=o,c=ts(),c!==e?(l=gt(),l!==e?(f=o,g=qi(),g!==e?f=t.substring(f,o):f=g,f!==e?(A=s,c=ri(f),s=c):(o=s,s=e)):(o=s,s=e)):(o=s,s=e),s}function cs(){var s,c,l;return s=o,c=o,l=Xi(),l!==e?c=t.substring(c,o):c=l,c!==e?(l=Kt(),l===e&&(l=null),l!==e?(A=s,c=ni(c),s=c):(o=s,s=e)):(o=s,s=e),s}function us(){var s,c,l,f;if(s=o,t.charCodeAt(o)===34?(c=ot,o++):(c=e,v===0&&x(ct)),c!==e){for(l=[],f=nr();f!==e;)l.push(f),f=nr();l!==e?(t.charCodeAt(o)===34?(f=ot,o++):(f=e,v===0&&x(ct)),f!==e?(A=s,c=ii(l),s=c):(o=s,s=e)):(o=s,s=e)}else o=s,s=e;return s}function nr(){var s,c,l;return s=o,c=o,v++,t.charCodeAt(o)===34?(l=ot,o++):(l=e,v===0&&x(ct)),v--,l===e?c=void 0:(o=c,c=e),c!==e?(t.length>o?(l=t.charAt(o),o++):(l=e,v===0&&x(ut)),l!==e?(A=s,c=si(l),s=c):(o=s,s=e)):(o=s,s=e),s}function he(){var s,c,l,f,g;if(s=o,c=o,l=[],f=dt(),f!==e)for(;f!==e;)l.push(f),f=dt();else l=e;if(l!==e){for(f=[],g=Qt();g!==e;)f.push(g),g=Qt();f!==e?(l=[l,f],c=l):(o=c,c=e)}else o=c,c=e;return c!==e&&(A=s,c=Ht()),s=c,s}function j(){var s,c;for(v++,s=[],c=ir();c!==e;)s.push(c),c=ir();return v--,s===e&&(c=e,v===0&&x(qt)),s}function ir(){var s,c;return v++,t.charCodeAt(o)===9?(s=ai,o++):(s=e,v===0&&x(oi)),s===e&&(t.charCodeAt(o)===11?(s=ci,o++):(s=e,v===0&&x(ui)),s===e&&(t.charCodeAt(o)===12?(s=li,o++):(s=e,v===0&&x(fi)),s===e&&(t.charCodeAt(o)===32?(s=di,o++):(s=e,v===0&&x(pi)),s===e&&(t.charCodeAt(o)===160?(s=hi,o++):(s=e,v===0&&x(gi)),s===e&&(t.charCodeAt(o)===65279?(s=vi,o++):(s=e,v===0&&x(mi))))))),v--,s===e&&(c=e,v===0&&x(qt)),s}function He(){var s,c;return v++,bi.test(t.charAt(o))?(s=t.charAt(o),o++):(s=e,v===0&&x(xi)),v--,s===e&&(c=e,v===0&&x(yi)),s}function ls(){var s,c,l,f,g,w;if(v++,s=o,c=ns(),c!==e){for(l=[],f=o,g=o,v++,w=He(),v--,w===e?g=void 0:(o=g,g=e),g!==e?(t.length>o?(w=t.charAt(o),o++):(w=e,v===0&&x(ut)),w!==e?(g=[g,w],f=g):(o=f,f=e)):(o=f,f=e);f!==e;)l.push(f),f=o,g=o,v++,w=He(),v--,w===e?g=void 0:(o=g,g=e),g!==e?(t.length>o?(w=t.charAt(o),o++):(w=e,v===0&&x(ut)),w!==e?(g=[g,w],f=g):(o=f,f=e)):(o=f,f=e);l!==e?(c=[c,l],s=c):(o=s,s=e)}else o=s,s=e;return v--,s===e&&(c=e,v===0&&x(Si)),s}function sr(){var s,c,l;return v++,s=o,c=o,l=Ji(),l!==e?c=t.substring(c,o):c=l,c!==e?(l=rs(),l!==e?(A=s,c=Ci(c),s=c):(o=s,s=e)):(o=s,s=e),v--,s===e&&(c=e,v===0&&x(wi)),s}function fs(){var s,c,l,f,g,w;return v++,s=o,c=Ki(),c!==e?(l=es(),l!==e?(f=Yi(),f!==e?(g=j(),g!==e?(w=ar(),w!==e?(A=s,c=$i(w),s=c):(o=s,s=e)):(o=s,s=e)):(o=s,s=e)):(o=s,s=e)):(o=s,s=e),v--,s===e&&(c=e,v===0&&x(Ai)),s}function mt(){var s,c,l;if(v++,s=o,c=[],T.test(t.charAt(o))?(l=t.charAt(o),o++):(l=e,v===0&&x(ie)),l!==e)for(;l!==e;)c.push(l),T.test(t.charAt(o))?(l=t.charAt(o),o++):(l=e,v===0&&x(ie));else c=e;return c!==e&&(A=s,c=Ht()),s=c,v--,s===e&&(c=e,v===0&&x(Ei)),s}function ar(){var s,c;return v++,s=o,c=as(),c!==e&&(A=s,c=ki(c)),s=c,s===e&&(s=o,c=os(),c!==e&&(A=s,c=_i(c)),s=c,s===e&&(s=o,c=cs(),c!==e&&(A=s,c=Pi(c)),s=c,s===e&&(s=o,c=us(),c!==e&&(A=s,c=Di(c)),s=c))),v--,s===e&&(c=e,v===0&&x(Li)),s}function ds(){var s,c,l,f,g,w,O;if(v++,s=o,c=he(),c!==e){for(l=[],f=o,t.substr(o,2)===G?(g=G,o+=2):(g=e,v===0&&x(ke)),g!==e?(w=he(),w!==e?(g=[g,w],f=g):(o=f,f=e)):(o=f,f=e);f!==e;)l.push(f),f=o,t.substr(o,2)===G?(g=G,o+=2):(g=e,v===0&&x(ke)),g!==e?(w=he(),w!==e?(g=[g,w],f=g):(o=f,f=e)):(o=f,f=e);l!==e?(A=s,c=Ti(c,l),s=c):(o=s,s=e)}else o=s,s=e;if(s===e)if(s=o,t.substr(o,2)===G?(c=G,o+=2):(c=e,v===0&&x(ke)),c!==e)if(l=he(),l!==e){for(f=[],g=o,t.substr(o,2)===G?(w=G,o+=2):(w=e,v===0&&x(ke)),w!==e?(O=he(),O!==e?(w=[w,O],g=w):(o=g,g=e)):(o=g,g=e);g!==e;)f.push(g),g=o,t.substr(o,2)===G?(w=G,o+=2):(w=e,v===0&&x(ke)),w!==e?(O=he(),O!==e?(w=[w,O],g=w):(o=g,g=e)):(o=g,g=e);f!==e?(A=s,c=Oi(l,f),s=c):(o=s,s=e)}else o=s,s=e;else o=s,s=e;return v--,s===e&&(c=e,v===0&&x(Mi)),s}function ps(){var s,c,l,f,g;return v++,s=o,c=o,l=Zi(),l===e&&(l=Yt(),l===e&&(l=Qi(),l===e&&(l=Kt(),l===e&&(l=o,f=ht(),f!==e?(g=rr(),g!==e?(f=[f,g],l=f):(o=l,l=e)):(o=l,l=e),l===e&&(l=o,f=ht(),f!==e?(g=tr(),g!==e?(f=[f,g],l=f):(o=l,l=e)):(o=l,l=e),l===e&&(l=ht(),l===e&&(l=o,f=gt(),f!==e?(g=er(),g!==e?(f=[f,g],l=f):(o=l,l=e)):(o=l,l=e),l===e&&(l=gt(),l===e&&(l=er(),l===e&&(l=o,f=pt(),f!==e?(g=tr(),g!==e?(f=[f,g],l=f):(o=l,l=e)):(o=l,l=e),l===e&&(l=o,f=pt(),f!==e?(g=rr(),g!==e?(f=[f,g],l=f):(o=l,l=e)):(o=l,l=e),l===e&&(l=pt())))))))))))),l!==e?c=t.substring(c,o):c=l,c!==e?(l=o,v++,f=dt(),v--,f===e?l=void 0:(o=l,l=e),l!==e?(A=s,c=Ii(c),s=c):(o=s,s=e)):(o=s,s=e),v--,s===e&&(c=e,v===0&&x(Ri)),s}var _=(St(),cr(xt));function hs(s,c){return s.map(function(l){return l[c]})}function qe(s,c,l){return[s].concat(hs(c,l))}function P(){return{...ji()}}if(ze=n(),ze!==e&&o===t.length)return ze;throw ze!==e&&o<t.length&&x(Ui()),Xt(lt,X<t.length?t.charAt(X):null,X<t.length?_e(X,X+1):_e(X,X))}gr.exports={SyntaxError:fe,parse:Os}});var ia={};or(ia,{RCASMWorker:()=>zt,create:()=>na});var se={a:0,d:1},ws={a:0,b:1,m:2,j:3},bt={a:0,b:1,c:2,d:3},$;(function(t){t[t.AluDst=0]="AluDst",t[t.ClrTgt=1]="ClrTgt",t[t.GtoTgt=2]="GtoTgt",t[t.LitOpc=3]="LitOpc",t[t.MovDstSrc=4]="MovDstSrc",t[t.SetTgtVal=5]="SetTgtVal"})($||($={}));var ur={add:{op:128|1,pf:$.AluDst,p1:{cs:se,op:function(t){return t<<3}},p2:null},inc:{op:128|2,pf:$.AluDst,p1:{cs:se,op:function(t){return t<<3}},p2:null},and:{op:128|3,pf:$.AluDst,p1:{cs:se,op:function(t){return t<<3}},p2:null},orr:{op:128|4,pf:$.AluDst,p1:{cs:se,op:function(t){return t<<3}},p2:null},eor:{op:128|5,pf:$.AluDst,p1:{cs:se,op:function(t){return t<<3}},p2:null},cmp:{op:128|5,pf:$.AluDst,p1:{cs:se,op:function(t){return t<<3}},p2:null},not:{op:128|6,pf:$.AluDst,p1:{cs:se,op:function(t){return t<<3}},p2:null},rol:{op:128|7,pf:$.AluDst,p1:{cs:se,op:function(t){return t<<3}},p2:null},mov:{op:0|0,pf:$.MovDstSrc,p1:{cs:bt,op:function(t){return t<<3}},p2:{cs:bt,op:function(t){return t}}},clr:{op:0|0,pf:$.ClrTgt,p1:{cs:bt,op:function(t){return t<<3|t}},p2:null},ldi:{op:0|0,pf:$.SetTgtVal,p1:{cs:ws,op:function(t){return((t&2)===2?192:64)|t<<5}},p2:{cs:null,op:function(t){return t}}},jmp:{op:192|38,pf:$.GtoTgt,p1:null,p2:null},jsr:{op:192|39,pf:$.GtoTgt,p1:null,p2:null},bne:{op:192|34,pf:$.GtoTgt,p1:null,p2:null},beq:{op:192|36,pf:$.GtoTgt,p1:null,p2:null},bcs:{op:192|40,pf:$.GtoTgt,p1:null,p2:null},bmi:{op:192|48,pf:$.GtoTgt,p1:null,p2:null},blt:{op:192|48,pf:$.GtoTgt,p1:null,p2:null},ble:{op:192|52,pf:$.GtoTgt,p1:null,p2:null},opc:{op:0|0,pf:$.LitOpc,p1:{cs:null,op:function(t){return t}},p2:null}},lr=[["clr a","mov a,b","mov a,c","mov a,d",null,null,null,null,"mov b,a","clr b","mov b,c","mov b,d",null,null,null,null],["mov c,a","mov c,b","clr c","mov c,d",null,null,null,null,"mov d,a","mov d,b","mov d,c","clr d",null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["ldi a,0","ldi a,1","ldi a,2","ldi a,3","ldi a,4","ldi a,5","ldi a,6","ldi a,7","ldi a,8","ldi a,9","ldi a,10","ldi a,11","ldi a,12","ldi a,13","ldi a,14","ldi a,15"],["ldi a,-16","ldi a,-15","ldi a,-14","ldi a,-13","ldi a,-12","ldi a,-11","ldi a,-10","ldi a,-9","ldi a,-8","ldi a,-7","ldi a,-6","ldi a,-5","ldi a,-4","ldi a,-3","ldi a,-2","ldi a,-1"],["ldi b,0","ldi b,1","ldi b,2","ldi b,3","ldi b,4","ldi b,5","ldi b,6","ldi b,7","ldi b,8","ldi b,9","ldi b,10","ldi b,11","ldi b,12","ldi b,13","ldi b,14","ldi b,15"],["ldi b,-16","ldi b,-15","ldi b,-14","ldi b,-13","ldi b,-12","ldi b,-11","ldi b,-10","ldi b,-9","ldi b,-8","ldi b,-7","ldi b,-6","ldi b,-5","ldi b,-4","ldi b,-3","ldi b,-2","ldi b,-1"],["clr a","add","inc","and","orr","eor","not","rol","clr d","add d","inc d","and d","orr d","eor d","not d","rol d"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["ldi m,",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["ldi j,",null,"bne",null,"beq",null,"jmp","jsr","bcs",null,null,null,null,null,null,null],["blt","jlt",null,null,"ble",null,null,null,null,null,null,null,null,null,null,null]],fr=function(t){switch(!0){case(t&192)===0:return{class:"MOV8",cycles:1};case(t&192)===4:return{class:"SETAB",cycles:1};case(t&240)===128:return{class:"ALU",cycles:1};case(t&192)===192:return{class:"GOTO",cycles:3};default:return{class:"MISC",cycles:1}}};function W(t){return t.toString(16).padStart(4,"0")}St();var wt=function(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],i=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},Ge=function(t,r){var e=typeof Symbol=="function"&&t[Symbol.iterator];if(!e)return t;var i=e.call(t),n,a=[],u;try{for(;(r===void 0||r-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(d){u={error:d}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(u)throw u.error}}return a},Xe=function(){function t(r,e,i,n){this.start=r,this.end=e,this.inferStart=i,this.id=n,this.blocks=[{start:r,binary:[]}],this.curBlock=this.blocks[0]}return t.prototype.setCurrentPC=function(r){var e=void 0;if(this.inferStart&&this.blocks.length===1&&this.blocks[0].binary.length===0)this.start=r;else{var i=this.end!==void 0?"$".concat(W(this.end)):"",n="Segment address range: $".concat(W(this.start),"-").concat(i);r<this.start?e="".concat(n,".  Cannot set program counter to a lower address $").concat(W(r),"."):this.end!==void 0&&r>this.end?e="".concat(n,".  Trying to set program counter to $").concat(W(r)," -- it is past segment end ").concat(i,"."):this.blocks.length===1&&this.blocks[0].binary.length===0&&(this.start=r)}var a={start:r,binary:[]},u=this.blocks.push(a);return this.curBlock=this.blocks[u-1],e},t.prototype.empty=function(){return this.blocks.every(function(r){return r.binary.length===0})},t.prototype.currentPC=function(){return this.curBlock.start+this.curBlock.binary.length},t.prototype.emit=function(r){if(this.currentPC()<this.start||this.end!==void 0&&this.currentPC()>this.end){var e=this.end!==void 0?"$".concat(W(this.end)):"",i=this.start!==void 0?"$".concat(W(this.start)):"";return"Segment overflow at $".concat(W(this.currentPC()),".  Segment address range: ").concat(i,"-").concat(e)}this.curBlock.binary.push(r)},t.prototype.formatRange=function(){var r=this.end!==void 0?"$".concat(W(this.end)):"",e=this.start!==void 0?"$".concat(W(this.start)):"";return"".concat(e,"-").concat(r)},t.prototype.overlaps=function(r){var e=this.start,i=r.start,n=this.end!==void 0?this.end:this.currentPC(),a=r.end!==void 0?r.end:r.currentPC();return e<i?i<=n:a>=e},t}();function dr(t){var r,e,i=[];try{for(var n=wt(t),a=n.next();!a.done;a=n.next()){var u=Ge(a.value,2),d=u[0],m=u[1],h=m.blocks.filter(function(b){return b.binary.length!==0}).sort(function(b,C){return b.start-C.start});if(h.length!==0){var y=new Xe(m.start,m.end,m.inferStart,i.length-1);y.blocks=h,y.curBlock=h[h.length-1],i.push([d,y])}}}catch(b){r={error:b}}finally{try{a&&!a.done&&(e=n.return)&&e.call(n)}finally{if(r)throw r.error}}return i}function pr(t){var r,e,i,n,a=dr(t);if(a.length===0)return{startPC:0,binary:Uint8Array.from([])};for(var u=Ge(a[0],2),d=u[0],m=u[1],h=m.blocks[0],y=m.blocks[m.blocks.length-1],b=h.start,C=y.start+y.binary.length,S=1;S<a.length;S++){var k=a[S][1],M=k.blocks[0].start,K=k.curBlock.start+k.curBlock.binary.length;b=Math.min(M,b),C=Math.max(K,C)}var oe=new Uint8Array(C);try{for(var V=wt(a),N=V.next();!N.done;N=V.next()){var ce=Ge(N.value,2),$e=ce[0],ue=ce[1];try{for(var z=(i=void 0,wt(ue.blocks)),I=z.next();!I.done;I=z.next())for(var ee=I.value,S=0;S<ee.binary.length;S++)oe[ee.start+S]=ee.binary[S]}catch(ne){i={error:ne}}finally{try{I&&!I.done&&(n=z.return)&&n.call(z)}finally{if(i)throw i.error}}}}catch(ne){r={error:ne}}finally{try{N&&!N.done&&(e=V.return)&&e.call(V)}finally{if(r)throw r.error}}return{startPC:b,binary:oe.slice(b)}}function hr(t){var r=dr(t).sort(function(e,i){return e[1].start-i[1].start});return r.map(function(e){var i=Ge(e,2),n=i[0],a=i[1],u=a.blocks.map(function(d){return{start:d.start,end:d.start+d.binary.length-1}});return{name:n,blocks:u}})}var q=function(){return q=Object.assign||function(t){for(var r,e=1,i=arguments.length;e<i;e++){r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},q.apply(this,arguments)},Ct=function(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],i=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},de=function(t,r){var e=typeof Symbol=="function"&&t[Symbol.iterator];if(!e)return t;var i=e.call(t),n,a=[],u;try{for(;(r===void 0||r-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(d){u={error:d}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(u)throw u.error}}return a},ge=function(t,r,e){if(e||arguments.length===2)for(var i=0,n=r.length,a;i<n;i++)(a||!(i in r))&&(a||(a=Array.prototype.slice.call(r,0,i)),a[i]=r[i]);return t.concat(a||Array.prototype.slice.call(r))},mr=vr();function At(t){return{value:t,errors:!0,completeFirstPass:!1}}function Et(t,r){return{value:t,errors:!1,completeFirstPass:r}}function Je(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.some(function(e){return e!==void 0&&e.errors})}var Rs=function(){function t(r,e){this.syms=new Map,this.parent=null,this.children=new Map,this.parent=r,this.name=e}return t.prototype.findSymbol=function(r){for(var e=this;e!==null;e=e.parent){var i=e.syms.get(r);if(i!==void 0)return i}},t.prototype.findSymbolPath=function(r){if(r.length===1)return this.findSymbol(r[0]);for(var e=this;e.children.get(r[0])===void 0;)if(e=e.parent,e===null)return;for(var i=0;i<r.length-1;i++)if(e=e.children.get(r[i]),e===void 0)return;return e.syms.get(r[r.length-1])},t.prototype.addSymbol=function(r,e,i){this.syms.set(r,q(q({},e),{seen:i}))},t.prototype.updateSymbol=function(r,e,i){for(var n=this;n!==null;n=n.parent){var a=n.syms.get(r);if(a!==void 0){n.syms.set(r,q(q({},e),{seen:i}));return}}},t}(),Is=function(){function t(){this.passCount=0,this.root=new Rs(null,""),this.curSymtab=this.root,this.anonScopeCount=0}return t.prototype.startPass=function(r){this.curSymtab=this.root,this.anonScopeCount=0,this.passCount=r},t.prototype.findPath=function(r,e){return e?this.root.findSymbolPath(r):this.curSymtab.findSymbolPath(r)},t.prototype.findQualifiedSym=function(r,e){return this.findPath(r,e)},t.prototype.symbolSeen=function(r){var e=this.curSymtab.syms.get(r);return e!==void 0?e.seen===this.passCount:!1},t.prototype.declareLabelSymbol=function(r,e,i){var n=r.name,a=r.loc,u=this.curSymtab.syms.get(n);if(u===void 0){var d={type:"label",segment:i,data:Et({addr:e,loc:a},!1)};return this.curSymtab.addSymbol(n,d,this.passCount),!1}if(u.type!=="label")throw new Error("ICE: declareLabelSymbol should be called only on labels");var m=u;if(m.data.value.addr!==e){var h={type:"label",segment:i,data:q(q({},u.data),{value:q(q({},u.data.value),{addr:e})})};return this.curSymtab.updateSymbol(n,h,this.passCount),!0}return this.curSymtab.updateSymbol(n,u,this.passCount),!1},t.prototype.dumpLabels=function(r,e){var i,n,a,u,d,m,h={};try{for(var y=Ct(e),b=y.next();!b.done;b=y.next()){var C=de(b.value,2),S=C[0],k=C[1];h[k.id]=S}}catch(F){i={error:F}}finally{try{b&&!b.done&&(n=y.return)&&n.call(y)}finally{if(i)throw i.error}}var M=[],K=function(F,T){if(F!==void 0){var ie=ge(ge([],de(F),!1),[T.name],!1);M.push({path:ie,sym:T})}else M.push({path:[],sym:T})};K(void 0,this.root);for(var oe=[];M.length>0;){var k=M.pop();try{for(var V=(a=void 0,Ct(k.sym.syms)),N=V.next();!N.done;N=V.next()){var ce=de(N.value,2),$e=ce[0],ue=ce[1];ue.type==="label"&&oe.push({path:ge(ge([],de(k.path),!1),[$e],!1),addr:ue.data.value.addr,size:0,segmentName:h[ue.segment.id]})}}catch(T){a={error:T}}finally{try{N&&!N.done&&(u=V.return)&&u.call(V)}finally{if(a)throw a.error}}try{for(var z=(d=void 0,Ct(k.sym.children)),I=z.next();!I.done;I=z.next()){var ee=de(I.value,2),$e=ee[0],ne=ee[1];K(k.path,ne)}}catch(T){d={error:T}}finally{try{I&&!I.done&&(m=z.return)&&m.call(z)}finally{if(d)throw d.error}}}var te=oe.sort(function(F,T){return F.addr-T.addr}),Ee=te.length;if(Ee>0){for(var le=1;le<Ee;le++)te[le-1].size=te[le].addr-te[le-1].addr;var Le=te[Ee-1];Le.size=r-Le.addr}return te.map(function(F){var T=F.path,ie=F.addr,Ne=F.size,We=F.segmentName;return{name:T.join("::"),addr:ie,size:Ne,segmentName:We}})},t}();function $t(t){var r=typeof t;return r==="object"&&t instanceof Array?"array":r}function Fs(t){return"".concat(t.absolute?"::":"").concat(t.path.join("::"))}var js=function(){function t(){var r=this;this.curSegmentName="",this.curSegment=new Xe(0,0,!1,0),this.pass=0,this.needPass=!1,this.scopes=new Is,this.segments=[],this.errorList=[],this.warningList=[],this.errors=function(){return r.formatErrors(r.errorList,"error")},this.warnings=function(){return r.formatErrors(r.warningList,"warning")}}return t.prototype.prg=function(){var r=pr(this.segments),e=r.startPC,i=r.binary,n=e&255,a=e>>8&255;return Uint8Array.from(ge([n,a],de(i),!1))},t.prototype.anyErrors=function(){return this.errorList.length!==0},t.prototype.formatErrors=function(r,e){var i=new Set(r.map(function(n){return JSON.stringify(n)}));return ge([],de(i),!1).map(function(n){var a=JSON.parse(n),u=a.loc,d=a.msg,m="<unknown>:1:1: ".concat(e,": ").concat(d);return u&&(m="".concat(u.start.line,":").concat(u.start.column,": ").concat(e,": ").concat(d)),{loc:u,msg:d,formatted:m}})},t.prototype.addError=function(r,e){this.errorList.push({msg:r,loc:e})},t.prototype.addWarning=function(r,e){this.warningList.push({msg:r,loc:e})},t.prototype.startPass=function(r){this.pass=r,this.needPass=!1,this.errorList=[],this.scopes.startPass(r),this.segments=[];var e=this.newSegment("default",0,void 0,!0);this.setCurrentSegment({type:"segment",data:e},"default")},t.prototype.setCurrentSegment=function(r,e){this.curSegmentName=e,this.curSegment=r.data},t.prototype.newSegment=function(r,e,i,n){var a=new Xe(e,i,n,this.segments.length-1);return this.segments.push([r,a]),a},t.prototype.getPC=function(){return this.curSegment.currentPC()},t.prototype.evalExprType=function(r,e,i){var n=this.evalExpr(r),a=n.errors,u=n.value,d=n.completeFirstPass;return!a&&typeof u!==e?(this.addError("Expecting ".concat(i," to be '").concat(e,"' type, got '").concat($t(u),"'"),r.loc),{errors:!0,completeFirstPass:d,value:u}):n},t.prototype.evalExprToInt=function(r,e){return this.evalExprType(r,"number",e)},t.prototype.evalExpr=function(r){switch(r.type){case"literal":return Et(r.lit,!0);case"register":return this.addError("Unexpected register",r.loc),At(0);case"ident":throw new Error("should not see an ident here -- if you do, it is probably a wrong type node in parser");case"qualified-ident":{var e=this.scopes.findQualifiedSym(r.path,r.absolute);if(e===void 0)return this.pass>=1?(this.addError("Undefined symbol '".concat(Fs(r),"'"),r.loc),At(0)):(this.needPass=!0,Et(0,!1));switch(e.type){case"label":return{errors:e.data.errors,value:e.data.value.addr,completeFirstPass:e.seen===this.pass}}break}default:break}throw new Error("should be unreachable on ".concat(r))},t.prototype.emit=function(r){var e=this.curSegment.emit(r);e!==void 0&&this.addError(e,this.lineLoc)},t.prototype.emit16=function(r){this.emit(r>>8&255),this.emit(r&255)},t.prototype.assembleAluInstr=function(r,e){e.p2&&this.addWarning("Parameter not required",e.p2.loc);var i=r.op;if(e.p1&&r.p1){var n=this.checkRegister(e.p1,r.p1);if(n===void 0)return;i|=r.p1.op(n)}this.emit(i)},t.prototype.assembleClrInstr=function(r,e){e.p2&&this.addWarning("Parameter not required",e.p2.loc);var i=r.op;if(!e.p1||!r.p1){this.addError("Parameter required",e.loc);return}var n=this.checkRegister(e.p1,r.p1);n!==void 0&&(i|=r.p1.op(n),this.emit(i))},t.prototype.assembleMovInstr=function(r,e){if(!e.p1||!r.p1||!e.p2||!r.p2){this.addError("Two parameters required",e.loc);return}var i=r.op,n=this.checkRegister(e.p1,r.p1);if(n!==void 0){i|=r.p1.op(n);var a=this.checkRegister(e.p2,r.p2);a!==void 0&&(i|=r.p2.op(a),this.emit(i))}},t.prototype.assembleLitOpc=function(r,e){e.p2&&this.addWarning("Parameter not required",e.p2.loc);var i=r.op;if(!e.p1||!r.p1){this.addError("Parameter required",e.loc);return}var n=this.checkLiteral(e.p1,0,255,"h");n!==void 0&&(i|=r.p1.op(n),this.emit(i))},t.prototype.assembleSetInstr=function(r,e){if(!e.p1||!r.p1||!e.p2||!r.p2){this.addError("Two parameters required",e.loc);return}var i=r.op,n=this.checkRegister(e.p1,r.p1);if(n!==void 0){if(i|=r.p1.op(n),n<=16){var a=this.checkLiteral(e.p2,-16,15);if(a===void 0)return;i|=r.p2.op(a)}this.emit(i)}},t.prototype.checkRegister=function(r,e){if(r.type!=="register")this.addError("Register required",r.loc);else{var i=e.cs[r.value];return i===void 0&&this.addError("Invalid register - choose one of [".concat(Object.keys(e.cs).join("|"),"]"),r.loc),i}},t.prototype.checkLiteral=function(r,e,i,n){n===void 0&&(n="d");var a=this.evalExprToInt(r,"value");if(!Je(a)){var u=a.value;if(u<e||u>i){var d="";switch(n){case"b":var m=i.toString(2),h=("0".repeat(m.length)+e.toString(2)).slice(-m.length);d="".concat(h,"b and ").concat(m,"b");break;case"h":var y=i.toString(16).toUpperCase(),b=("0".repeat(y.length)+e.toString(16).toUpperCase()).slice(-y.length);d="0x".concat(b," and 0x").concat(y);break;default:d="".concat(e," and ").concat(i)}this.addError("Literal out of range (must be between ".concat(d,")"),r.loc)}else return u}},t.prototype.assembleBranch=function(r,e){if(e.p2&&this.addWarning("Parameter not required",e.p2.loc),!e.p1){this.addError("Parameter required",e.loc);return}if(e.p1.type!=="qualified-ident"){this.addError("Identifier required",e.p1.loc);return}var i=this.evalExpr(e.p1);if(!Je(i)){if(typeof i.value!="number"){this.addError("Expecting branch label to evaluate to integer, got ".concat($t(i.value)),e.p1.loc);return}var n=i.value;this.emit(r.op),this.emit((n&65280)>>8),this.emit(n&255)}},t.prototype.handleSetPC=function(r){var e=this.evalExprToInt(r,"pc");if(!Je(e)){var i=e.value,n=e.completeFirstPass;if(!n){this.addError("Value for new program counter must evaluate to a value in the first pass",r.loc);return}!this.curSegment.empty()&&this.curSegment.currentPC()>i&&this.addError("Cannot set program counter to a smaller value than current (current: $".concat(W(this.curSegment.currentPC()),", trying to set $").concat(W(i),")"),r.loc);var a=this.curSegment.setCurrentPC(i);a!==void 0&&this.addError(a,r.loc)}},t.prototype.emit8or16=function(r,e){if(e===8){this.emit(r);return}this.emit16(r)},t.prototype.emitData=function(r,e){for(var i=this,n=Math.pow(2,e),a=0;a<r.length;a++){var u=this.evalExpr(r[a]);if(!Je(u)){var d=u.value;if(typeof d=="number")d>=n?this.addError("Data out of range for ".concat(e," bits"),r[a].loc):this.emit8or16(d,e);else if(typeof d=="string"){var m=d.split("").map(function(h){return h.charCodeAt(0)});m.find(function(h){return h>=n})?this.addError("Data contains character out of range for ".concat(e," bits"),r[a].loc):m.forEach(function(h){return i.emit8or16(h,e)})}else this.addError("Only literal types can be emitted. Got ".concat($t(d)),r[a].loc)}}},t.prototype.checkDirectives=function(r,e){switch(r.type){case"data":{this.emitData(r.values,r.dataSize===Pe.Byte?8:16);break}case"setpc":{this.handleSetPC(r.pc);break}default:this.addError("unknown directive ".concat(r.type),r.loc);return}},t.prototype.assembleLines=function(r){var e=this;if(!(r===null||r.length===0)&&r.length!==0){for(var i=function(m){for(var h=0;h<m.length;h++)e.assembleLine(m[h])},n=0;n<r.length;){var a=r[n],u=a.label,d=a.stmt;if(u===null&&d===null)n++;else break}if(!(n>=r.length))return i(r)}},t.prototype.checkAndDeclareLabel=function(r){if(this.scopes.symbolSeen(r.name))this.addError("Symbol '".concat(r.name,"' already defined"),r.loc);else{var e=this.scopes.declareLabelSymbol(r,this.getPC(),this.curSegment);e&&(this.needPass=!0)}},t.prototype.assembleLine=function(r){if(this.lineLoc=r.loc,!(r.label===null&&r.stmt===null)&&(r.label!==null&&this.checkAndDeclareLabel(r.label),r.stmt!==null)){if(r.stmt.type!=="insn"){this.checkDirectives(r.stmt,r.label===null?null:r.label.name);return}var e=r.stmt,i=ur[e.mnemonic.toLocaleLowerCase()];if(i!==void 0)switch(i.pf){case $.AluDst:this.assembleAluInstr(i,e);break;case $.ClrTgt:this.assembleClrInstr(i,e);break;case $.MovDstSrc:this.assembleMovInstr(i,e);break;case $.LitOpc:this.assembleLitOpc(i,e);break;case $.SetTgtVal:this.assembleSetInstr(i,e);break;case $.GtoTgt:this.assembleBranch(i,e);break;default:this.addError("Couldn't encode instruction '".concat(e.mnemonic," '"),r.loc)}else this.addError("Unknown mnemonic '".concat(e.mnemonic,"'"),e.loc)}},t.prototype.assemble=function(r){try{var e=mr.parse(r.toString());e!==void 0&&e.lines&&this.assembleLines(e.lines)}catch(i){if("name"in i&&i.name==="SyntaxError")this.addError("Syntax error: ".concat(i.message),q({},i.location));else{if("name"in i&&i.name==="semantic")return;throw i}}},t.prototype.dumpLabels=function(){return this.scopes.dumpLabels(this.getPC(),this.segments)},t.prototype.collectSegmentInfo=function(){return hr(this.segments)},t}();function Lt(t){try{return mr.parse(t.toString())}catch{return}}function kt(t){var r=new js,e=0;do{if(r.startPass(e),r.assemble(t),e>0&&r.anyErrors())return{prg:Uint8Array.from([]),labels:[],segments:[],errors:r.errors(),warnings:r.warnings()};e+=1}while(r.needPass);return{prg:r.prg(),errors:r.errors(),warnings:r.warnings(),labels:r.dumpLabels(),segments:r.collectSegmentInfo()}}function Ze(t){return"".concat(t.toString(16).toUpperCase().padStart(2,"0"))}function yr(t){return"".concat(t.toString(16).toUpperCase().padStart(4,"0"))}function Bs(t,r){var e=0,i=t.length,n=[];for(e=0;e<i;e+=r){var a=t.slice(e,e+r);n.push(a)}return n}var ma=function(){function t(r){var e=this;this.buf=r,this.outputPadChars="     ",this.outputBytesPerLine=1,this.bytes={startPC:0,bytes:[]},this.byte=function(){var i=e.buf[e.curOffs];return e.curOffs++,i},this.print=function(i,n,a,u){e.flushBytes();var d=Ze(n[0]),m=n.length>=2?Ze(n[1]):"  ",h=n.length>=3?Ze(n[2]):"  ",y="".concat(yr(i),": ").concat(d," ").concat(m," ").concat(h).concat(e.outputPadChars).concat(a);e.output.push(y)},this.output=[],this.curAddr=r[0]+(r[1]<<8),this.curOffs=2}return t.prototype.flushBytes=function(){for(var r=Bs(this.bytes.bytes,this.outputBytesPerLine),e=this.bytes.startPC,i=0;i<r.length;i++,e+=this.outputBytesPerLine){var n=r[i],a=n.map(function(u){return Ze(u)}).join(" ");this.output.push("".concat(yr(e),": ").concat(a))}this.bytes.bytes=[]},t.prototype.disSingle=function(r,e,i){var n=this.curAddr;this.print(n,[e],r,i.cycles.toString())},t.prototype.disTriple=function(r,e,i){var n=this.curAddr,a=this.byte(),u=this.byte();this.print(n,[e,a,u],r,i.cycles.toString())},t.prototype.disUnknown=function(r){this.bytes.bytes.length!==0?this.bytes.bytes.push(r):(this.bytes.bytes=[r],this.bytes.startPC=this.curAddr)},t.prototype.disassemble=function(){for(var r=this.buf.byteLength,e=function(d){return!0},i=this.curOffs;this.curOffs<r;){this.curAddr+=this.curOffs-i,i=this.curOffs;var n=this.byte(),a=lr[(n&240)>>4][n&15];if(a!==null){var u=fr(n);if(u.cycles===3){this.disTriple(a,n,u);continue}else{this.disSingle(a,n,u);continue}}else this.disUnknown(n)}return this.flushBytes(),this.output},t}();var Z=function(){var t=function(r,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},t(r,e)};return function(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");t(r,e);function i(){this.constructor=r}r.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),D;(function(t){t[t.Program=0]="Program",t[t.Line=1]="Line",t[t.Label=2]="Label",t[t.LabelRef=3]="LabelRef",t[t.Instruction=4]="Instruction",t[t.Literal=5]="Literal",t[t.Register=6]="Register",t[t.SetPC=7]="SetPC",t[t.Expr=8]="Expr",t[t.Data=9]="Data"})(D||(D={}));var De;(function(t){t[t.Label=0]="Label"})(De||(De={}));function Qe(t,r){var e=null;return!t||r<t.offset||r>t.end?null:(t.accept(function(i){return i.offset===-1&&i.length===-1?!0:i.offset<=r&&i.end>=r?(e?i.length<=e.length&&(e=i):e=i,!0):!1}),e)}function xr(t,r){for(var e=Qe(t,r),i=[];e;)i.unshift(e),e=e.parent;return i}var Q=function(){function t(r,e){var i,n;this.nodeType=e,this.parent=null,this.offset=(i=r==null?void 0:r.loc.start.offset)!==null&&i!==void 0?i:0,this.length=((n=r==null?void 0:r.loc.end.offset)!==null&&n!==void 0?n:0)-this.offset}return Object.defineProperty(t.prototype,"end",{get:function(){return this.offset+this.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.nodeType},enumerable:!1,configurable:!0}),t.prototype.getTextProvider=function(){for(var r=this;r&&!r.textProvider;)r=r.parent;return r?r.textProvider:function(){return"unknown"}},t.prototype.getText=function(){return this.getTextProvider()(this.offset,this.length)},t.prototype.matches=function(r){return this.length===r.length&&this.getTextProvider()(this.offset,this.length)===r},t.prototype.accept=function(r){if(r(this)&&this.children)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];n.accept(r)}},t.prototype.acceptVisitor=function(r){this.accept(r.visitNode.bind(r))},t.prototype.adoptChild=function(r){r.parent=this;var e=this.children;return e||(e=this.children=[]),e.push(r),r},t}();var Sr=function(t){Z(r,t);function r(e){var i=this,n;return i=t.call(this,e,D.Program)||this,(n=e==null?void 0:e.lines)===null||n===void 0||n.forEach(function(a){return i.adoptChild(new Us(a))}),i}return r}(Q);var Us=function(t){Z(r,t);function r(e){var i=t.call(this,e,D.Line)||this;if(e.label&&i.adoptChild(new ve(e.label)),e.stmt)switch(e.stmt.type){case"insn":i.adoptChild(new Dt(e.stmt));break;case"setpc":i.adoptChild(new _t(e.stmt));break;case"data":i.adoptChild(new Pt(e.stmt))}return i}return r}(Q),ve=function(t){Z(r,t);function r(e){var i=t.call(this,e,D.Label)||this;return i.length--,i}return r}(Q);var _t=function(t){Z(r,t);function r(e){var i=t.call(this,e,D.SetPC)||this;return i.pcExpr=i.adoptChild(new Ns(e.pc)),i}return r}(Q);var Pt=function(t){Z(r,t);function r(e){return t.call(this,e,D.Data)||this}return r}(Q);var Ns=function(t){Z(r,t);function r(e){return t.call(this,e,D.Expr)||this}return r}(Q);var Dt=function(t){Z(r,t);function r(e){var i=t.call(this,e,D.Instruction)||this,n=function(a){switch(a.type){case"literal":return i.adoptChild(new Mt(a));case"register":return i.adoptChild(new Tt(a));case"qualified-ident":return i.adoptChild(new Me(a));default:return}};return i.mnemonic=e.mnemonic.toLowerCase(),e.p1&&(i.p1=n(e.p1)),e.p2&&(i.p2=n(e.p2)),i}return r}(Q);var Me=function(t){Z(r,t);function r(e){return t.call(this,e,D.LabelRef)||this}return r}(Q);var Mt=function(t){Z(r,t);function r(e){var i=t.call(this,e,D.Literal)||this;return i.value=e.lit,i}return r}(Q);var Tt=function(t){Z(r,t);function r(e){var i=t.call(this,e,D.Register)||this;return i.value=e.value.toUpperCase(),i}return r}(Q);var wr=function(){function t(){}return t.prototype.parseProgram=function(r){var e=r.version,i=r.getText(),n=Lt(r.getText()),a=new Sr(n),u=function(d,m){if(r.version!==e)throw new Error("Underlying model has changed, AST is no longer valid");return i.substr(d,m)};return a.textProvider=u,a},t}();var Cr={version:1,mnemonics:[{name:"add",class:"ALU",summary:"Arithmetic Add",description:"Adds the contents of register B and C (B+C) placing the result in register A or D.",synopsis:"{0} = B + C",syntax:"[ a | d ]"},{name:"and",class:"ALU",summary:"Logic And",description:"Performs a bitwise AND operation on register B and C (B&C) placing the result in register A or D.",synopsis:"{0} = B & C",syntax:"[ a | d ]"},{name:"bcs",class:"GOTO",summary:"Branch if Carry Set",snippet:"bcs ${1:label}",description:"Jumps to the given address if the carry flag is set.",synopsis:"PC = {0} [if CY]",syntax:"<label>"},{name:"beq",class:"GOTO",summary:"Branch if Equal/Zero",snippet:"beq ${1:label}",description:"Jumps to the given address if the zero flag is set (equal).",synopsis:"PC = {0} [if Z]",syntax:"<label>"},{name:"ble",class:"GOTO",summary:"Branch if Less Than or Equal (Sign+Zero)",snippet:"ble ${1:label}",description:"Jumps to the given address if the sign or zero flag is set (less than or equal).",synopsis:"PC = {0} [if S or Z]",syntax:"<label>"},{name:"blt",class:"GOTO",summary:"Branch if Less Than (Sign)",snippet:"blt ${1:label}",description:"Jumps to the given address if the sign flag is set (less than).",synopsis:"PC = {0} [if S]",syntax:"<label>"},{name:"bmi",class:"GOTO",summary:"Branch if Minus/Sign",snippet:"bmi ${1:label}",description:"Jumps to the given address if the sign flag is set (negative).",synopsis:"PC = {0} [if S]",syntax:"<label>"},{name:"bne",class:"GOTO",summary:"Branch if Not Equal/Zero",snippet:"bne ${1:label}",description:"Jumps to the given address if the zero flag is not set (not equal).",synopsis:"PC = {0} [if not Z]",syntax:"<label>"},{name:"clr",class:"MOV8",summary:"Zero Value",description:"Clears the content (=0) of a given 8-bit register.",synopsis:"{0} = 0",syntax:"<target>{a,d}"},{name:"cmp",class:"ALU",summary:"Compare (Logic Xor)",description:"Compares the values in register B and C setting the zero flag if the same (affects register A or D) (equivalent to eor).",synopsis:"{0} = B != C",syntax:"[ a | d ]"},{name:"eor",class:"ALU",summary:"Logic Xor",description:"Performs a bitwise XOR operation on register B and C (B^C) placing the result in register A or D.",synopsis:"{0} = B ^ C",syntax:"[ a | d ]"},{name:"inc",class:"ALU",summary:"Increment",description:"Increments contents of register B placing the result in register A or D",synopsis:"{0} = B + 1",syntax:"[ a | d ]"},{name:"jmp",class:"GOTO",summary:"Jump to Label",snippet:"jmp ${1:label}",description:"Unconditionally jumps to the given address.",synopsis:"PC = {0}",syntax:"<label>"},{name:"jsr",class:"GOTO",summary:"Call Subroutine (Jump and Link)",snippet:"jsr ${1:label}",description:"Calls the subroutine at the given address.",synopsis:"XY = PC, PC = {0}",syntax:"<label>"},{name:"ldi",class:"SETAB",summary:"Load Immediate",snippet:"ldi ${1:a},${2:0}",description:"Loads an 8-bit value in to register A/B or a 16-bit value in to register M/J.",synopsis:"{0} = {1}",syntax:"[ <target>{a|b} , <value>{-16,15} ] | [ <target>{m|j} , [ <value>{0x0000,0xFFFF} | <label> ] ]"},{name:"mov",class:"MOV8",summary:"Copy Register to Register",snippet:"mov ${1:b},${2:a}",description:"Copies the content of one 8-bit register to another.",synopsis:"{0} = {1}",syntax:"<destination>{a,d} , <source>{a,d}"},{name:"not",class:"ALU",summary:"Logic Not",description:"Performs a bitwise NOT operation on register B (~B) placing the result in register A or D.",synopsis:"{0} = ~B",syntax:"[ a | d ]"},{name:"opc",class:"PSEUDO",summary:"Literal Opcode",snippet:"opc ${1:opcode}",description:"Performs the given machine opcode directly.",syntax:"[ <opcode>{0x00,0xFF} | <opcode>{0b00000000,0b11111111} ]"},{name:"orr",class:"ALU",summary:"Logic Or",description:"Performs a bitwise OR operation on register B and C (B|C) placing the result in register A or D.",synopsis:"{0} = B | C",syntax:"[ a | d ]"},{name:"rol",class:"ALU",summary:"Bitwise Circular Shift Left",description:"Performs a bitwise left rotation on register B (<<B) placing the result in register A or D.",synopsis:"{0} = <<B",syntax:"[ a | d ]"},{name:"org",class:"PSEUDO",summary:"Set Program Counter",description:"Sets the program counter to the given address such that the following instructions start from that location.",synopsis:"PC = {0}",syntax:"<value>{0x0000,0xFFFF}"},{name:"dfb",class:"PSEUDO",summary:"Define Byte Data",description:"Writes the given 8-bit values directly into the output starting from current location.",syntax:"<value>{0x00,0xFF} [ ,...n ]"},{name:"dfw",class:"PSEUDO",summary:"Define Word Data",description:"Writes the given 16-bit values directly into the output starting from current location.",syntax:"<value>{0x0000,0xFFFF} [ ,...n ]"}]};function Ar(t){return Object.keys(t).map(function(r){return t[r]})}function me(t){return typeof t<"u"}var $r=function(){function t(r){this.dataProviders=r,this._mnemonicSet={},this._mnemonics=[],this.collectData()}return t.prototype.collectData=function(){var r=this;this.dataProviders.forEach(function(e){e.provideMnemonics().forEach(function(i){r._mnemonicSet[i.name]||(r._mnemonicSet[i.name]=i)})}),this._mnemonics=Ar(this._mnemonicSet)},t.prototype.getMnemonic=function(r){return this._mnemonicSet[r]},t.prototype.getMnemonics=function(){return this._mnemonics},t}();var Er=function(){function t(r){this._mnemonics=[],this.addData(r)}return t.prototype.provideMnemonics=function(){return this._mnemonics},t.prototype.addData=function(r){r.mnemonics&&(this._mnemonics=this._mnemonics.concat(r.mnemonics))},t}();function Ke(t,r){return r?{kind:"markdown",value:Hs(t)}:{kind:"plaintext",value:zs(t)}}function zs(t){if(!t.description||t.description==="")return"";if(typeof t.description!="string")return t.description.value;var r="";return r+=t.description,"syntax"in t&&(r+=`

Syntax: `.concat(t.syntax)),r}function Hs(t){if(!t.description||t.description==="")return"";var r="";return typeof t.description=="string"?r+=t.description:r=t.description.value,"syntax"in t&&(r+=`

Syntax: \``.concat(t.syntax,"`")),r}function Ot(t,r,e){return e?{kind:"markdown",value:Lr(Gs(t),r)}:{kind:"plaintext",value:Lr(qs(t),r)}}function Lr(t,r){if(!r||r.length===0)return t;for(var e=0;e<r.length;e++)t=t.replace("{".concat(e,"}"),r[e]);return t}function qs(t){if(!t.synopsis||t.synopsis==="")return"";var r="";return t.summary&&(t.class?r+="".concat(t.summary," [").concat(t.class,`]

`):r+="".concat(t.summary,`

`)),r+=t.synopsis,r}function Gs(t){if(!t.synopsis||t.synopsis==="")return"";var r="";return t.summary&&(t.class?r+="".concat(t.summary," [").concat(t.class,`]

`):r+="".concat(t.summary,`

`)),r+="`"+t.synopsis+"`",r}var ye=new $r([new Er(Cr)]);var _r;(function(t){t.MIN_VALUE=-2147483648,t.MAX_VALUE=2147483647})(_r||(_r={}));var tt;(function(t){t.MIN_VALUE=0,t.MAX_VALUE=2147483647})(tt||(tt={}));var B;(function(t){function r(i,n){return i===Number.MAX_VALUE&&(i=tt.MAX_VALUE),n===Number.MAX_VALUE&&(n=tt.MAX_VALUE),{line:i,character:n}}t.create=r;function e(i){var n=i;return p.objectLiteral(n)&&p.uinteger(n.line)&&p.uinteger(n.character)}t.is=e})(B||(B={}));var L;(function(t){function r(i,n,a,u){if(p.uinteger(i)&&p.uinteger(n)&&p.uinteger(a)&&p.uinteger(u))return{start:B.create(i,n),end:B.create(a,u)};if(B.is(i)&&B.is(n))return{start:i,end:n};throw new Error("Range#create called with invalid arguments["+i+", "+n+", "+a+", "+u+"]")}t.create=r;function e(i){var n=i;return p.objectLiteral(n)&&B.is(n.start)&&B.is(n.end)}t.is=e})(L||(L={}));var xe;(function(t){function r(i,n){return{uri:i,range:n}}t.create=r;function e(i){var n=i;return p.defined(n)&&L.is(n.range)&&(p.string(n.uri)||p.undefined(n.uri))}t.is=e})(xe||(xe={}));var Pr;(function(t){function r(i,n,a,u){return{targetUri:i,targetRange:n,targetSelectionRange:a,originSelectionRange:u}}t.create=r;function e(i){var n=i;return p.defined(n)&&L.is(n.targetRange)&&p.string(n.targetUri)&&(L.is(n.targetSelectionRange)||p.undefined(n.targetSelectionRange))&&(L.is(n.originSelectionRange)||p.undefined(n.originSelectionRange))}t.is=e})(Pr||(Pr={}));var Rt;(function(t){function r(i,n,a,u){return{red:i,green:n,blue:a,alpha:u}}t.create=r;function e(i){var n=i;return p.numberRange(n.red,0,1)&&p.numberRange(n.green,0,1)&&p.numberRange(n.blue,0,1)&&p.numberRange(n.alpha,0,1)}t.is=e})(Rt||(Rt={}));var Dr;(function(t){function r(i,n){return{range:i,color:n}}t.create=r;function e(i){var n=i;return L.is(n.range)&&Rt.is(n.color)}t.is=e})(Dr||(Dr={}));var Mr;(function(t){function r(i,n,a){return{label:i,textEdit:n,additionalTextEdits:a}}t.create=r;function e(i){var n=i;return p.string(n.label)&&(p.undefined(n.textEdit)||Y.is(n))&&(p.undefined(n.additionalTextEdits)||p.typedArray(n.additionalTextEdits,Y.is))}t.is=e})(Mr||(Mr={}));var Tr;(function(t){t.Comment="comment",t.Imports="imports",t.Region="region"})(Tr||(Tr={}));var Or;(function(t){function r(i,n,a,u,d){var m={startLine:i,endLine:n};return p.defined(a)&&(m.startCharacter=a),p.defined(u)&&(m.endCharacter=u),p.defined(d)&&(m.kind=d),m}t.create=r;function e(i){var n=i;return p.uinteger(n.startLine)&&p.uinteger(n.startLine)&&(p.undefined(n.startCharacter)||p.uinteger(n.startCharacter))&&(p.undefined(n.endCharacter)||p.uinteger(n.endCharacter))&&(p.undefined(n.kind)||p.string(n.kind))}t.is=e})(Or||(Or={}));var It;(function(t){function r(i,n){return{location:i,message:n}}t.create=r;function e(i){var n=i;return p.defined(n)&&xe.is(n.location)&&p.string(n.message)}t.is=e})(It||(It={}));var Se;(function(t){t.Error=1,t.Warning=2,t.Information=3,t.Hint=4})(Se||(Se={}));var Rr;(function(t){t.Unnecessary=1,t.Deprecated=2})(Rr||(Rr={}));var Ir;(function(t){function r(e){var i=e;return i!=null&&p.string(i.href)}t.is=r})(Ir||(Ir={}));var Te;(function(t){function r(i,n,a,u,d,m){var h={range:i,message:n};return p.defined(a)&&(h.severity=a),p.defined(u)&&(h.code=u),p.defined(d)&&(h.source=d),p.defined(m)&&(h.relatedInformation=m),h}t.create=r;function e(i){var n,a=i;return p.defined(a)&&L.is(a.range)&&p.string(a.message)&&(p.number(a.severity)||p.undefined(a.severity))&&(p.integer(a.code)||p.string(a.code)||p.undefined(a.code))&&(p.undefined(a.codeDescription)||p.string((n=a.codeDescription)===null||n===void 0?void 0:n.href))&&(p.string(a.source)||p.undefined(a.source))&&(p.undefined(a.relatedInformation)||p.typedArray(a.relatedInformation,It.is))}t.is=e})(Te||(Te={}));var Oe;(function(t){function r(i,n){for(var a=[],u=2;u<arguments.length;u++)a[u-2]=arguments[u];var d={title:i,command:n};return p.defined(a)&&a.length>0&&(d.arguments=a),d}t.create=r;function e(i){var n=i;return p.defined(n)&&p.string(n.title)&&p.string(n.command)}t.is=e})(Oe||(Oe={}));var Y;(function(t){function r(a,u){return{range:a,newText:u}}t.replace=r;function e(a,u){return{range:{start:a,end:a},newText:u}}t.insert=e;function i(a){return{range:a,newText:""}}t.del=i;function n(a){var u=a;return p.objectLiteral(u)&&p.string(u.newText)&&L.is(u.range)}t.is=n})(Y||(Y={}));var be;(function(t){function r(i,n,a){var u={label:i};return n!==void 0&&(u.needsConfirmation=n),a!==void 0&&(u.description=a),u}t.create=r;function e(i){var n=i;return n!==void 0&&p.objectLiteral(n)&&p.string(n.label)&&(p.boolean(n.needsConfirmation)||n.needsConfirmation===void 0)&&(p.string(n.description)||n.description===void 0)}t.is=e})(be||(be={}));var R;(function(t){function r(e){var i=e;return typeof i=="string"}t.is=r})(R||(R={}));var ae;(function(t){function r(a,u,d){return{range:a,newText:u,annotationId:d}}t.replace=r;function e(a,u,d){return{range:{start:a,end:a},newText:u,annotationId:d}}t.insert=e;function i(a,u){return{range:a,newText:"",annotationId:u}}t.del=i;function n(a){var u=a;return Y.is(u)&&(be.is(u.annotationId)||R.is(u.annotationId))}t.is=n})(ae||(ae={}));var rt;(function(t){function r(i,n){return{textDocument:i,edits:n}}t.create=r;function e(i){var n=i;return p.defined(n)&&nt.is(n.textDocument)&&Array.isArray(n.edits)}t.is=e})(rt||(rt={}));var Re;(function(t){function r(i,n,a){var u={kind:"create",uri:i};return n!==void 0&&(n.overwrite!==void 0||n.ignoreIfExists!==void 0)&&(u.options=n),a!==void 0&&(u.annotationId=a),u}t.create=r;function e(i){var n=i;return n&&n.kind==="create"&&p.string(n.uri)&&(n.options===void 0||(n.options.overwrite===void 0||p.boolean(n.options.overwrite))&&(n.options.ignoreIfExists===void 0||p.boolean(n.options.ignoreIfExists)))&&(n.annotationId===void 0||R.is(n.annotationId))}t.is=e})(Re||(Re={}));var Ie;(function(t){function r(i,n,a,u){var d={kind:"rename",oldUri:i,newUri:n};return a!==void 0&&(a.overwrite!==void 0||a.ignoreIfExists!==void 0)&&(d.options=a),u!==void 0&&(d.annotationId=u),d}t.create=r;function e(i){var n=i;return n&&n.kind==="rename"&&p.string(n.oldUri)&&p.string(n.newUri)&&(n.options===void 0||(n.options.overwrite===void 0||p.boolean(n.options.overwrite))&&(n.options.ignoreIfExists===void 0||p.boolean(n.options.ignoreIfExists)))&&(n.annotationId===void 0||R.is(n.annotationId))}t.is=e})(Ie||(Ie={}));var Fe;(function(t){function r(i,n,a){var u={kind:"delete",uri:i};return n!==void 0&&(n.recursive!==void 0||n.ignoreIfNotExists!==void 0)&&(u.options=n),a!==void 0&&(u.annotationId=a),u}t.create=r;function e(i){var n=i;return n&&n.kind==="delete"&&p.string(n.uri)&&(n.options===void 0||(n.options.recursive===void 0||p.boolean(n.options.recursive))&&(n.options.ignoreIfNotExists===void 0||p.boolean(n.options.ignoreIfNotExists)))&&(n.annotationId===void 0||R.is(n.annotationId))}t.is=e})(Fe||(Fe={}));var Ft;(function(t){function r(e){var i=e;return i&&(i.changes!==void 0||i.documentChanges!==void 0)&&(i.documentChanges===void 0||i.documentChanges.every(function(n){return p.string(n.kind)?Re.is(n)||Ie.is(n)||Fe.is(n):rt.is(n)}))}t.is=r})(Ft||(Ft={}));var et=function(){function t(r,e){this.edits=r,this.changeAnnotations=e}return t.prototype.insert=function(r,e,i){var n,a;if(i===void 0?n=Y.insert(r,e):R.is(i)?(a=i,n=ae.insert(r,e,i)):(this.assertChangeAnnotations(this.changeAnnotations),a=this.changeAnnotations.manage(i),n=ae.insert(r,e,a)),this.edits.push(n),a!==void 0)return a},t.prototype.replace=function(r,e,i){var n,a;if(i===void 0?n=Y.replace(r,e):R.is(i)?(a=i,n=ae.replace(r,e,i)):(this.assertChangeAnnotations(this.changeAnnotations),a=this.changeAnnotations.manage(i),n=ae.replace(r,e,a)),this.edits.push(n),a!==void 0)return a},t.prototype.delete=function(r,e){var i,n;if(e===void 0?i=Y.del(r):R.is(e)?(n=e,i=ae.del(r,e)):(this.assertChangeAnnotations(this.changeAnnotations),n=this.changeAnnotations.manage(e),i=ae.del(r,n)),this.edits.push(i),n!==void 0)return n},t.prototype.add=function(r){this.edits.push(r)},t.prototype.all=function(){return this.edits},t.prototype.clear=function(){this.edits.splice(0,this.edits.length)},t.prototype.assertChangeAnnotations=function(r){if(r===void 0)throw new Error("Text edit change is not configured to manage change annotations.")},t}(),Fr=function(){function t(r){this._annotations=r===void 0?Object.create(null):r,this._counter=0,this._size=0}return t.prototype.all=function(){return this._annotations},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),t.prototype.manage=function(r,e){var i;if(R.is(r)?i=r:(i=this.nextId(),e=r),this._annotations[i]!==void 0)throw new Error("Id "+i+" is already in use.");if(e===void 0)throw new Error("No annotation provided for id "+i);return this._annotations[i]=e,this._size++,i},t.prototype.nextId=function(){return this._counter++,this._counter.toString()},t}(),_a=function(){function t(r){var e=this;this._textEditChanges=Object.create(null),r!==void 0?(this._workspaceEdit=r,r.documentChanges?(this._changeAnnotations=new Fr(r.changeAnnotations),r.changeAnnotations=this._changeAnnotations.all(),r.documentChanges.forEach(function(i){if(rt.is(i)){var n=new et(i.edits,e._changeAnnotations);e._textEditChanges[i.textDocument.uri]=n}})):r.changes&&Object.keys(r.changes).forEach(function(i){var n=new et(r.changes[i]);e._textEditChanges[i]=n})):this._workspaceEdit={}}return Object.defineProperty(t.prototype,"edit",{get:function(){return this.initDocumentChanges(),this._changeAnnotations!==void 0&&(this._changeAnnotations.size===0?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit},enumerable:!1,configurable:!0}),t.prototype.getTextEditChange=function(r){if(nt.is(r)){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var e={uri:r.uri,version:r.version},i=this._textEditChanges[e.uri];if(!i){var n=[],a={textDocument:e,edits:n};this._workspaceEdit.documentChanges.push(a),i=new et(n,this._changeAnnotations),this._textEditChanges[e.uri]=i}return i}else{if(this.initChanges(),this._workspaceEdit.changes===void 0)throw new Error("Workspace edit is not configured for normal text edit changes.");var i=this._textEditChanges[r];if(!i){var n=[];this._workspaceEdit.changes[r]=n,i=new et(n),this._textEditChanges[r]=i}return i}},t.prototype.initDocumentChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._changeAnnotations=new Fr,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())},t.prototype.initChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._workspaceEdit.changes=Object.create(null))},t.prototype.createFile=function(r,e,i){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var n;be.is(e)||R.is(e)?n=e:i=e;var a,u;if(n===void 0?a=Re.create(r,i):(u=R.is(n)?n:this._changeAnnotations.manage(n),a=Re.create(r,i,u)),this._workspaceEdit.documentChanges.push(a),u!==void 0)return u},t.prototype.renameFile=function(r,e,i,n){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var a;be.is(i)||R.is(i)?a=i:n=i;var u,d;if(a===void 0?u=Ie.create(r,e,n):(d=R.is(a)?a:this._changeAnnotations.manage(a),u=Ie.create(r,e,n,d)),this._workspaceEdit.documentChanges.push(u),d!==void 0)return d},t.prototype.deleteFile=function(r,e,i){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var n;be.is(e)||R.is(e)?n=e:i=e;var a,u;if(n===void 0?a=Fe.create(r,i):(u=R.is(n)?n:this._changeAnnotations.manage(n),a=Fe.create(r,i,u)),this._workspaceEdit.documentChanges.push(a),u!==void 0)return u},t}();var jr;(function(t){function r(i){return{uri:i}}t.create=r;function e(i){var n=i;return p.defined(n)&&p.string(n.uri)}t.is=e})(jr||(jr={}));var Br;(function(t){function r(i,n){return{uri:i,version:n}}t.create=r;function e(i){var n=i;return p.defined(n)&&p.string(n.uri)&&p.integer(n.version)}t.is=e})(Br||(Br={}));var nt;(function(t){function r(i,n){return{uri:i,version:n}}t.create=r;function e(i){var n=i;return p.defined(n)&&p.string(n.uri)&&(n.version===null||p.integer(n.version))}t.is=e})(nt||(nt={}));var Ur;(function(t){function r(i,n,a,u){return{uri:i,languageId:n,version:a,text:u}}t.create=r;function e(i){var n=i;return p.defined(n)&&p.string(n.uri)&&p.string(n.languageId)&&p.integer(n.version)&&p.string(n.text)}t.is=e})(Ur||(Ur={}));var U;(function(t){t.PlainText="plaintext",t.Markdown="markdown"})(U||(U={}));(function(t){function r(e){var i=e;return i===t.PlainText||i===t.Markdown}t.is=r})(U||(U={}));var it;(function(t){function r(e){var i=e;return p.objectLiteral(e)&&U.is(i.kind)&&p.string(i.value)}t.is=r})(it||(it={}));var st;(function(t){t.Text=1,t.Method=2,t.Function=3,t.Constructor=4,t.Field=5,t.Variable=6,t.Class=7,t.Interface=8,t.Module=9,t.Property=10,t.Unit=11,t.Value=12,t.Enum=13,t.Keyword=14,t.Snippet=15,t.Color=16,t.File=17,t.Reference=18,t.Folder=19,t.EnumMember=20,t.Constant=21,t.Struct=22,t.Event=23,t.Operator=24,t.TypeParameter=25})(st||(st={}));var je;(function(t){t.PlainText=1,t.Snippet=2})(je||(je={}));var Nr;(function(t){t.Deprecated=1})(Nr||(Nr={}));var Wr;(function(t){function r(i,n,a){return{newText:i,insert:n,replace:a}}t.create=r;function e(i){var n=i;return n&&p.string(n.newText)&&L.is(n.insert)&&L.is(n.replace)}t.is=e})(Wr||(Wr={}));var Vr;(function(t){t.asIs=1,t.adjustIndentation=2})(Vr||(Vr={}));var zr;(function(t){function r(e){return{label:e}}t.create=r})(zr||(zr={}));var jt;(function(t){function r(e,i){return{items:e||[],isIncomplete:!!i}}t.create=r})(jt||(jt={}));var Be;(function(t){function r(i){return i.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}t.fromPlainText=r;function e(i){var n=i;return p.string(n)||p.objectLiteral(n)&&p.string(n.language)&&p.string(n.value)}t.is=e})(Be||(Be={}));var Bt;(function(t){function r(e){var i=e;return!!i&&p.objectLiteral(i)&&(it.is(i.contents)||Be.is(i.contents)||p.typedArray(i.contents,Be.is))&&(e.range===void 0||L.is(e.range))}t.is=r})(Bt||(Bt={}));var Hr;(function(t){function r(e,i){return i?{label:e,documentation:i}:{label:e}}t.create=r})(Hr||(Hr={}));var qr;(function(t){function r(e,i){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];var u={label:e};return p.defined(i)&&(u.documentation=i),p.defined(n)?u.parameters=n:u.parameters=[],u}t.create=r})(qr||(qr={}));var we;(function(t){t.Text=1,t.Read=2,t.Write=3})(we||(we={}));var Ut;(function(t){function r(e,i){var n={range:e};return p.number(i)&&(n.kind=i),n}t.create=r})(Ut||(Ut={}));var Ce;(function(t){t.File=1,t.Module=2,t.Namespace=3,t.Package=4,t.Class=5,t.Method=6,t.Property=7,t.Field=8,t.Constructor=9,t.Enum=10,t.Interface=11,t.Function=12,t.Variable=13,t.Constant=14,t.String=15,t.Number=16,t.Boolean=17,t.Array=18,t.Object=19,t.Key=20,t.Null=21,t.EnumMember=22,t.Struct=23,t.Event=24,t.Operator=25,t.TypeParameter=26})(Ce||(Ce={}));var Gr;(function(t){t.Deprecated=1})(Gr||(Gr={}));var Nt;(function(t){function r(e,i,n,a,u){var d={name:e,kind:i,location:{uri:a,range:n}};return u&&(d.containerName=u),d}t.create=r})(Nt||(Nt={}));var Xr;(function(t){function r(i,n,a,u,d,m){var h={name:i,detail:n,kind:a,range:u,selectionRange:d};return m!==void 0&&(h.children=m),h}t.create=r;function e(i){var n=i;return n&&p.string(n.name)&&p.number(n.kind)&&L.is(n.range)&&L.is(n.selectionRange)&&(n.detail===void 0||p.string(n.detail))&&(n.deprecated===void 0||p.boolean(n.deprecated))&&(n.children===void 0||Array.isArray(n.children))&&(n.tags===void 0||Array.isArray(n.tags))}t.is=e})(Xr||(Xr={}));var Jr;(function(t){t.Empty="",t.QuickFix="quickfix",t.Refactor="refactor",t.RefactorExtract="refactor.extract",t.RefactorInline="refactor.inline",t.RefactorRewrite="refactor.rewrite",t.Source="source",t.SourceOrganizeImports="source.organizeImports",t.SourceFixAll="source.fixAll"})(Jr||(Jr={}));var Zr;(function(t){function r(i,n){var a={diagnostics:i};return n!=null&&(a.only=n),a}t.create=r;function e(i){var n=i;return p.defined(n)&&p.typedArray(n.diagnostics,Te.is)&&(n.only===void 0||p.typedArray(n.only,p.string))}t.is=e})(Zr||(Zr={}));var Qr;(function(t){function r(i,n,a){var u={title:i},d=!0;return typeof n=="string"?(d=!1,u.kind=n):Oe.is(n)?u.command=n:u.edit=n,d&&a!==void 0&&(u.kind=a),u}t.create=r;function e(i){var n=i;return n&&p.string(n.title)&&(n.diagnostics===void 0||p.typedArray(n.diagnostics,Te.is))&&(n.kind===void 0||p.string(n.kind))&&(n.edit!==void 0||n.command!==void 0)&&(n.command===void 0||Oe.is(n.command))&&(n.isPreferred===void 0||p.boolean(n.isPreferred))&&(n.edit===void 0||Ft.is(n.edit))}t.is=e})(Qr||(Qr={}));var Yr;(function(t){function r(i,n){var a={range:i};return p.defined(n)&&(a.data=n),a}t.create=r;function e(i){var n=i;return p.defined(n)&&L.is(n.range)&&(p.undefined(n.command)||Oe.is(n.command))}t.is=e})(Yr||(Yr={}));var Kr;(function(t){function r(i,n){return{tabSize:i,insertSpaces:n}}t.create=r;function e(i){var n=i;return p.defined(n)&&p.uinteger(n.tabSize)&&p.boolean(n.insertSpaces)}t.is=e})(Kr||(Kr={}));var en;(function(t){function r(i,n,a){return{range:i,target:n,data:a}}t.create=r;function e(i){var n=i;return p.defined(n)&&L.is(n.range)&&(p.undefined(n.target)||p.string(n.target))}t.is=e})(en||(en={}));var tn;(function(t){function r(i,n){return{range:i,parent:n}}t.create=r;function e(i){var n=i;return n!==void 0&&L.is(n.range)&&(n.parent===void 0||t.is(n.parent))}t.is=e})(tn||(tn={}));var rn;(function(t){function r(a,u,d,m){return new Xs(a,u,d,m)}t.create=r;function e(a){var u=a;return!!(p.defined(u)&&p.string(u.uri)&&(p.undefined(u.languageId)||p.string(u.languageId))&&p.uinteger(u.lineCount)&&p.func(u.getText)&&p.func(u.positionAt)&&p.func(u.offsetAt))}t.is=e;function i(a,u){for(var d=a.getText(),m=n(u,function(k,M){var K=k.range.start.line-M.range.start.line;return K===0?k.range.start.character-M.range.start.character:K}),h=d.length,y=m.length-1;y>=0;y--){var b=m[y],C=a.offsetAt(b.range.start),S=a.offsetAt(b.range.end);if(S<=h)d=d.substring(0,C)+b.newText+d.substring(S,d.length);else throw new Error("Overlapping edit");h=C}return d}t.applyEdits=i;function n(a,u){if(a.length<=1)return a;var d=a.length/2|0,m=a.slice(0,d),h=a.slice(d);n(m,u),n(h,u);for(var y=0,b=0,C=0;y<m.length&&b<h.length;){var S=u(m[y],h[b]);S<=0?a[C++]=m[y++]:a[C++]=h[b++]}for(;y<m.length;)a[C++]=m[y++];for(;b<h.length;)a[C++]=h[b++];return a}})(rn||(rn={}));var Xs=function(){function t(r,e,i,n){this._uri=r,this._languageId=e,this._version=i,this._content=n,this._lineOffsets=void 0}return Object.defineProperty(t.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),t.prototype.getText=function(r){if(r){var e=this.offsetAt(r.start),i=this.offsetAt(r.end);return this._content.substring(e,i)}return this._content},t.prototype.update=function(r,e){this._content=r.text,this._version=e,this._lineOffsets=void 0},t.prototype.getLineOffsets=function(){if(this._lineOffsets===void 0){for(var r=[],e=this._content,i=!0,n=0;n<e.length;n++){i&&(r.push(n),i=!1);var a=e.charAt(n);i=a==="\r"||a===`
`,a==="\r"&&n+1<e.length&&e.charAt(n+1)===`
`&&n++}i&&e.length>0&&r.push(e.length),this._lineOffsets=r}return this._lineOffsets},t.prototype.positionAt=function(r){r=Math.max(Math.min(r,this._content.length),0);var e=this.getLineOffsets(),i=0,n=e.length;if(n===0)return B.create(0,r);for(;i<n;){var a=Math.floor((i+n)/2);e[a]>r?n=a:i=a+1}var u=i-1;return B.create(u,r-e[u])},t.prototype.offsetAt=function(r){var e=this.getLineOffsets();if(r.line>=e.length)return this._content.length;if(r.line<0)return 0;var i=e[r.line],n=r.line+1<e.length?e[r.line+1]:this._content.length;return Math.max(Math.min(i+r.character,n),i)},Object.defineProperty(t.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),t}(),p;(function(t){var r=Object.prototype.toString;function e(S){return typeof S<"u"}t.defined=e;function i(S){return typeof S>"u"}t.undefined=i;function n(S){return S===!0||S===!1}t.boolean=n;function a(S){return r.call(S)==="[object String]"}t.string=a;function u(S){return r.call(S)==="[object Number]"}t.number=u;function d(S,k,M){return r.call(S)==="[object Number]"&&k<=S&&S<=M}t.numberRange=d;function m(S){return r.call(S)==="[object Number]"&&-2147483648<=S&&S<=2147483647}t.integer=m;function h(S){return r.call(S)==="[object Number]"&&0<=S&&S<=2147483647}t.uinteger=h;function y(S){return r.call(S)==="[object Function]"}t.func=y;function b(S){return S!==null&&typeof S=="object"}t.objectLiteral=b;function C(S,k){return Array.isArray(S)&&S.every(k)}t.typedArray=C})(p||(p={}));var Ae=class{constructor(r,e,i,n){this._uri=r,this._languageId=e,this._version=i,this._content=n,this._lineOffsets=void 0}get uri(){return this._uri}get languageId(){return this._languageId}get version(){return this._version}getText(r){if(r){let e=this.offsetAt(r.start),i=this.offsetAt(r.end);return this._content.substring(e,i)}return this._content}update(r,e){for(let i of r)if(Ae.isIncremental(i)){let n=sn(i.range),a=this.offsetAt(n.start),u=this.offsetAt(n.end);this._content=this._content.substring(0,a)+i.text+this._content.substring(u,this._content.length);let d=Math.max(n.start.line,0),m=Math.max(n.end.line,0),h=this._lineOffsets,y=nn(i.text,!1,a);if(m-d===y.length)for(let C=0,S=y.length;C<S;C++)h[C+d+1]=y[C];else y.length<1e4?h.splice(d+1,m-d,...y):this._lineOffsets=h=h.slice(0,d+1).concat(y,h.slice(m+1));let b=i.text.length-(u-a);if(b!==0)for(let C=d+1+y.length,S=h.length;C<S;C++)h[C]=h[C]+b}else if(Ae.isFull(i))this._content=i.text,this._lineOffsets=void 0;else throw new Error("Unknown change event received");this._version=e}getLineOffsets(){return this._lineOffsets===void 0&&(this._lineOffsets=nn(this._content,!0)),this._lineOffsets}positionAt(r){r=Math.max(Math.min(r,this._content.length),0);let e=this.getLineOffsets(),i=0,n=e.length;if(n===0)return{line:0,character:r};for(;i<n;){let u=Math.floor((i+n)/2);e[u]>r?n=u:i=u+1}let a=i-1;return{line:a,character:r-e[a]}}offsetAt(r){let e=this.getLineOffsets();if(r.line>=e.length)return this._content.length;if(r.line<0)return 0;let i=e[r.line],n=r.line+1<e.length?e[r.line+1]:this._content.length;return Math.max(Math.min(i+r.character,n),i)}get lineCount(){return this.getLineOffsets().length}static isIncremental(r){let e=r;return e!=null&&typeof e.text=="string"&&e.range!==void 0&&(e.rangeLength===void 0||typeof e.rangeLength=="number")}static isFull(r){let e=r;return e!=null&&typeof e.text=="string"&&e.range===void 0&&e.rangeLength===void 0}},Ue;(function(t){function r(n,a,u,d){return new Ae(n,a,u,d)}t.create=r;function e(n,a,u){if(n instanceof Ae)return n.update(a,u),n;throw new Error("TextDocument.update: document must be created by TextDocument.create")}t.update=e;function i(n,a){let u=n.getText(),d=Wt(a.map(Js),(y,b)=>{let C=y.range.start.line-b.range.start.line;return C===0?y.range.start.character-b.range.start.character:C}),m=0,h=[];for(let y of d){let b=n.offsetAt(y.range.start);if(b<m)throw new Error("Overlapping edit");b>m&&h.push(u.substring(m,b)),y.newText.length&&h.push(y.newText),m=n.offsetAt(y.range.end)}return h.push(u.substr(m)),h.join("")}t.applyEdits=i})(Ue||(Ue={}));function Wt(t,r){if(t.length<=1)return t;let e=t.length/2|0,i=t.slice(0,e),n=t.slice(e);Wt(i,r),Wt(n,r);let a=0,u=0,d=0;for(;a<i.length&&u<n.length;)r(i[a],n[u])<=0?t[d++]=i[a++]:t[d++]=n[u++];for(;a<i.length;)t[d++]=i[a++];for(;u<n.length;)t[d++]=n[u++];return t}function nn(t,r,e=0){let i=r?[e]:[];for(let n=0;n<t.length;n++){let a=t.charCodeAt(n);(a===13||a===10)&&(a===13&&n+1<t.length&&t.charCodeAt(n+1)===10&&n++,i.push(e+n+1))}return i}function sn(t){let r=t.start,e=t.end;return r.line>e.line||r.line===e.line&&r.character>e.character?{start:e,end:r}:t}function Js(t){let r=sn(t.range);return r!==t.range?{newText:t.newText,range:r}:t}var an;(function(t){t.LATEST={textDocument:{completion:{completionItem:{documentationFormat:[U.Markdown,U.PlainText]}},hover:{contentFormat:[U.Markdown,U.PlainText]}}}})(an||(an={}));var on=function(){function t(r){this.clientCapabilities=r}return t.prototype.doComplete=function(r,e,i){this.offset=r.offsetAt(e),this.position=e,this.currentWord=Zs(r,this.offset),this.defaultReplaceRange=L.create(B.create(this.position.line,this.position.character-this.currentWord.length),this.position),this.textDocument=r,this.program=i;try{var n={isIncomplete:!1,items:[]},a=r.getText(L.create(B.create(this.position.line,0),this.position));return a.match(/^([a-z]+:)?([ \t]+)?([a-z]{0,3})$/i)&&this.getCompletionsForMnemonic(n),n}finally{this.position=null,this.currentWord=null,this.textDocument=null,this.program=null,this.defaultReplaceRange=null}},t.prototype.getCompletionsForMnemonic=function(r){var e=this,i=ye.getMnemonics();return i.forEach(function(n){var a,u,d;u=e.getCompletionRange(null),d=(a=n.snippet)!==null&&a!==void 0?a:n.name;var m={label:n.name,detail:n.class?"".concat(n.summary," [").concat(n.class,"]"):n.summary,documentation:Ke(n,e.doesSupportMarkdown()),textEdit:Y.replace(u,d),insertTextFormat:je.Snippet,kind:st.Function};r.items.push(m)}),r},t.prototype.doesSupportMarkdown=function(){if(!me(this.supportsMarkdown)){if(!me(this.clientCapabilities))return this.supportsMarkdown=!0,this.supportsMarkdown;var r=this.clientCapabilities&&this.clientCapabilities.textDocument&&this.clientCapabilities.textDocument.hover;this.supportsMarkdown=r&&r.contentFormat&&Array.isArray(r.contentFormat)&&r.contentFormat.indexOf(U.Markdown)!==-1}return this.supportsMarkdown},t.prototype.getCompletionRange=function(r){if(r&&r.offset<=this.offset&&this.offset<=r.end){var e=r.end!==-1?this.textDocument.positionAt(r.end):this.position,i=this.textDocument.positionAt(r.offset);if(i.line===e.line)return L.create(i,e)}return this.defaultReplaceRange},t}();function Zs(t,r){for(var e=r-1,i=t.getText();e>=0&&` 	
\r:,`.indexOf(i.charAt(e))===-1;)e--;return i.substring(e+1,r)}var cn=function(){function t(r){this.clientCapabilities=r}return t.prototype.doHover=function(r,e,i){function n(M){return L.create(r.positionAt(M.offset),r.positionAt(M.end))}for(var a=r.offsetAt(e),u=xr(i,a),d=null,m=0;m<u.length;m++){var h=u[m];if(h instanceof Dt){var y=h.mnemonic,b=ye.getMnemonic(y);if(b){var C=this.getParamNames(b,h),S=Ot(b,C,this.doesSupportMarkdown());d={contents:S,range:n(h)}}}if(h instanceof _t){var b=ye.getMnemonic("org");if(b){var C=[h.pcExpr.getText()],S=Ot(b,C,this.doesSupportMarkdown());d={contents:S,range:n(h)}}}if(h instanceof Pt){var k=h.getText().slice(0,3).toLowerCase(),b=ye.getMnemonic(k);if(b){var S=Ke(b,this.doesSupportMarkdown());d={contents:S,range:n(h)}}}}return d&&(d.contents=this.convertContents(d.contents)),d},t.prototype.getParamNames=function(r,e){var i=[];return e.p1?i.push(this.getParamName(e.p1,e.mnemonic)):r.class==="ALU"?i.push("A"):i.push("?"),e.p2?i.push(this.getParamName(e.p2,e.mnemonic)):i.push("?"),i},t.prototype.getParamName=function(r,e){return r instanceof Tt?r.value:r instanceof Me?"(".concat(r.getText(),")"):r instanceof Mt?e.toLowerCase()==="ldi"&&r.value>15?"0x".concat(r.value.toString(16).toUpperCase()):r.value.toString():"?"},t.prototype.convertContents=function(r){return this.doesSupportMarkdown()||typeof r=="string"?r:"kind"in r?{kind:"plaintext",value:r.value}:Array.isArray(r)?r.map(function(e){return typeof e=="string"?e:e.value}):r.value},t.prototype.doesSupportMarkdown=function(){if(!me(this.supportsMarkdown)){if(!me(this.clientCapabilities))return this.supportsMarkdown=!0,this.supportsMarkdown;var r=this.clientCapabilities.textDocument&&this.clientCapabilities.textDocument.hover;this.supportsMarkdown=r&&r.contentFormat&&Array.isArray(r.contentFormat)&&r.contentFormat.indexOf(U.Markdown)!==-1}return this.supportsMarkdown},t}();var Qs=function(){var t=function(r,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},t(r,e)};return function(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");t(r,e);function i(){this.constructor=r}r.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Ys=function(){function t(r,e){this.symbols=[]}return t.prototype.addSymbol=function(r){this.symbols.push(r)},t.prototype.getSymbol=function(r,e){for(var i=0;i<this.symbols.length;i++){var n=this.symbols[i];if(n.name===r&&n.type===e)return n}return null},t}();var Ks=function(t){Qs(r,t);function r(){return t.call(this,0,Number.MAX_VALUE)||this}return r}(Ys);var ea=function(){function t(r,e,i,n){this.name=r,this.value=e,this.node=i,this.type=n}return t}();var ta=function(){function t(r){this.scope=r}return t.prototype.addSymbol=function(r,e,i,n){r.offset!==-1&&this.scope.addSymbol(new ea(e,i,r,n))},t.prototype.visitNode=function(r){switch(r.type){case D.Label:return this.addSymbol(r,r.getText(),void 0,De.Label),!0}return!0},t}();var Vt=function(){function t(r){this.global=new Ks,r.acceptVisitor(new ta(this.global))}return t.prototype.internalFindSymbol=function(r,e){for(var i=r.getText(),n=this.global,a=0;a<e.length;a++){var u=e[a],d=n.getSymbol(i,u);if(d)return d}return null},t.prototype.evaluateReferenceTypes=function(r){return r instanceof Me||r instanceof ve?[De.Label]:null},t.prototype.findSymbolFromNode=function(r){if(!r)return null;var e=this.evaluateReferenceTypes(r);return e?this.internalFindSymbol(r,e):null},t.prototype.matchesSymbol=function(r,e){if(!r||!r.matches(e.name))return!1;var i=this.evaluateReferenceTypes(r);if(!i||i.indexOf(e.type)===-1)return!1;var n=this.internalFindSymbol(r,i);return n===e},t}();var ln=function(){function t(){}return t.prototype.findDefinition=function(r,e,i){var n=new Vt(i),a=r.offsetAt(e),u=Qe(i,a);if(!u)return null;var d=n.findSymbolFromNode(u);return d?{uri:r.uri,range:at(d.node,r)}:null},t.prototype.findReferences=function(r,e,i){var n=this.findDocumentHighlights(r,e,i);return n.map(function(a){return{uri:r.uri,range:a.range}})},t.prototype.findDocumentHighlights=function(r,e,i){var n=[],a=r.offsetAt(e),u=Qe(i,a);if(!u||u.type!==D.Label&&u.type!==D.LabelRef)return n;var d=new Vt(i),m=d.findSymbolFromNode(u),h=u.getText();return i.accept(function(y){if(m){if(d.matchesSymbol(y,m))return n.push({kind:un(y),range:at(y,r)}),!1}else u&&u.type===y.type&&y.matches(h)&&n.push({kind:un(y),range:at(y,r)});return!0}),n},t.prototype.findDocumentSymbols=function(r,e){var i=[];return e.accept(function(n){var a={name:null,kind:Ce.Class,location:null},u=n;return n instanceof ve&&(a.name=n.getText(),a.kind=Ce.Variable),a.name&&(a.location=xe.create(r.uri,at(u,r)),i.push(a)),!0}),i},t}();function un(t){return t instanceof ve?we.Write:we.Read}function at(t,r){return L.create(r.positionAt(t.offset),r.positionAt(t.end))}var fn=function(){function t(){}return t.prototype.configure=function(r){this.settings=r},t.prototype.doValidation=function(r,e){if(e===void 0&&(e=this.settings),e&&e.validate===!1)return[];var i=kt(r.getText()),n=i.errors,a=i.warnings,u=function(m,h){return{severity:h,range:{start:r.positionAt(m.loc.start.offset),end:r.positionAt(m.loc.end.offset)},message:m.msg,source:r.languageId}},d=[];return d.push.apply(d,n.map(function(m){return u(m,Se.Error)})),d.push.apply(d,a.map(function(m){return u(m,Se.Warning)})),d},t}();function dn(t){var r=new wr,e=new cn(t&&t.clientCapabilities),i=new on(t&&t.clientCapabilities),n=new ln,a=new fn;return{doValidation:a.doValidation.bind(a),parseProgram:r.parseProgram.bind(r),doComplete:i.doComplete.bind(i),doHover:e.doHover.bind(e),findDefinition:n.findDefinition.bind(n),findReferences:n.findReferences.bind(n),findDocumentHighlights:n.findDocumentHighlights.bind(n),findDocumentSymbols:n.findDocumentSymbols.bind(n)}}var zt=class{_ctx;_languageService;_languageId;constructor(r,e){this._ctx=r,this._languageId=e.languageId,this._languageService=dn({})}async doValidation(r){let e=this._getTextDocument(r);if(e){let i=this._languageService.doValidation(e);return Promise.resolve(i)}return Promise.resolve([])}async doComplete(r,e){let i=this._getTextDocument(r);if(!i)return null;let n=this._languageService.parseProgram(i),a=this._languageService.doComplete(i,e,n);return Promise.resolve(a)}async doHover(r,e){let i=this._getTextDocument(r);if(!i)return null;let n=this._languageService.parseProgram(i),a=this._languageService.doHover(i,e,n);return Promise.resolve(a)}async findDefinition(r,e){let i=this._getTextDocument(r);if(!i)return null;let n=this._languageService.parseProgram(i),a=this._languageService.findDefinition(i,e,n);return Promise.resolve(a)}async findReferences(r,e){let i=this._getTextDocument(r);if(!i)return[];let n=this._languageService.parseProgram(i),a=this._languageService.findReferences(i,e,n);return Promise.resolve(a)}async findDocumentHighlights(r,e){let i=this._getTextDocument(r);if(!i)return[];let n=this._languageService.parseProgram(i),a=this._languageService.findDocumentHighlights(i,e,n);return Promise.resolve(a)}async findDocumentSymbols(r){let e=this._getTextDocument(r);if(!e)return[];let i=this._languageService.parseProgram(e),n=this._languageService.findDocumentSymbols(e,i);return Promise.resolve(n)}_getTextDocument(r){let e=this._ctx.getMirrorModels();for(let i of e)if(i.uri.toString()===r)return Ue.create(r,this._languageId,i.version,i.getValue());return null}};function na(t,r){return new zt(t,r)}return cr(ia);})();
return moduleExports;
});
